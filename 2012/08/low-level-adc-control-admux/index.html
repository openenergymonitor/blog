<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Low-level ADC control: ADMUX - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/2012/08/low-level-adc-control-admux/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Low-level ADC control: ADMUX">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/2012/08/low-level-adc-control-admux/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Low-level ADC control: ADMUX">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />



    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu:light,bold&amp;subset=Latin" rel="stylesheet"> <!-- Ubuntu font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  </head>

<style>

@font-face {
  font-family: "oemFont";
  src: url(/font/Ubuntu-OEM-Light.ttf)
}

html, body {
  margin: 0; height: 100vh;
}

html {
  min-height: 100vh;
}

html, body {
  word-wrap: break-word;
  font-family: "oemFont", sans-serif;
}

a:visited, .a:hover, a:focus, a {
  color: #44b3e2;
}

.meta.clearfix {
  overflow-x: hidden;
}

.communityWrapper {
  position: relative;
  box-sizing: border-box;
  margin: 0 auto;
  width: 100%;
  height: 42px;
}

@media (min-width: 1080px) {
  .communityWrapper {
  width: 1080px;
  }
}

@media screen and (max-width: 400px) {
  .oemWrap {
  display: none;
  }
}

.fa-navicon {
  display: none;
  cursor: pointer;
  font-size: 30px;
  line-height: 42px;
  position: absolute;
  left: 0;
  color: #ffffff;
  padding-left: 12px;
  z-index: 9997;
}

@media screen and (max-width: 1079px) {
  .fa-navicon {
  display: inline-block;
  }
}

.titleHolder {
  position: relative;
  top: 0;
  width: 100%;
  height: 42px;
  background-color: #44b3e2;
  overflow: hidden;
  -webkit-box-shadow: 0 -2px 4px 2px #000;
  -moz-box-shadow: 0 -2px 4px 2px #000;
  box-shadow: 0 -2px 4px 2px #000;
}

.titleIcon {
  position: absolute;
  height: 42px;
  padding: 0 0 0 7px;
  text-align: center;
  line-height: 42px;
  color: #ffffff;
  vertical-align: top;
}

  .titleIcon i {
    vertical-align: middle;
    font-size: 32px;
    line-height: 42px;
  }

.thisTitle {
  position: absolute;
  box-sizing: border-box;
  left: 42px;
  right: 0;
  height: 42px;
  padding: 5px 0 5px 0;
  text-align: left;
  color: #ffffff;
  line-height: normal;
  vertical-align: top;
}

  .thisTitle a {
    position: absolute;
    top: 0;
    color: #ffffff;
  }

@media screen and (max-width: 1079px) {
  .titleIcon {
    left: auto;
    right: 0;
    padding: 0 7px 0 0;
  }

  .thisTitle {
    right: 42px;
    left: 0;
    text-align: right;
  }

    .thisTitle a {
      padding-right: 0;
    }
}

.thisTitle-top {
  top: 0;
  height: 60%;
  font-size: 18px;
}

.thisTitle-bottom {
  bottom: 0;
  height: 40%;
  font-size: 12px;
}

.navigation {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  margin-right: 6px;
  height: 42px;
  min-width: 774px;
  overflow: visible;
  padding-right: 7px;
  z-index: 20;
  box-sizing: content-box;
}

@media screen and (min-width: 1080px) {
  .navigation {
  position: relative;
  float: right;
  display: inline-block;
  margin: 0;
  }
}

.navigation ul {
  list-style-type: none;
  float: right;
  top: 0;
  margin: 0;
  padding: 0;
  height: 100%;
  display: block;
}

.navigation ul li {
  float: left;
  background-color: #44b3e2;
}

.navigation ul li a {
  display: block;
  line-height: 42px;
  font-family: "oemFont", sans-serif;
  font-size: 16px;
  text-align: center;
  padding-left: 10px;
  padding-right: 10px;
  color: #ffffff;
}

.menuFreeze {
  height: 100%;
  overflow: hidden;
}

/* Navigation on smaller screens... */

@media screen and (max-width: 1079px) {
.navigation {
  position: fixed;
  display: none;
  top: 0;
  left: 0;
  height: 100vh;
  margin: 0;
  width: 0;
  font-size: 20px;
  background-color: #44b3e2;
  color: #ffffff;
  box-sizing: border-box;
  overflow: auto;
  min-width: 0;
  padding-right: 0;
  z-index: 99999999;
}

  .navigation ul {
    list-style-type: none;
    margin: 0;
    padding-top: 0;
  }

  .navigation ul li a {
    box-sizing: border-box;
    font-family: "oemFont", sans-serif;
    font-size: 20px;
    display: block;
    color: #ffffff;
    padding: 0 20px 0 20px;
    height: 12.5vh;
    line-height: 12.5vh;
    min-width: 180px;
    text-align: left;
  }

  .navigation ul li .fa {
    min-width: 25px;
  }
}

@media (max-width: 1079px) and (min-height: 550px) {
  .navigation ul li a {
    height: 68.75px;
    line-height: 68.75px;
  }
}

@media (max-width: 1079px) and (max-height: 200px) {
  .navigation ul li a {
    height: 25px;
    line-height: 25px;
  }
}

@media screen and (min-width: 1080px) {
  .navigation ul li:nth-child(1) {
    width: 88px;
  }
  .navigation ul li:nth-child(2) {
    width: 86px;
  }
  .navigation ul li:nth-child(3) {
    width: 92px;
  }
  .navigation ul li:nth-child(4) {
    width: 123px;
  }
  .navigation ul li:nth-child(5) {
    width: 133px;
  }
  .navigation ul li:nth-child(6) {
    width: 76px;
  }
  .navigation ul li:nth-child(7) {
    width: 80px;
  }
  .navigation ul li:nth-child(8) {
    width: 96px;
  }
}

.blackOut {
  position: fixed;
  display: none;
  top: 0;
  right: 0;
  height: 100vh;
  width: 100%;
  background-color: rgba(0,0,0,0.5);
  overflow: hidden;
  cursor: pointer;
  z-index:9998;
}

.actoemLink {
  background-color: #368fb4 !important;
}

.actoemLink a {
  color: #ffffff !important;
}

.searchBox {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgba(0,0,0,0.8);
  color: #fff;
  display: none;
  cursor: pointer;
  z-index: 9999999999999;
}

.searchBox form {
  margin: auto;
}

.searchBox input[type=submit] {
  cursor: pointer;
  padding: 10px;
  font-size: 20px;
  font-weight: bold;
  background-color: #44b3e2;
  color: #fff;
  border: none;
  -webkit-transition: background-color 500ms linear;
  -ms-transition: background-color 500ms linear;
  transition: background-color 500ms linear;
}

.searchBox input[type=submit]:hover {
  background-color: #77c8ea;
}

.searchBox input[type=text] {
  padding: 10px;
  font-size: 20px;
  border: none;
}

.searchText {
  width: 0;
}

.searchIcon {
  cursor: pointer;
}

.fa {
  text-shadow: 2px 2px 2px rgba(150, 150, 150, 0.5);
}

</style>

<body >




<div class="titleHolder">
  <div class="communityWrapper">
    <i class="fa fa-navicon"></i>
    <a href="/">
      <div class="titleIcon">
				<i aria-hidden="true" class="fa fa-bullhorn"></i>
			</div>
			<div class="thisTitle">
			  <div class="thisTitle-top">
        		<b>Blog</b>
				</div>
				<div class="thisTitle-bottom">
          Open<b>EnergyMonitor</b>
				</div>
			</div>
		</a>
    <div id="siteLinks" class="navigation">
      <ul>
        <li title="the homepage of OpenEnergyMonitor">
          <a href="https://openenergymonitor.org">
            <i class="fa fa-home" aria-hidden="true"></i><span class="navname">&nbsp;Home</span>
          </a>
        </li>
        <li title="a user guide for the OpenEnergyMonitor system">
          <a href="https://guide.openenergymonitor.org">
            <i class="fa fa-book" aria-hidden="true"></i><span class="navname">&nbsp;Guide</span>
          </a>
        </li>
        <li title="general information about energy monitoring, diversion and sustainability">
          <a href="https://learn.openenergymonitor.org">
            <i class="fa fa-mortar-board" aria-hidden="true"></i><span class="navname">&nbsp;Learn</span>
          </a>
        </li>
        <li title="a definitive list of resources for OpenEnergyMonitor hardware">
          <a href="https://guide.openenergymonitor.org/technical/resources/">
            <i class="fa fa-list-alt" aria-hidden="true"></i><span class="navname">&nbsp;Resources</span>
          </a>
        </li>
        <li title="the openenergymonitor forum">
          <a href="https://community.openenergymonitor.org">
            <i class="fa fa-comments" aria-hidden="true"></i><span class="navname">&nbsp;Community</span>
          </a>
        </li>
        <li title="you are here: keep up with new developments at OpenEnergyMonitor" class="actoemLink">
          <a href="https://blog.openenergymonitor.org">
            <i class="fa fa-bullhorn" aria-hidden="true"></i><span class="navname">&nbsp;Blog</span>
          </a>
        </li>
        <li title="the official OpenEnergyMonitor online store">
          <a href="https://shop.openenergymonitor.com">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i><span class="navname">&nbsp;Shop</span>
          </a>
        </li>
				<li title="search for something on OpenEnergyMonitor">
					<a class="searchIcon">
					    <i aria-hidden="true" class="fa fa-search"></i><span class="navname">&nbsp;Search</span>
				  </a>
				</li>
      </ul>
    </div>
  </div>
</div>
<div class="searchBox">
  <form target="_blank" id="searchform" action="https://www.google.com/cse">
    <div>
      <input type="hidden" name="cx" value="006198118389747886812:_nmxikw563w" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" class="searchText" value="" name="q" id="q" autocomplete="off" />
      <input type="submit" id="searchsubmit" name="sa" value="Search" />
    </div>
  </form>
</div>
<div class="blackOut"></div>
<div style="position:relative;width:100%;top:0;height:20px"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script defer src="/javascripts/octopress.js"></script>

<script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

<script>

var closeStatus = false;

function openButton() {
  $("html, body").addClass("menuFreeze");
  $(".blackOut").show();
  $(".navigation").show();
  $(".navigation").animate({ width:'180' },"0.5s");
}

$(".fa-navicon").click(function() {
  openButton();
  closeStatus = true;
});

function closeButton() {
  $("html, body").removeClass("menuFreeze");
  $(".blackOut").hide();
  $(".navigation").animate({ width:'0' },"0.5s");
}

$(".blackOut").click(function() {
  closeButton();
  closeStatus = false;
});

$(document).ready(function(){
  $("table").wrap("<div style='max-width:100%;overflow-x:auto'></div>");
});

$(window).resize(function(){
  if ($(window).width() > 1079 && closeStatus == true) {
    if (!$("html").hasClass("mobile-device")) {
      closeButton();
      closeStatus = false;
    }
  }
});

$(".searchIcon").click(function() {
   $(".searchBox").css("display","flex");
   $(".searchText").animate({width: "200px"});
   $(".searchText").focus();
   $("html, body").addClass("menuFreeze");
});
$(".searchBox").click(function() {
   $(".searchBox").css("display","none");
   $(".searchText").blur();
   $(".searchText").css("width","0");
   closeButton();
});
$(".searchBox form").click( function(event) {
   event.stopPropagation();
});

$(document).ready(function(){ //alphabetically order list
  var ls, x, switchState, z, switchMe;
  ls = document.getElementById("ub202");
  switchState = true;
  while (switchState) {
    switchState = false;
    z = ls.getElementsByTagName("LI");
    for (x = 0; x < (z.length - 1); x++) {
      switchMe = false;
      if (z[x].innerHTML.toLowerCase() > z[x + 1].innerHTML.toLowerCase()) {
        switchMe= true;
        break;
      }
    }
    if (switchMe) {
      z[x].parentNode.insertBefore(z[x + 1], z[x]);
      switchState = true;
    }
  }
});

</script>

<div class="grid-wrapper">
  <div class="grid grid-center">
    
    <div class="grid__item two-thirds lap-one-whole palm-one-whole">
    

      <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2012-08-02-low-level-adc-control-admux.html'>Edit on GitHub</a></div>
<div class='edit-github'><a href='http://prose.io/#openenergymonitor/blog/edit/master/source/_posts/2012-08-02-low-level-adc-control-admux.html'>Edit on GitHub Prose</a></div>
  
  <header>
  
  <h1 class="title indent">Low-level ADC control: ADMUX</h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-02T09:51:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-02 09:51:00 +00002012-08-02 09:51:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> seven minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/low-level-adc-control-admux/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div><span class="Apple-style-span" style="background-color: white; font-family: Arial, Verdana, sans-serif; font-size: 12px;"></span><br />While discussing the 3 phase sketch implementation here:&nbsp;<a href="http://openenergymonitor.org/emon/node/467">http://openenergymonitor.org/emon/node/467</a>&nbsp;by Pcunha which makes use of the AVR analog read commands rather than the arduino analog_read function&nbsp;which is a wrapping for these commands JBecker suggested that the analog reference voltage was not being selected correctly, so I had to do some reading up on this on ADMUX and bitwise operators.<br /><br />So for anyone interested, this is how it works first ADMUX is an 8-bit byte that holds the settings for the analog reference voltage and the analog pin to select:<br /><br />ADMUX is 8-bit:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 59px;">&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>7 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>6 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>5 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>4 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>3 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>2 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>1 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>0 bit&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;"><b>ADMUX</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">REFS1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">REFS0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">ADLAR&nbsp;</td><td style="background-color: #f3f3f3; color: #999999; font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">-&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX3&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX2&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX0&nbsp;</td></tr></tbody></table></span><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"></span>Where:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 77px;"><b>&nbsp;REFS1</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 77px;"><b>REFS0&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 402px;"><b>Voltage Reference Selection&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">AREF, Internal Vref turned off&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">AVcc with external capacitor on AREF pin&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">Reserved&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">Internal 1.1V (ATmega168/328) or &nbsp;2.56V on (ATmega8)</td></tr></tbody></table></span>and:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top; width: 111px;"><b>MUX 3...0</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top; width: 307px;"><b>Single Ended Input</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0000</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC0&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0001</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC1&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0010</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC2&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0011</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC3&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0100</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC4&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0101</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC5</td></tr></tbody></table></span><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: x-small;"><span class="Apple-style-span" style="line-height: 16px;"><br /></span></span><br /><span class="Apple-style-span" style="background-color: white; font-family: Arial, Verdana, sans-serif; font-size: 12px;"><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><br /></span></span><br />So if we want to use AVcc with external capacitor on AREF pin as our voltage reference (which is the default arduino voltage reference) and we want to select ADC2 for example, we would need to set ADMUX to:<div><br /></div><div><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 59px;">&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>7 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>6 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>5 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>4 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>3 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>2 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>1 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>0 bit&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;"><b>ADMUX</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="background-color: #f3f3f3; color: #999999; font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td></tr></tbody></table></span><div><br /></div><div>We can use <a href="http://en.wikipedia.org/wiki/Operators_in_C_and_C%2B%2B">bitwise operations</a> to get there:</div><div><br /></div><div>This is how its done in&nbsp;<i>wiring_analog.c</i> found in <i>Arduino-1.0/hardware/arduino/cores/arduino</i><br /><br /><b>ADMUX = (analog_reference &lt;&lt; 6) | (pin &amp; 0x07);</b><br /><b><br /></b><br />Starting with<b>&nbsp;(analog_reference &lt;&lt; 6)</b>. The variable analog_reference is set to 1 as default for the atmega328 so&nbsp;1 &lt;&lt; 6 means bitshift 1 left 6 places where 1 in binary is&nbsp;00000001 and shifting the bits left 6 places moves the 1 to 01000000. The desirable result for setting the 6th bit REFS0 to 1.<br /><br />If you dont need to select different analog_reference values then we can get&nbsp;01000000 directly by specifying its&nbsp;hexadecimal: 0x40.<br /><br />Next looking at the&nbsp;<b>&nbsp;(pin &amp; 0x07) </b>part.<br /><br /><ul><li>The &amp; 0x07 is actually just for validation, it essentially says only allow selection of ADC0 to ADC5.&nbsp;</li><li>The &amp; bitwise operator is the <b>AND</b> operation.</li><li>0x07 is&nbsp;hexadecimal whose binary representation is 00000111</li><li>Selecting ADC2 which is pin = 2 or in binary 00000010</li><li>The result of 2 &amp; 0x07 =&nbsp;00000010 AND&nbsp;00000111 =&nbsp;00000010.</li></ul><br />The last part is the<b> | </b>bitwise operator: <b>OR</b><br /><b><br /></b><br />(analog_reference &lt;&lt; 6) | (pin &amp; 0x07) becomes in our example here&nbsp;01000000 OR 00000010. Which is equall to:&nbsp;<b>01000010 </b>the result we where looking for above.<br /><br />If you would like to read more on the AVR ADC commands see these&nbsp;helpful&nbsp;articles:<br /><br /><a href="https://sites.google.com/site/qeewiki/books/avr-guide/analog-input">https://sites.google.com/site/qeewiki/books/avr-guide/analog-input</a><br /><a href="http://www.protostack.com/blog/2011/02/analogue-to-digital-conversion-on-an-atmega168/">http://www.protostack.com/blog/2011/02/analogue-to-digital-conversion-on-an-atmega168/</a><br /><br /></div></div>
      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>




    </div>

    
    <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
      <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2018/11/demand-side-response/">Demand Side Response Development</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emoncms-theme/">Emoncms Blue Theme</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emonpi-remote-access/">emonPi Remote Access with Dataplicity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/10/iotawatt/">Introducing IoTaWatt</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/cydynni-energylocal/">CydYnni â€“ Energy Local, community hydro smart grid</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/advances-article/">Advances Wales Magazine Article</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/06/emoncms-android-app-v2/">Emoncms Android App V2</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/06/emonpi-network-setup-wizard/">emonPi Network Setup Wizard</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/05/raspberrypi-blog/">Raspberry Pi blog</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/05/emonpi-mqtt-googlehome/">emonPi as a Home Automation Hub</a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
    </aside>
    
  </div>
</div>

<footer>
  <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit" style="text-align:center;">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
<!--
<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div> -->
</div>
    </div>
  </div>
</div>
</footer>

<!--[if lt IE 7]>
  <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

</body>
</html>
