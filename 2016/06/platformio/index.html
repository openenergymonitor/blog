<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Part 1/3: PlatformIO open-source embedded development ecosystem - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="/2016/06/platformio/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Part 1/3: PlatformIO open-source embedded development ecosystem">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="/2016/06/platformio/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Part 1/3: PlatformIO open-source embedded development ecosystem">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />



    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu:light,bold&amp;subset=Latin" rel="stylesheet"> <!-- Ubuntu font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  </head>

<style>

@font-face {
  font-family: "oemFont";
  src: url(/font/Ubuntu-OEM-Light.ttf)
}

html, body {
  margin: 0; height: 100vh;
}

html {
  min-height: 100vh;
}

html, body {
  word-wrap: break-word;
  font-family: "oemFont", sans-serif;
}

a:visited, .a:hover, a:focus, a {
  color: #44b3e2;
}

.meta.clearfix {
  overflow-x: hidden;
}

.communityWrapper {
  position: relative;
  box-sizing: border-box;
  margin: 0 auto;
  width: 100%;
  height: 42px;
}

@media (min-width: 1080px) {
  .communityWrapper {
  width: 1080px;
  }
}

@media screen and (max-width: 400px) {
  .oemWrap {
  display: none;
  }
}

.fa-navicon {
  display: none;
  cursor: pointer;
  font-size: 30px;
  line-height: 42px;
  position: absolute;
  left: 0;
  color: #ffffff;
  padding-left: 12px;
  z-index: 9997;
}

@media screen and (max-width: 1079px) {
  .fa-navicon {
  display: inline-block;
  }
}

.titleHolder {
  position: relative;
  top: 0;
  width: 100%;
  height: 42px;
  background-color: #44b3e2;
  overflow: hidden;
  -webkit-box-shadow: 0 -2px 4px 2px #000;
  -moz-box-shadow: 0 -2px 4px 2px #000;
  box-shadow: 0 -2px 4px 2px #000;
}

.titleIcon {
  position: absolute;
  height: 42px;
  padding: 0 0 0 7px;
  text-align: center;
  line-height: 42px;
  color: #ffffff;
  vertical-align: top;
}

  .titleIcon i {
    vertical-align: middle;
    font-size: 32px;
    line-height: 42px;
  }

.thisTitle {
  position: absolute;
  box-sizing: border-box;
  left: 42px;
  right: 0;
  height: 42px;
  padding: 5px 0 5px 0;
  text-align: left;
  color: #ffffff;
  line-height: normal;
  vertical-align: top;
}

  .thisTitle a {
    position: absolute;
    top: 0;
    color: #ffffff;
  }

@media screen and (max-width: 1079px) {
  .titleIcon {
    left: auto;
    right: 0;
    padding: 0 7px 0 0;
  }

  .thisTitle {
    right: 42px;
    left: 0;
    text-align: right;
  }

    .thisTitle a {
      padding-right: 0;
    }
}

.thisTitle-top {
  top: 0;
  height: 60%;
  font-size: 18px;
}

.thisTitle-bottom {
  bottom: 0;
  height: 40%;
  font-size: 12px;
}

.navigation {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  margin-right: 6px;
  height: 42px;
  min-width: 774px;
  overflow: visible;
  padding-right: 7px;
  z-index: 20;
  box-sizing: content-box;
}

@media screen and (min-width: 1080px) {
  .navigation {
  position: relative;
  float: right;
  display: inline-block;
  margin: 0;
  }
}

.navigation ul {
  list-style-type: none;
  float: right;
  top: 0;
  margin: 0;
  padding: 0;
  height: 100%;
  display: block;
}

.navigation ul li {
  float: left;
  background-color: #44b3e2;
}

.navigation ul li a {
  display: block;
  line-height: 42px;
  font-family: "oemFont", sans-serif;
  font-size: 16px;
  text-align: center;
  padding-left: 10px;
  padding-right: 10px;
  color: #ffffff;
}

.menuFreeze {
  height: 100%;
  overflow: hidden;
}

/* Navigation on smaller screens... */

@media screen and (max-width: 1079px) {
.navigation {
  position: fixed;
  display: none;
  top: 0;
  left: 0;
  height: 100vh;
  margin: 0;
  width: 0;
  font-size: 20px;
  background-color: #44b3e2;
  color: #ffffff;
  box-sizing: border-box;
  overflow: auto;
  min-width: 0;
  padding-right: 0;
  z-index: 99999999;
}

  .navigation ul {
    list-style-type: none;
    margin: 0;
    padding-top: 0;
  }

  .navigation ul li a {
    box-sizing: border-box;
    font-family: "oemFont", sans-serif;
    font-size: 20px;
    display: block;
    color: #ffffff;
    padding: 0 20px 0 20px;
    height: 12.5vh;
    line-height: 12.5vh;
    min-width: 180px;
    text-align: left;
  }

  .navigation ul li .fa {
    min-width: 25px;
  }
}

@media (max-width: 1079px) and (min-height: 550px) {
  .navigation ul li a {
    height: 68.75px;
    line-height: 68.75px;
  }
}

@media (max-width: 1079px) and (max-height: 200px) {
  .navigation ul li a {
    height: 25px;
    line-height: 25px;
  }
}

@media screen and (min-width: 1080px) {
  .navigation ul li:nth-child(1) {
    width: 88px;
  }
  .navigation ul li:nth-child(2) {
    width: 86px;
  }
  .navigation ul li:nth-child(3) {
    width: 92px;
  }
  .navigation ul li:nth-child(4) {
    width: 123px;
  }
  .navigation ul li:nth-child(5) {
    width: 133px;
  }
  .navigation ul li:nth-child(6) {
    width: 76px;
  }
  .navigation ul li:nth-child(7) {
    width: 80px;
  }
  .navigation ul li:nth-child(8) {
    width: 96px;
  }
}

.blackOut {
  position: fixed;
  display: none;
  top: 0;
  right: 0;
  height: 100vh;
  width: 100%;
  background-color: rgba(0,0,0,0.5);
  overflow: hidden;
  cursor: pointer;
  z-index:9998;
}

.actoemLink {
  background-color: #368fb4 !important;
}

.actoemLink a {
  color: #ffffff !important;
}

.searchBox {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgba(0,0,0,0.8);
  color: #fff;
  display: none;
  cursor: pointer;
  z-index: 9999999999999;
}

.searchBox form {
  margin: auto;
}

.searchBox input[type=submit] {
  cursor: pointer;
  padding: 10px;
  font-size: 20px;
  font-weight: bold;
  background-color: #44b3e2;
  color: #fff;
  border: none;
  -webkit-transition: background-color 500ms linear;
  -ms-transition: background-color 500ms linear;
  transition: background-color 500ms linear;
}

.searchBox input[type=submit]:hover {
  background-color: #77c8ea;
}

.searchBox input[type=text] {
  padding: 10px;
  font-size: 20px;
  border: none;
}

.searchText {
  width: 0;
}

.searchIcon {
  cursor: pointer;
}

.fa {
  text-shadow: 2px 2px 2px rgba(150, 150, 150, 0.5);
}

</style>

<body >




<div class="titleHolder">
  <div class="communityWrapper">
    <i class="fa fa-navicon"></i>
    <a href="/">
      <div class="titleIcon">
				<i aria-hidden="true" class="fa fa-bullhorn"></i>
			</div>
			<div class="thisTitle">
			  <div class="thisTitle-top">
        		<b>Blog</b>
				</div>
				<div class="thisTitle-bottom">
          Open<b>EnergyMonitor</b>
				</div>
			</div>
		</a>
    <div id="siteLinks" class="navigation">
      <ul>
        <li title="the homepage of OpenEnergyMonitor">
          <a href="https://openenergymonitor.org">
            <i class="fa fa-home" aria-hidden="true"></i><span class="navname">&nbsp;Home</span>
          </a>
        </li>
        <li title="a user guide for the OpenEnergyMonitor system">
          <a href="https://guide.openenergymonitor.org">
            <i class="fa fa-book" aria-hidden="true"></i><span class="navname">&nbsp;Guide</span>
          </a>
        </li>
        <li title="general information about energy monitoring, diversion and sustainability">
          <a href="https://learn.openenergymonitor.org">
            <i class="fa fa-mortar-board" aria-hidden="true"></i><span class="navname">&nbsp;Learn</span>
          </a>
        </li>
        <li title="a definitive list of resources for OpenEnergyMonitor hardware">
          <a href="https://guide.openenergymonitor.org/technical/resources/">
            <i class="fa fa-list-alt" aria-hidden="true"></i><span class="navname">&nbsp;Resources</span>
          </a>
        </li>
        <li title="the openenergymonitor forum">
          <a href="https://community.openenergymonitor.org">
            <i class="fa fa-comments" aria-hidden="true"></i><span class="navname">&nbsp;Community</span>
          </a>
        </li>
        <li title="you are here: keep up with new developments at OpenEnergyMonitor" class="actoemLink">
          <a href="https://blog.openenergymonitor.org">
            <i class="fa fa-bullhorn" aria-hidden="true"></i><span class="navname">&nbsp;Blog</span>
          </a>
        </li>
        <li title="the official OpenEnergyMonitor online store">
          <a href="https://shop.openenergymonitor.com">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i><span class="navname">&nbsp;Shop</span>
          </a>
        </li>
				<li title="search for something on OpenEnergyMonitor">
					<a class="searchIcon">
					    <i aria-hidden="true" class="fa fa-search"></i><span class="navname">&nbsp;Search</span>
				  </a>
				</li>
      </ul>
    </div>
  </div>
</div>
<div class="searchBox">
  <form target="_blank" id="searchform" action="https://www.google.com/cse">
    <div>
      <input type="hidden" name="cx" value="006198118389747886812:_nmxikw563w" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" class="searchText" value="" name="q" id="q" autocomplete="off" />
      <input type="submit" id="searchsubmit" name="sa" value="Search" />
    </div>
  </form>
</div>
<div class="blackOut"></div>
<div style="position:relative;width:100%;top:0;height:20px"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script defer src="/javascripts/octopress.js"></script>

<script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    // var disqus_developer = 1;
    var disqus_identifier = 'https://blog.openenergymonitor.org/2016/06/platformio/';
    var disqus_url = 'https://blog.openenergymonitor.org/2016/06/platformio/';
    var disqus_script = 'embed.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

<script>

var closeStatus = false;

function openButton() {
  $("html, body").addClass("menuFreeze");
  $(".blackOut").show();
  $(".navigation").show();
  $(".navigation").animate({ width:'180' },"0.5s");
}

$(".fa-navicon").click(function() {
  openButton();
  closeStatus = true;
});

function closeButton() {
  $("html, body").removeClass("menuFreeze");
  $(".blackOut").hide();
  $(".navigation").animate({ width:'0' },"0.5s");
}

$(".blackOut").click(function() {
  closeButton();
  closeStatus = false;
});

$(document).ready(function(){
  $("table").wrap("<div style='max-width:100%;overflow-x:auto'></div>");
});

$(window).resize(function(){
  if ($(window).width() > 1079 && closeStatus == true) {
    if (!$("html").hasClass("mobile-device")) {
      closeButton();
      closeStatus = false;
    }
  }
});

$(".searchIcon").click(function() {
   $(".searchBox").css("display","flex");
   $(".searchText").animate({width: "200px"});
   $(".searchText").focus();
   $("html, body").addClass("menuFreeze");
});
$(".searchBox").click(function() {
   $(".searchBox").css("display","none");
   $(".searchText").blur();
   $(".searchText").css("width","0");
   closeButton();
});
$(".searchBox form").click( function(event) {
   event.stopPropagation();
});

$(document).ready(function(){ //alphabetically order list
  var ls, x, switchState, z, switchMe;
  ls = document.getElementById("ub202");
  switchState = true;
  while (switchState) {
    switchState = false;
    z = ls.getElementsByTagName("LI");
    for (x = 0; x < (z.length - 1); x++) {
      switchMe = false;
      if (z[x].innerHTML.toLowerCase() > z[x + 1].innerHTML.toLowerCase()) {
        switchMe= true;
        break;
      }
    }
    if (switchMe) {
      z[x].parentNode.insertBefore(z[x + 1], z[x]);
      switchState = true;
    }
  }
});

</script>

<div class="grid-wrapper">
  <div class="grid grid-center">
    
    <div class="grid__item two-thirds lap-one-whole palm-one-whole">
    

      <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2016-06-11-platformio.markdown'>Edit on GitHub</a></div>
<div class='edit-github'><a href='http://prose.io/#openenergymonitor/blog/edit/master/source/_posts/2016-06-11-platformio.markdown'>Edit on GitHub Prose</a></div>
  
  <header>
  
  <h1 class="title indent">Part 1/3: PlatformIO open-source embedded development ecosystem</h1>
  

  
  <div class="meta clearfix">
    <time datetime="2016-06-12T10:00:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> June 12th 2016
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> six minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li>platformio</li>
      
        <li>travisci</li>
      
        <li>firmware</li>
      
        <li>emonpi</li>
      
        <li>emontx</li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2016/06/platformio/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <p><strong>This post is part of a series:</strong></p>

<ul>
  <li><strong>1/3: PlatfomIO overview &amp; compiling + uploading locally and on a Raspberry Pi</strong></li>
  <li><a href="/2016/06/auto-build-continuous-test-firmware/">2/3: Continuous testing and auto release binary generation using PlatformIO &amp; TravisCI</a>
    <ul>
      <li>Related post: <a href="/2016/06/esp8266-emonesp-developments">EmonESP ESP8266 WiFi developments</a></li>
    </ul>
  </li>
  <li><a href="/2016/06/esp8266-ota-update/">3/3: Continuous Deployment (OTA to ESP8266)</a></li>
</ul>

<hr />

<h1 id="part-13-platformio-open-source-embedded-development-ecosystem">Part 1/3: PlatformIO open-source embedded development ecosystem</h1>

<p>Getting an Arduino based project (or other embedded platform) to compile and upload can be a pain. Making sure all the libraries are installed in the correct locations and of the correct versions can be tricky and time-consuming.</p>

<p>I’m sure many developers will agree that the tools we use for embedded development are generally not as good as those used for web application development.</p>

<p>The Arduino team have done a good job with their IDE to try and make the embedded development tool-chain setup as easy as possible. However, I still find library management a cause of frustration. Especially since I move between computers and OSes frequently.</p>

<p>Recently I have been using PlatformIO and am rather impressed with the ease of setup, speed of compilation, uploading (auto port detection), and most importantly an excellent <a href="http://platformio.org/lib">library manager</a>.</p>

<blockquote>
  <p>PlatformIO is an open-source ecosystem for IoT development.</p>
</blockquote>

<blockquote>
  <p>Cross-platform build system, IDE integration and continuous testing. Arduino, Espressif, ARM and mbed compatible.</p>
</blockquote>

<p><img src="/uploads/default/original/1X/f6d5f19402b36b099b3d54bd44a46b2a1ce673d3.png" alt="PlatformIO IDE" /></p>

<p>This post got quite long, therefore, It’s been split into three posts:</p>

<ol>
  <li>PlatfomIO overview &amp; compiling + uploading locally and on a Raspberry Pi</li>
  <li>Continuous testing and auto release binary generation using PlatformIO &amp; TravisCI</li>
  <li>Continuous Deployment (OTA to ESP8266)</li>
</ol>

<p>Here are some things that have impressed me about PlatformIO (pio) after using it for a couple of weeks:</p>

<ul>
  <li><a href="https://github.com/platformio"><strong>Fully open-source</strong></a> with active and friendly dev community.</li>
  <li><strong>Easy to install</strong> - Pure python based installed using pip
    <ul>
      <li>Tool-chains are auto installed on first compile / upload e.g.
        <ul>
          <li>If trying to upload to Arduino avrdude will automatically be installed</li>
          <li>If trying to compile an ESP8266 project the ESP toolchain will be installed</li>
        </ul>
      </li>
      <li>Cross-platform (Linux, Windows and mac all work the same), this will make support much easier</li>
    </ul>
  </li>
  <li><strong>Supports all the main embedded platforms</strong>
    <ul>
      <li>atmelavr (Arduino), espressif (ESP8266), ststm32 (ARM etc.)</li>
    </ul>
  </li>
  <li><strong>Command line and IDE</strong>
    <ul>
      <li>At work I use pio via Atom IDE on Ubuntu</li>
      <li>At home, I use a Chromebook with Caret IDE and interact with pio via command-line</li>
      <li>When developing directly on an emonPi / RaspberryPi pio command-line works great - <em>Yes, that’s right pio works on a RaspberryPi to compile and upload code directly!</em></li>
    </ul>
  </li>
  <li><a href="http://platformio.org/lib"><strong>Excellent library manager</strong></a>
    <ul>
      <li>Libraries can be searched and reviewed using command-line or web 2.0 manager</li>
      <li>Required libraries can be specified in the <code class="highlighter-rouge">platformio.ini</code> file and if not present install is prompted upon compilation</li>
      <li>Specific library version (as defined in <code class="highlighter-rouge">library.json</code> <a href="https://github.com/openenergymonitor/EmonLib/blob/master/library.json">(emonLib example)</a>) or git commit SHA</li>
    </ul>
  </li>
  <li><strong>Fast compilation &amp; pain-free uploading</strong>
    <ul>
      <li>PlatformIO’s compiler is the <a href="https://twitter.com/krzychb2/status/729294573760065536">fastest in the business</a></li>
      <li>USB / Serial ports auto detected</li>
      <li>Since the emonPi has been added as a custom board PlatformIO can even upload direct to emonPi via RaspberryPi GPIO and trigger GPIO AVR reset, not more <a href="https://github.com/openenergymonitor/avrdude-rpi">hacked avrdude</a>.</li>
    </ul>
  </li>
  <li><strong>Easy integration with continuous testing &amp; deployment</strong>
    <ul>
      <li>Integration with TravisCI to enable compilation, code testing and binary (.hex / .bin) release generation in the cloud.</li>
      <li><a href="http://github.com/openenergymonitor/emonpi/">emonPi</a> and <a href="github.com/openenergymonitor/emonTxFirmware">emonTx</a> git repos are now enabled for continous-testing and auto binary generation on release tag…this is a step change in embedded development.</li>
    </ul>
  </li>
</ul>

<a name="read-more"></a>

<hr />

<h2 id="example-compiling-emontx--emonpi-firmware">Example: Compiling emonTx / emonPi firmware</h2>

<p><a href="http://docs.platformio.org/en/latest/quickstart.html">PlatformIO has some excellent quick start docs</a> to cover setting up your first ‘blinky’ project, therefore I will not duplicate here. In this example I focus on setting up pio and compiling emonTx / emonPi firmware. This example assumes a totally bare metal machine with nothing installed except python (2.7 recommended). Pio works great on a Raspberry Pi.</p>

<p>This guide used command-line steps on Linux, if using windows or if you want to use the platformio IDE see <a href="http://platformio.org/get-started">PlatformIO Getting Started Page</a>.</p>

<p>The PlatformIO IDE or Atom IDE is excellent and very easy to use (self explanatory). This guide uses pio via command line as this gives a more hands-on experience to how pio is working.</p>

<h3 id="1-install-platformio">1. Install PlatformIO</h3>

<p>The easiest way if running Linux is to install use the install script, this installed pio via python pip and installs pip if not present. See <a href="http://docs.platformio.org/en/latest/installation.html#installer-script">PlatformIO installation docs</a>:</p>

<p><code class="highlighter-rouge">$ sudo python -c "$(curl -fsSL https://raw.githubusercontent.com/platformio/platformio/master/scripts/get-platformio.py)"</code></p>

<h3 id="2-clone-emontx--emonpi-repo">2. Clone emonTx / emonPi repo</h3>

<p>We’ll use the emonTx (V3 discrete sampling) as an example here but the steps are exactly the same for emonPi.</p>

<p><strong>emonTx V3</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/openenergymonitor/emontx3`
$ cd emontx3/firmware
</code></pre></div></div>

<p><strong>emonPi</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/openenergymonitor/emonpi`
cd emonpi/firmware
</code></pre></div></div>

<h3 id="3-compile-with-platformio">3. Compile with PlatformIO</h3>

<p><code class="highlighter-rouge">$ platformio run</code></p>

<p>or shorthand for the lazy</p>

<p><code class="highlighter-rouge">$ pio run</code></p>

<p><strong>That’s it!</strong> That’s all that’s needed to setup pio from scratch and compile emonTx firmware :-D</p>

<p>The first time platformIO is run it will ask to install the required libraries (at the specific version) and avr toolchain. The required libraries are defined in <a href="https://github.com/openenergymonitor/emontx3"><code class="highlighter-rouge">platformio.ini</code> in the emonTx discrete sampling firmware folder</a>:</p>

<p>e.g.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lib_deps =
  DallasTemperature @3.7.7
  EmonLib
  JeeLib@c057b5f4c0
</code></pre></div></div>
<p>Libs version can be defined by github commit ID, version number (git tag) or latest version (no specific version specified.)</p>

<p>The latest version of the libraries are automatically cloned from their native git repos into the <code class="highlighter-rouge">.piolibdeps</code> folder in the project dir.</p>

<h3 id="3-upload-using-platformio">3. Upload using PlatformIO</h3>

<h4 id="3a-via-usb-to-uart-programmer-to-emontx">3a. Via USB to UART programmer to emonTx</h4>

<p><code class="highlighter-rouge">$ sudo pio run -t upload</code></p>

<p>Pio will attempt to auto detect the USB programmer and upload :-)</p>

<p><em>Note: you will need <code class="highlighter-rouge">sudo</code> unless you have correctly <a href="https://github.com/platformio/platformio/blob/develop/scripts/99-platformio-udev.rules">configured udev rules</a>.</em></p>

<p>There is even a built in serial monitor</p>

<p><code class="highlighter-rouge">$ pio device monitor</code></p>

<h3 id="3b-using-ttyama0-gpio-to-upload-direct-to-emonpi">3b. Using ttyAMA0 GPIO to upload direct to emonPi</h3>

<p>This is where things get very exciting, pio can compile the code directly on a Raspberry Pi. The latest version of pio (due to be released in the next few weeks) will have built in support for the emonPi auto-reset on upload using GPIO4</p>

<p>The emonPi board is defined in <code class="highlighter-rouge">platformio.ini</code> in the <a href="https://github.com/openenergymonitor/emonpi/blob/master/firmware/platformio.ini">emonpi/firmware folder</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>board = emonpi
upload_port = /dev/ttyAMA0
</code></pre></div></div>

<p>All that is needed to compile and upload directly on the emonPi is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/emonpi/firmware
$ sudo pio run -t upload
</code></pre></div></div>

<p><em>Thanks a lot to <a href="https://github.com/ivankravets">Ivan Kravets</a> for helping integrate emonPi into the PlatfomIO ecosystem. <a href="https://github.com/platformio/platformio/commit/c5b5e80de4928cf91be59e675429b520e31d873a">View commit changes</a></em></p>

<hr />
<p>Stay tuned for part 2/3 of the PlatformIO post series which will cover setting up firmware continuous testing using Travis CI and auto compiled binary generation on release tag directly on github. This is currently live on the emonPi &amp; emonTx repos if you want a sneak preview. See <a href="https://github.com/openenergymonitor/emonpi/blob/master/.travis.yml">travis.yaml</a> file and Travis build status icon on the main emonpi repo <a href="https://github.com/openenergymonitor/emonpi/blob/master/README.md">Readme.md</a>.</p>

<hr />

      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>


<section id="disqus">
  <h3 class="indent title">Comments</h3>
  <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
</section>



    </div>

    
    <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
      <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2022/04/hardware-development/">Chip Shortage & Hardware Development Update</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2019/10/cydynni-display/">Cydynni emonCMS dashboard on display</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2019/05/emondc/">Introducing emonDC</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/11/2018-dev-update/">2018 Development Review</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/11/demand-side-response/">Demand Side Response Development</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emoncms-theme/">Emoncms Blue Theme</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emonpi-remote-access/">emonPi Remote Access with Dataplicity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/10/iotawatt/">Introducing IoTaWatt</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/cydynni-energylocal/">CydYnni – Energy Local, community hydro smart grid</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/advances-article/">Advances Wales Magazine Article</a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
    </aside>
    
  </div>
</div>

<footer>
  <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit" style="text-align:center;">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
<!--
<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div> -->
</div>
    </div>
  </div>
</div>
</footer>

<!--[if lt IE 7]>
  <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

</body>
</html>
