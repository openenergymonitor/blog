<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/posts/3/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Blog | OpenEnergyMonitor">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/posts/3/">
    <meta property="og:type" content="website">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Blog | OpenEnergyMonitor">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />
    
    
    
    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
	
  </head>

  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
  <a href="/" class="site-title">
    <!--<img width='40' src='/images/favicon-192x192.png'> -->
    
    <span style="color:#555;font-weight:bold;font-family:Arial;font-size:20"'>
Open</span><span style="color:#0699fa;font-weight:bold;font-family:Arial;font-size:20"'>EnergyMonitor</span>

  </a>
</div>

<div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="http://openenergymonitor.org">Home</a></li>
  <li><a href="http://shop.openenergymonitor.com">Online-Store</a></li>
  <li><a href="http://guide.openenergymonitor.org">User Guide</a></li>
  <li><a href="http://emoncms.org">Emoncms</a></li>
  <li><a href="http://community.openenergymonitor.org">Forum</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

            
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/11/openenergymonitor-november-2015/">OpenEnergyMonitor November 2015 - Overview Presentation</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-11-11T23:16:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-11-11 23:16:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> Less than one minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/presentation/'>presentation</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/11/openenergymonitor-november-2015/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    Here's a few slides giving an overview of the OpenEnergyMonitor project as it stands currently in November 2015. It features some of the work we have been doing looking at the <a href="http://openenergymonitor.blogspot.co.uk/2015/07/open-source-circular-economy-oscedays.html">embodied energy involved in producing and shipping some of our products</a>&nbsp;as well as latest developments on <a href="http://openenergymonitor.blogspot.co.uk/search/label/dashboard">Emoncms application dashboards</a>.&nbsp;<br /><br /><br /><iframe allowfullscreen="" frameborder="0" height="355" marginheight="0" marginwidth="0" scrolling="no" src="//www.slideshare.net/slideshow/embed_code/key/df1ND4Q5htgtks" style="border-width: 1px; border: 1px solid #CCC; margin-bottom: 5px; max-width: 100%;" width="425"> </iframe> <br /><div style="margin-bottom: 5px;"><strong> <a href="https://www.slideshare.net/OpenEnergyMonitor/openenergymonitor-overview-november-2015" target="_blank" title="OpenEnergyMonitor Overview November 2015">OpenEnergyMonitor Overview November 2015</a> </strong> from <strong><a href="https://www.slideshare.net/OpenEnergyMonitor" target="_blank">OpenEnergyMonitor</a></strong> <br /><br />Notes to accompany the slides can be found <a href="https://docs.google.com/document/d/1iRrEWlJnxP3RV3anaHM-lfrcbnEgE4XPLikMRgYGDSU/edit?usp=sharing">here</a>.</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/11/interpreting-emoncms-dashboards/">Interpreting Emoncms Dashboards</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-11-04T11:54:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-11-04 11:54:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/11/interpreting-emoncms-dashboards/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <br />The emonPi / emonTx standard install is designed to monitor whole house power consumption. An excellent learning exercise that we recommend everyone undertake soon after installing a whole house energy monitor is to turn off every appliance in the house then slowly turn on each appliance keeping a close eye on the real-time Emoncms dashboard. Walking around the house using a handheld mobile device to display the Emoncms dashboard works great for this. For fastest response we recommend connecting to the local Emoncms running locally on the emonBase / emonPi which will update ever 5s (emonPi default) or 10s (emonTx default). <br /><br />After this exercise you should have a good idea what the trace signature of each of your appliances looks like on the graph. The easiest to identify are the large power consumers e.g kettle 3kW spike and shower 8kW spike. However with a bit of observation it's possible to identify subtler power signatures. Here's an excellent example by posted by <a href="https://twitter.com/Zapaman/status/661867505523236864">@Zapaman</a> showing a Solar PV dashboard annotated to identify his fridge / freezer and central heating pump running over night. It's great to see the solar PV kick in providing more then the demand when the sun hits the panels in the morning :-)<br /><br /><a href="http://3.bp.blogspot.com/-GYvFIQEBn1o/VjnsepD-9gI/AAAAAAABiaw/BJp0MKP_ll0/s1600/interperate_solarPV_dash.png"><img border="0" src="http://3.bp.blogspot.com/-GYvFIQEBn1o/VjnsepD-9gI/AAAAAAABiaw/BJp0MKP_ll0/s640/interperate_solarPV_dash.png" /></a><br />
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/11/ambient-wind-energy-indicator-using/">Ambient Wind Energy Indicator using Node-RED and Blink(1) USB </a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-11-04T10:25:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-11-04 10:25:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> four minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/nodered/'>NodeRed</a></li>
      
        <li><a class='category' href='/categories/display/'>display</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/11/ambient-wind-energy-indicator-using/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div>As we move to a low carbon electric grid with large amount of input from renewable sources we will need to match our consumption of energy to generation. The wind will not always blow and the sun doesn't always shine. Grid energy storage will play a role, however the closer we can match our consumption of energy to generation the less storage will be required. In the future we can expect dynamic pricing to act as as an incentive for shifting consumption patterns.&nbsp;</div><div><br /></div><div>As an experiment I have been playing around with creating a real-time ambient indicator of UK wind energy generation. Since wind energy is the greatest input of renewable energy into the UK grid we can assume that when wind generation output is high this is the best time for us to use power e.g. run the washing machine, dish washer etc..&nbsp;</div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>I've used <a href="http://emoncms.org/">emoncms.org</a>, &nbsp;Node-RED and a <a href="https://blink1.thingm.com/">ThingM blink(1) USB RGB LED</a>&nbsp;plugged into an <a href="http://shop.openenergymonitor.com/emonpi-1">emonPi</a> energy monitor to create the indicator.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-MgLolvdJt4w/Vi6jGqzmYbI/AAAAAAABhhE/uCflxGRqya8/s1600/IMG_20151023_164739161%257E01.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="320" src="http://3.bp.blogspot.com/-MgLolvdJt4w/Vi6jGqzmYbI/AAAAAAABhhE/uCflxGRqya8/s320/IMG_20151023_164739161%257E01.jpg" width="239" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Real-time wind energy indicator</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-zTad-tTlyUE/VjnbfV5tPOI/AAAAAAABiaE/zrYYHpfwjW8/s1600/blinkusb.gif" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="213" src="http://4.bp.blogspot.com/-zTad-tTlyUE/VjnbfV5tPOI/AAAAAAABiaE/zrYYHpfwjW8/s320/blinkusb.gif" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Blink USB Indicator</td></tr></tbody></table><br />First let's install the software to control the Blink(1) USB on the emonPi / RaspberryPi:<br /><br /><i>$ git clone https://github.com/todbot/blink1</i><br /><i>$ sudo cp ~/blink1/linux/51-blink1.rules /etc/udev/rules.d/</i><br /><i>$ sudo udevadm control --reload-rules</i><br />un-plug then re-plug device<br /><i>$ cd blink1/commandline</i><br /><i>$ make</i><br /><br />Note: if Node HID fails to compile you may need to install gcc-4.8. I did not experience this problem using Raspbian Wheezy:&nbsp;<span style="color: #383838; font-family: &quot;monaco&quot; , &quot;courier&quot; , monospace; font-size: 14px; line-height: 1.57143em;"><a href="https://github.com/node-hid/node-hid/issues/115">https://github.com/node-hid/node-hid/issues/115</a></span><br /><span style="color: #383838; font-family: &quot;monaco&quot; , &quot;courier&quot; , monospace; font-size: 14px; line-height: 1.57143em;"><br /></span>Test it's operation by turning on a white LED with<br />$ <i>~/blink1/commandline./blink1-tools --on</i><br /><i><br /></i>To make the Blink(1) USB work with Node-RED we need to install the Blink(1) node-RED flow and libusb driver. If you haven't already got it installed this example also requires the emoncms noe-RED flow to pull data from emoncms.org<br /><br /><i>$ sudo apt-get install libusb-1.0-0.dev</i><br /><i>$ cd ~/.node-red</i><br /><i>$ npm install node-red-node-blink1</i><br /><i>$ npm install node-red-node-emoncms</i><br /><br />Then restart node-RED.<br /><br />Node-RED makes it super easy to link the required software components together, with pre built nodes available for emoncms and Blink USB it's just a case of linking the nodes together and adding some logic. Here is now node-RED flow, see node-RED export at bottom of this post:<br /><br /></div><div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-9_rpddNkZsA/VjnUJ2AYmOI/AAAAAAABiZQ/PVepjwwO6Jo/s1600/Node_RED_Emoncms_WindEnergy.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="208" src="http://4.bp.blogspot.com/-9_rpddNkZsA/VjnUJ2AYmOI/AAAAAAABiZQ/PVepjwwO6Jo/s640/Node_RED_Emoncms_WindEnergy.png" width="640" /></a></div><br /></div><div>We have a script running on emoncms.org to pull in real-time UK wind energy generation. We have been logging this data for almost a year now. Checkout the dashboard here: <a href="http://emoncms.org/mywindpower/ukwind">http://emoncms.org/mywindpower/ukwind</a>.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-zr6-pnRM68Q/Vjnc8gUs1gI/AAAAAAABiaU/7h__EuOz9ps/s1600/Emoncms_my_wind.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="253" src="http://3.bp.blogspot.com/-zr6-pnRM68Q/Vjnc8gUs1gI/AAAAAAABiaU/7h__EuOz9ps/s400/Emoncms_my_wind.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><a href="http://emoncms.org/mywindpower/ukwind" style="font-size: medium; text-align: start;">http://emoncms.org/mywindpower/ukwind</a></td></tr></tbody></table><br />The read API key for this account is <i>8f5c2d146c0c338845d2201b8fe1b0e1</i> and the feed ID is&nbsp;<span style="background-color: whitesmoke; color: #333333; font-family: &quot;helvetica neue&quot; , &quot;helvetica&quot; , &quot;arial&quot; , sans-serif; font-size: 14px; line-height: 20px;"><i>67088</i></span>. To pull the real time data into&nbsp;node red just plug in the &nbsp;api key and feed ID into the <a href="http://flows.nodered.org/node/node-red-node-emoncms">node-RED emoncms in node</a>. Node-RED will then execute the following GET request:</div><div><a href="https://www.blogger.com/goog_896110156"><br /></a><b><a href="http://emoncms.org/feed/value.json?id=67088&amp;apikey=8f5c2d146c0c338845d2201b8fe1b0e1">http://emoncms.org/feed/value.json?id=67088&amp;apikey=8f5c2d146c0c338845d2201b8fe1b0e1</a></b><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-eBOVh1G3bsk/Vii2O9QJ0cI/AAAAAAABhRE/BlMdaoiDjsQ/s1600/3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="275" src="http://4.bp.blogspot.com/-eBOVh1G3bsk/Vii2O9QJ0cI/AAAAAAABhRE/BlMdaoiDjsQ/s400/3.png" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-uCYC7R9TS8E/Vii2O8kylCI/AAAAAAABhRA/0AtBR80rNP0/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="235" src="http://1.bp.blogspot.com/-uCYC7R9TS8E/Vii2O8kylCI/AAAAAAABhRA/0AtBR80rNP0/s400/2.png" width="400" /></a></div><b><br /></b></div><div><br />The blink usb node requires RGB csv to represent a colour output. A node is used to map the generation 0 - &nbsp;7000 MW (currently!) to 0 - 255 RGB representation.&nbsp;</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-WlNB7c0DlW8/Vii2PYXKUBI/AAAAAAABhRQ/hNDNr07dFlg/s1600/4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://1.bp.blogspot.com/-WlNB7c0DlW8/Vii2PYXKUBI/AAAAAAABhRQ/hNDNr07dFlg/s400/4.png" width="390" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-GhZ2U4h9ckY/Vii2PiJSKlI/AAAAAAABhRM/4a-Vlm5vXoM/s1600/5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://4.bp.blogspot.com/-GhZ2U4h9ckY/Vii2PiJSKlI/AAAAAAABhRM/4a-Vlm5vXoM/s400/5.png" width="391" /></a></div><br /><br /><span style="font-family: Arial, Helvetica, sans-serif; font-size: xx-small;">[{"id":"98c24074.673dc","type":"emoncms-server","server":"http://emoncms.org","name":"emoncms UK windpower"},{"id":"5a3294d0.a5cd6c","type":"function","name":"Create RGB values CSV","func":"// convert to integer \n//var wind = +msg.payload;\n\n// green = 255 @ max wind output\nvar g = msg.payload\n\n// red = 255 @ zero wind output\nvar r= 255 - msg.payload\n\n// Round to whole number\ng = Number((g).toFixed(0));\nr = Number((r).toFixed(0));\n\nvar csv = r + \",\" + g + \",\" + 0;\nreturn {payload:csv};","outputs":1,"noerr":0,"x":617,"y":348,"z":"c0b0c402.3f4f38","wires":[["52d8719f.ad279","f3dd00d0.0c23"]]},{"id":"6ec040ed.913fc","type":"inject","name":"Trigger every 10min 7AM-11PM","topic":"","payload":"1445415635","payloadType":"string","repeat":"","crontab":"*/10 7-22 * * *","once":false,"x":297,"y":261,"z":"c0b0c402.3f4f38","wires":[["68f8d790.970728"]]},{"id":"52d8719f.ad279","type":"debug","name":"","active":false,"console":"false","complete":"false","x":878,"y":334,"z":"c0b0c402.3f4f38","wires":[]},{"id":"b5d43139.4a2bd","type":"inject","name":"Test 100MW","topic":"","payload":"100","payloadType":"string","repeat":"","crontab":"","once":false,"x":223,"y":421,"z":"c0b0c402.3f4f38","wires":[["2da76a85.d25896"]]},{"id":"9122dd65.6edd2","type":"inject","name":"Test 2000 MW","topic":"","payload":"2500","payloadType":"string","repeat":"","crontab":"","once":false,"x":225,"y":469,"z":"c0b0c402.3f4f38","wires":[["2da76a85.d25896"]]},{"id":"b5c8e6e5.4a3718","type":"inject","name":"Test 5000MW","topic":"","payload":"5000","payloadType":"string","repeat":"","crontab":"","once":true,"x":224,"y":514,"z":"c0b0c402.3f4f38","wires":[["2da76a85.d25896"]]},{"id":"f3dd00d0.0c23","type":"blink1","fade":"600","name":"Blink(1) USB","x":847,"y":440,"z":"c0b0c402.3f4f38","wires":[]},{"id":"68f8d790.970728","type":"emoncms in","name":"Get UK wind generation output from emoncm.org","emonServer":"98c24074.673dc","feedid":"67087","x":263,"y":343,"z":"c0b0c402.3f4f38","wires":[["2da76a85.d25896"]]},{"id":"2da76a85.d25896","type":"range","minin":"0","maxin":"6000","minout":"0","maxout":"255","action":"clamp","round":true,"name":"Range: Scale wind output to RGB value","x":551,"y":417,"z":"c0b0c402.3f4f38","wires":[["5a3294d0.a5cd6c"]]},{"id":"64a3fa26.9b5c04","type":"inject","name":"Turn off after 11PM","topic":"","payload":"0,0,0","payloadType":"string","repeat":"","crontab":"01 23 * * *","once":false,"x":613,"y":488,"z":"c0b0c402.3f4f38","wires":[["f3dd00d0.0c23"]]}]</span>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/10/emonpi-nodered-and-mqtt/">emonPi, NodeRed and MQTT</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-10-12T10:52:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-10-12 10:52:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> five minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/mqtt/'>MQTT</a></li>
      
        <li><a class='category' href='/categories/nodered/'>NodeRed</a></li>
      
        <li><a class='category' href='/categories/emonpi/'>emonPi</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/10/emonpi-nodered-and-mqtt/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    Using the <a href="http://openenergymonitor.org/emon/modules/emonpi">emonPi in it's default configuration</a> works great to post data to Emoncms for logging and visualisation. However there may be times when you want some more flexibility and or ability to interface with other hardware.<br /><br />Using a tool called <a href="http://nodered.org/">Node-Red</a> the emonPi can become a central hub for home automation, control and notification.&nbsp;Node-RED&nbsp;is a tool for wiring together hardware devices, APIs and online services in new and interesting ways. At the heart of Node-RED is a visual editor allowing complex data flows to be wired together with only a little coding skills. &nbsp;Here are some of my ideas of things I might like to achieve with Node-RED, For more inspiration check out&nbsp;<a href="http://www.youtube.com/watch?v=KPnwyTgZaS0&amp;t=29m18s">Martin's IoT Google hangout 29min in</a>:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-dLsVZfkrCk8/Vm2c8jR7OVI/AAAAAAABksA/oPCn7WCPE9U/s1600/node-red.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://4.bp.blogspot.com/-dLsVZfkrCk8/Vm2c8jR7OVI/AAAAAAABksA/oPCn7WCPE9U/s200/node-red.png" width="200" /></a></div><br /><ul><li>Send power consumption notifications to my phone using <a href="http://flows.nodered.org/node/node-red-node-pushover">Node-RED and Pushover</a></li><li>Send a notification to my phone when it's a good time to use power e.g <a href="https://gist.github.com/dceejay/6572686">national power demand </a>is low and grid renewable generation input is high</li><li>Use an emonTH as a room thermostat temperature input to control my heating using <a href="http://shop.openenergymonitor.com/three-channel-wifi-relay-thermostat/">WiFi MQTT relay board</a> (blog post coming soon... :-) )</li><li>Switch my heating on when I arrive home using <a href="https://harizanov.com/2015/03/making-ifttt-if-this-then-that-talk-to-node-red/">node-RED and IFTT</a>&nbsp;android / iOS location&nbsp;</li><li>Post energy data to another service e.g. thingspeak.com, pvoutput.org, xively.com etc..</li><li>Use <a href="http://flows.nodered.org/node/node-red-node-emoncms">node-RED to post data from other services to Emoncms</a>&nbsp;e.g <a href="https://gist.github.com/dceejay/6572686">national power demand</a>, home weather station, <a href="http://flows.nodered.org/node/node-red-node-openweathermap">weather forecast</a> &nbsp;</li><li>Periodically tweet my home power consumption or solar PV output</li><li>Set an email when you emonTH batteries run low (see example below)</li></ul><h3><b>Install Node-RED on emonPi / emonHub / Raspberry Pi&nbsp;</b></h3>Make emonPi file-system RW:<br /><i>$ rpi-rw</i><br /><br />Install Node-RED (taken from <a href="http://nodered.org/docs/hardware/raspberrypi.html">node-RED RaspberryPi install guide</a>):<br /><i>$ curl -sL https://deb.nodesource.com/setup_0.12 | sudo bash -&nbsp;</i><br /><i>$ sudo apt-get install -y build-essential python-dev python-rpi.gpio nodejs</i><br /><i>$ sudo npm install -g --unsafe-perm node-red</i><br /><i><br /></i>Open up port 1880 so we can access Node-RED editor:<br /><i>$ sudo iptables -A INPUT -p tcp -m tcp --dport 1880 -j ACCEPT</i><br /><i><br /></i>Open up port 1883 so we can access MQTT server:<br /><i>$ sudo iptables -A INPUT -p tcp -m tcp --dport 1883 -j ACCEPT</i><br /><i><br /></i>Make iptables rules persistent<br />$ apt-get install iptables-persistent<br /><br />Choose yes to save rules, if needed edit the persistent rules:<br />$ sudo nano /etc/iptables/rules.v4<br /><br /><i><br /></i>Start Node-RED with:<br /><i>$&nbsp;node-red-pi --max-old-space-size=128</i><br /><br />To view the node-RED graphical editor browse to:<br /><a href="http://emonpi:1880/">http://emonpi:1880/</a>&nbsp;(or use IP address if this does not work)<br /><br />To use Node-RED as a permanent setup you will want to <a href="https://gist.github.com/bigmonkeyboy/9962293">set it up as a service to autostart at boot</a>&nbsp;and e<a href="http://nodered.org/docs/security.html">nable secure authentication access to node-RED editor</a>.<br /><br />When you are done don't forget to put the emonPi back to read-only mode to preserve SD card lifespan:<br /><i>$ rpi-ro</i><br /><div><br /></div><h3><b>Getting data from the emonPi into Node-RED</b></h3>There are two options to get our energy data into Node-RED:<br /><br /><b>1. Real-time data from emonHub using MQTT (see example below):</b><br /><br /><a href="http://mqtt.org/">MQTT</a> is a lightweight communication protocol for small web-connected devices. The latest version of emonHub as setup on the emonPi (and emonHub from July 15) uses MQTT as a link to Emoncms and also to provide data to the emonPi LCD script. Since MQTT is already running all we need to do is to point Node-RED MQTT input block to subscribe to the <i>'emonhub/rx/#</i>' MQTT topic on port 1883. The '#' topic includes data received from all nodes. To subscribe to just one node use e.g. emonPi use: <i>'emonhub/5/values' </i>or '<i>emonhub/10/values'</i> for emonTx.<br /><br />To subscribe the the emonPi's MQTT topics externally (if your running node-RED on another machine) you will need to open up the MQTT port on the emonPi:<br /><br /><i>$&nbsp;sudo iptables -A INPUT -p tcp -m tcp --dport 1883 -j ACCEPT</i><br /><br /><b>2. Historic data from Emoncms using HTTP API:&nbsp;</b><br /><br />To pull historic data already logged to Emoncms (e.g KWh data) into Node-RED we can use Emoncms's API. Here is a simple example to pull in the latest value from the KWh feed, just enter your RW API key and feed ID:<br /><br /><a href="http://emoncms.org/feed/value.json&amp;apikey=APIKEY&amp;id=FEED_ID">http://emoncms.org/feed/value.json&amp;apikey=APIKEY&amp;id=FEED_ID</a><br /><br />To view all Emoncms API see:&nbsp;<a href="http://emoncms.org/input/api">http://emoncms.org/input/api</a><br /><br /><h3><b>Node-RED example: send warning email&nbsp;when&nbsp;emonTH battery is low</b></h3><b><br /></b>Simple but useful example, use Node-RED connecting to emonPi in real-time data via MQTT (localhost) and sending email (via Gmail SMTP) if emonTH battery drops below 1.7V. Also in this flow as an example is a node to decode emonPi power data. <br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-gfgkoEkv-HY/VhuGvzIzqOI/AAAAAAABg6Q/BUKxbYx6IG0/s1600/Screenshot%2B2015-10-12%2Bat%2B11.05.39.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="204" src="http://4.bp.blogspot.com/-gfgkoEkv-HY/VhuGvzIzqOI/AAAAAAABg6Q/BUKxbYx6IG0/s640/Screenshot%2B2015-10-12%2Bat%2B11.05.39.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Here is the contents of each node:&nbsp;</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-QdCMAYzfeZw/VhuGuzSG1fI/AAAAAAABg6M/b0b31YoUcPA/s1600/Node%2BRED%2B%2B%2Bemonpi.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="179" src="http://4.bp.blogspot.com/-QdCMAYzfeZw/VhuGuzSG1fI/AAAAAAABg6M/b0b31YoUcPA/s320/Node%2BRED%2B%2B%2Bemonpi.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">MQTT Node subscribing to emonhub mqtt topic on localhost (running node-RED on emonPi)</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-ANX-AiX1Vg0/VhuGvI8h5wI/AAAAAAABg6U/wNu2U69oiwU/s1600/Node%2BRED%2B%2B%2Bemonpi1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="293" src="http://4.bp.blogspot.com/-ANX-AiX1Vg0/VhuGvI8h5wI/AAAAAAABg6U/wNu2U69oiwU/s320/Node%2BRED%2B%2B%2Bemonpi1.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Separate node to split the MQTT data up into nodes based on ID: e.g emonTx = 10, emonPi = 5, emonTH = 19</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-wM8zp4WGrCk/VhuGvBsYP1I/AAAAAAABg6g/KJAxe8zI53M/s1600/Node%2BRED%2B%2B%2Bemonpi2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="375" src="http://4.bp.blogspot.com/-wM8zp4WGrCk/VhuGvBsYP1I/AAAAAAABg6g/KJAxe8zI53M/s400/Node%2BRED%2B%2B%2Bemonpi2.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">CSV node to split up MQTT CSV string</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-NemcPlwD1Ws/VhuGvVuEs6I/AAAAAAABg6Y/XkUBKmteqrE/s1600/Node%2BRED%2B%2B%2Bemonpi3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://4.bp.blogspot.com/-NemcPlwD1Ws/VhuGvVuEs6I/AAAAAAABg6Y/XkUBKmteqrE/s400/Node%2BRED%2B%2B%2Bemonpi3.png" width="361" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">If function node</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-1mzPm3DVvVU/VhuGvi-MFlI/AAAAAAABg6c/KCFuKqCADrE/s1600/Node%2BRED%2B%2B%2Bemonpi4.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="278" src="http://2.bp.blogspot.com/-1mzPm3DVvVU/VhuGvi-MFlI/AAAAAAABg6c/KCFuKqCADrE/s320/Node%2BRED%2B%2B%2Bemonpi4.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">email node, enter your Gmail (or otherwise) SMTP login</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div>Node-RED flow export, import by copy and pasting into import&gt;clipboard in Node-RED editor:<br /><br /><i><span style="font-size: xx-small;">[{"id":"eb57a13e.14a86","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":""},{"id":"44c7eefa.bb381","type":"mqtt in","name":"MQTT: emonhub/rx/#","topic":"emonhub/rx/#","broker":"eb57a13e.14a86","x":159,"y":386,"z":"fa6ca080.05936","wires":[["2c7fcc53.d38034","eb7e04d9.1481f8"]]},{"id":"2c7fcc53.d38034","type":"debug","name":"RAW MQTT output: emonhub/rx/#","active":false,"console":"false","complete":"topic","x":242,"y":461,"z":"fa6ca080.05936","wires":[]},{"id":"eb7e04d9.1481f8","type":"switch","name":"Seperate Nodes","property":"topic","rules":[{"t":"cont","v":"5"},{"t":"cont","v":"19"},{"t":"cont","v":"20"}],"checkall":"true","outputs":3,"x":343,"y":317,"z":"fa6ca080.05936","wires":[["b0618044.4f9e8"],["9077dea0.6f882"],[]]},{"id":"9077dea0.6f882","type":"csv","name":"emonTH 1: emonhub/19/values &gt; Decode MQTT CSV","sep":",","hdrin":"","hdrout":"","multi":"one","ret":"\\n","temp":"temp,temp_external,humidity,battery,pulsecount","x":664,"y":373,"z":"fa6ca080.05936","wires":[["75ee731f.8a118c"]]},{"id":"b0618044.4f9e8","type":"csv","name":"emonPi: emonhub/5/values &gt; Decode MQTT CSV","sep":",","hdrin":"","hdrout":"","multi":"one","ret":"\\n","temp":"power1,power2,power1_plus_2,Vrms,temp1,temp2,temp3,temp4,temp5,temp6,pulseCount","x":647,"y":236,"z":"fa6ca080.05936","wires":[["cda897fa.325768"]]},{"id":"cda897fa.325768","type":"debug","name":"Debug: emonPi Power1 output","active":false,"console":"false","complete":"payload.power1","x":1015,"y":235,"z":"fa6ca080.05936","wires":[]},{"id":"75ee731f.8a118c","type":"function","name":"If emonTH battery &lt; 1.7V","func":"if (msg.payload.battery &lt; 1.7) {\n &nbsp; return {payload:'WARNING: emonTH battery low &nbsp;'+msg.payload.battery+'V' &nbsp;};\n}","outputs":1,"noerr":0,"x":1015,"y":363,"z":"fa6ca080.05936","wires":[["f8d8fd72.0727"]]},{"id":"f8d8fd72.0727","type":"delay","name":"Limit 1 email per day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":948,"y":447,"z":"fa6ca080.05936","wires":[["1d4154b2.e2beab"]]},{"id":"1d4154b2.e2beab","type":"e-mail","server":"smtp.gmail.com","port":"465","name":"","dname":"Send warning email","x":1198,"y":439,"z":"fa6ca080.05936","wires":[]}]</span></i>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/09/china-shenzhen-electronic-market-hoperf/">China Shenzhen Electronic Market & HopeRF Factory Visit</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-09-21T02:06:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-09-21 02:06:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> six minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/china/'>China</a></li>
      
        <li><a class='category' href='/categories/manufacturing/'>manufacturing</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/09/china-shenzhen-electronic-market-hoperf/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <br />For the past two weeks I have been travelling out to the South of China from the UK via overland travel. I have always wanted to visit China but could not bring myself to justify the carbon impact of flying*. My journey took me from the UK to Moscow via European trains then the Trans Siberian Railway across Russia and Mongolia to China. It was a fantastic adventure, we broke up the travel by stopping off in various locations on route. I have posted a <a href="http://adventuresplusnorthwales.blogspot.co.uk/search/label/ChinaViaTrain">couple of blog posts</a> on my personal blog accounting the journey.<br /><br /><br />Even though at OpenEnergyMonitor we do most of our manufacturing and assembly locally in the UK there are many components that are only possible to source in China e.g CT sensors, power adapters and RF modules. In fact most electronic components originate in some way from a factory in China. Even though we do our SMT assembly and PCB fabrication in the UK we still rely heavily on Chinese manufacturing. For heavy items like power adapters and CT sensors we purchase in bulk (pallet load) and ship via ocean freight rather than air cargo to reduce carbon footprint.<br /><br />I wanted to visit China to experience the culture and see for myself the working conditions in the factories that supply some of the components we use. No doubt attempting to trace back every factory and company in a supply chain for a complex items such as electronic components is a big task, something large corporation (think Apple and Samsung) have struggled with. We have all heard the <a href="http://www.theguardian.com/technology/2012/mar/30/apple-factories-china-foxconn-audit">horror stories</a> of overworked and under-age employees in Chinese electronic factories. <br /><br />My epic train ride to China rolled me into the North of China and Beijing first. After being a tourist for a day and visiting the very 'great' Great Wall of China I took a fast train down to Shenzhen. This train was seriously impressive, cruising at a smooth 307 Km/hr. I was glued to the window watching countryside and cities larger than London that I had not heard of fly by. I was aware that China is home to many, many people however this was really evident looking out the window watching huge cities and row upon row of skyscrapers flash by. In every town town and city it seemed many more tower blocks were in the process of being built, there is no doubt that China is undergoing an economic boom. After 8hrs of fast train blur we arrived in Shenzhen, nicknamed together with it's neighbouring city Guangzhou as the&nbsp;‘factory of the world’; it's almost certain that the laptop/tablet/phone you are using to read this was made in factories in these cities.<br /><div><br /></div><div>During my time in Shenzhen I visited the world's largest electronic component market and the HopeRF factory where the RFM12B and RFM69CW RF modules that we use are designed and manufactured. I didn't manage to visit the factory where our CT sensors are manufactured since this factory was located in the north of China, however I did <a href="http://openenergymonitor.blogspot.com/2014/07/how-ct-sensors-are-made.html">post up some photos</a>&nbsp;I was sent from inside the factory a while back.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-PLBuhsOl6b0/VfhA7o764xI/AAAAAAABiIk/Pj7svsMAx-0/s1600/a_electronic_market_shenzhen.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://2.bp.blogspot.com/-PLBuhsOl6b0/VfhA7o764xI/AAAAAAABiIk/Pj7svsMAx-0/s640/a_electronic_market_shenzhen.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-size: 12.8px;">Electronic component market in downtown Shenzhen (I'm pictured with the seller of encapsulated DS18B20 temperature sensors that we stock)</span></td></tr></tbody></table><br /></div><div><br /></div><div>Visiting the electronics market in downtown Shenzhen was a fantastically crazy experience. It was amazing to see all types of components carefully organised under the glass counters. There is something satisfyingly tactile about being able to hold different types of connectors and switches to compare quality and dimensions and chat to the seller about the pros, cons and cost of each item. Assuming you could speak Mandarin shopping for components here would be a far more social experience than an online parametric search tool! Obviously prices for these components are significantly cheaper than in the West.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div>Before I started working in electronic manufacture I assumed (like I think many people do) that most electronic manufacture is performed by robots. This is mainly true for pick-and-place assembly, however there are many more manufacturing steps which require significant human effort such as thru-hole soldering, testing and final assembly.<br /><br />I am happy to report that the HopeRF I visited was clean, air conditioned and all employees were at least the minimum age, paid at least the minimum wage and worked 8am - 6pm with a 2hr lunch / siesta break. Overtime is common but employees are paid accordingly. All employees I met seems happy, although I did happen to arrive just as they were leaving on their lunch break! On the wall in the corridor there was a notice board with photos showing various company employee group outings including activities such as hill walking, running, swimming and group dinners. I also noticed an employee suggestion box.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-MvZ5YPP_Ch0/VhDnvOyJyrI/AAAAAAABgYY/OfpSZlkQC_4/s1600/b_HopeRF_factory.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://4.bp.blogspot.com/-MvZ5YPP_Ch0/VhDnvOyJyrI/AAAAAAABgYY/OfpSZlkQC_4/s640/b_HopeRF_factory.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Hope RF Factory Visit</td></tr></tbody></table><br /><br />I did get a chance to speak to an engineer at Hope RF who is involved in the design of new modules. As I had presumed the RFM69CW using a more standard IC package is much more suited to reflow soldering and less susceptible to humidity ingression than the older RFM12B design that often used a 'black blob' IC package. Second photo down on the left shows a naked RFM12B before receiving it's 'blob' dressing! Interestingly I learned (and witnessed!) that each and every single module is hand tested before leaving the factory. Modules that fail the test are debugged by hand. I was told that they have no plans to halt manufacture of the older RFM12B modules as long as there is demand.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-V4wMyZqIQtk/VfhA6uNNyKI/AAAAAAABeAA/F42ios1SfkI/s1600/b_HopeRF_factory.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://4.bp.blogspot.com/-V4wMyZqIQtk/VfhA6uNNyKI/AAAAAAABeAA/F42ios1SfkI/s640/b_HopeRF_factory.jpg" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">HopeRF factory in Shenzhen where RF modules are designed, manufactured &amp; tested.</td></tr></tbody></table><br /><br /><br />* Travelling via train emits 80-90% less carbon then flying [Source: <a href="http://www.seat61.com/CO2flights.htm">http://www.seat61.com/CO2flights.htm</a>].<br /><br />The international 'safe' level of emissions per person is around 2T/yr to contain global temperature changes at or below 2 deg C which will 'hopefully' keep runway climate change and subsequent rise in sea levels at bay. Return fight from London to Málaga will emit 2/3T of carbon per person<br /><br />6.5T to Auckland Australia or 2T to New York. [Source: <a href="http://www.lowcarbontravel.com/">Only Planet, Ed Gillespie 2014</a>]</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/09/how-to-setup-wifi-hotspot-on-emonpi/">Using emonPi Offline: How to setup a WIFI Hotspot on an emonPi</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-09-09T16:58:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-09-09 16:58:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 10 minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonpi/'>emonPi</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/09/how-to-setup-wifi-hotspot-on-emonpi/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    This guide details how to setup a WIFI Hotspot using the Edimax USB WIFI adapter on an EmonPi or EmonBase to make it possible to connect directly to an EmonPi from a tablet or computer without the need for a router or internet connection.<br /><br />The guide is based on <a href="http://www.daveconroy.com/turn-your-raspberry-pi-into-a-wifi-hotspot-with-edimax-nano-usb-ew-7811un-rtl8188cus-chipset">Dave Conroy's guide</a> here but also covers setting up a DHCP server rather than ethernet to WIFI bridge.<br /><br />There are 3 pieces of software that need to be installed to get this to work:<br /><ul><li>hostapd – WIFI Hotspot</li><li>edimax version of hostapd</li><li>isc-dhcp-server – DHCP Server</li></ul><b>1) Install dhcp server&nbsp;</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sudo apt-get install isc-dhcp-server&nbsp;</span><br /><br /><b>2) Install Edimax version of hostapd</b><br /><br />Either use precompiled binary or compile yourself:<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><b>Pre-compiled (update: does not seem to work with&nbsp;</b></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><b>wheezy, use self compile see below)</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wget http://www.daveconroy.com/wp3/wp-content/uploads/2013/07/hostapd.zip</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>unzip hostapd.zip <br />sudo mv /usr/sbin/hostapd /usr/sbin/hostapd.bak<br />sudo mv hostapd /usr/sbin/hostapd.edimax <br />sudo ln -sf /usr/sbin/hostapd.edimax /usr/sbin/hostapd <br />sudo chown root.root /usr/sbin/hostapd <br />sudo chmod 755 /usr/sbin/hostapd</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><b>Compile yourself (recommended&nbsp;for&nbsp;wheezy, tested March16)</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><i style="font-family: 'courier new', courier, monospace; font-size: small;">sudo apt-get install libnl-genl-3-dev libnl-3-dev</i><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>git clone https://github.com/lostincynicism/hostapd-rtl8188</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>cd hostapd-rtl8188/hostapd</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>sudo make</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>sudo make install&nbsp;</i></span><br /><br /><b>3) Configure /etc/network/interfaces</b><br /><br />Open the network interfaces file to edit:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">sudo nano /etc/network/interfaces </span><br /><br />Replace content with:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">auto lo</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iface lo inet loopback</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">auto eth0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">allow-hotplug eth0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iface eth0 inet manual</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">#allow-hotplug wlan0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">#iface wlan0 inet manual</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"># &nbsp; &nbsp;wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iface wlan0 inet static</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">address 192.168.42.1</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">netmask 255.255.255.0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">allow-hotplug eth1</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iface eth1 inet dhcp</span><br /><br />If required add bridge to bridge eth0 to wlan0 - although it's better to use NAT iptables forwarding since then we can still access pi via ssh (see below)<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">auto br0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iface br0 inet dhcp</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">bridge_ports eth0 wlan0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">pre-up ifconfig eth0 0.0.0.0 up</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">pre-up ifconfig wlan0 0.0.0.0 up</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">pre-up brctl addbr br0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">pre-up brctl addif br0 eth0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">post-down ifconfig wlan0 0.0.0.0 down</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">post-down ifconfig eth0 0.0.0.0 down</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">post-down brctl delif br0 eth0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">post-down brctl delbr br0</span><br /><br /><b>4) Configure /etc/hostapd/hostapd.conf</b><br />Open hostapd config file with:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">sudo nano /etc/hostapd/hostapd.conf</span><br /><br />Add the following lines to hostapd.conf (set SSID and password of your choice)<br /><b><br /></b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><b>WITHOUT AUTHENTICATION &nbsp;USE</b></i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><b><br /></b></i></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>interface=wlan0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>ssid=emonPi</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>driver=rtl871xdrv</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>hw_mode=g</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>channel=6</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>auth_algs=1</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wmm_enabled=0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><b><br /></b></i></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><b>WITH_AUTENTICATION USE</b></i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><b><br /></b></i></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>interface=wlan0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>driver=rtl871xdrv</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>ssid=emonPi</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>hw_mode=g</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>channel=6</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>macaddr_acl=0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wmm_enabled=0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>auth_algs=1</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>ignore_broadcast_ssid=0</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wpa=2</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wpa_passphrase=raspberry</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wpa_key_mgmt=WPA-PSK</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>wpa_pairwise=TKIP</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>rsn_pairwise=CCMP</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><br /><br />Manual start to test everything is working, you should see a Wifi network called 'emonPi':<br /><br /><i>$ sudo hostapd -dd /etc/hostapd/hostapd.conf</i><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><br /><br /><br /><b>5) Configure /etc/default/hostapd</b><br /><b><br /></b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">sudo nano /etc/default/hostapd</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><br />Set<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">DAEMON_CONF="/etc/hostapd/hostapd.conf"</span><br /><br /><br /><b>6) Configure /etc/dhcp/dhcpd.conf</b><br />Open dhcpd config file:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">sudo nano /etc/dhcp/dhcpd.conf</span><br /><span style="font-size: x-small;"><br /></span><span style="font-size: x-small;">Add the following to the end of the file:</span><br /><span style="font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">lease-file-name "/home/pi/data/dhcpd.leases";</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">subnet 192.168.42.0 netmask 255.255.255.0 {</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; range 192.168.42.2 192.168.42.20;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; option broadcast-address 192.168.42.255;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; option routers 192.168.42.1;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; default-lease-time 600;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; max-lease-time 7200;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; option domain-name "local";</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; option domain-name-servers 8.8.8.8, 8.8.4.4;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">}</span><br /><br />comment out <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>#option domain-name "example.org";</i></span><br /><i><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"></span></i><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>#option domain-name-servers ns1.example.org, ns2.example.org;</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i><br /></i></span>uncomment<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">authoritative;</span><br /><br /><b>7) Configure /etc/default/isc-dhcp-server</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sudo nano /etc/default/isc-dhcp-server&nbsp;</span><br /><br />Remove the comment from DHCPD_CONF, DHCPD_PID and then set the INTERFACES to "wlan0" (including ""), see example below:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"># Defaults for isc-dhcp-server initscript <br /># sourced by /etc/init.d/isc-dhcp-server <br /># installed at /etc/default/isc-dhcp-server by the maintainer scripts <br /># <br /># This is a POSIX shell fragment <br /># <br /><br /># Path to dhcpd's config file (default: /etc/dhcp/dhcpd.conf). <br />DHCPD_CONF=/etc/dhcp/dhcpd.conf <br /><br /># Path to dhcpd's PID file (default: /var/run/dhcpd.pid). <br />DHCPD_PID=/var/run/dhcpd.pid <br /><br /># Additional options to start dhcpd with. <br />#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Don't use options -cf or -pf here; use DHCPD_CONF/ DHCPD_PID instead <br />#OPTIONS="" <br /><br /># On what interfaces should the DHCP server (dhcpd) serve DHCP requests? <br />#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Separate multiple interfaces with spaces, e.g. "eth0 eth1". <br />INTERFACES="<b>wlan0</b>"</span><a href="http://askubuntu.com/questions/140126/how-do-i-configure-a-dhcp-server"></a><br /><b><br /></b><b><br /></b><b>8.) Setup NAT forwarding to bridge eth0 the wlan0 while still allowing us to access the Pi via SSH (pure network bridge does not)</b><br /><br />To set this up automatically on boot, edit the file /etc/sysctl.conf and add the following line to the bottom of the file:<br /><br /><i>net.ipv4.ip_forward=1</i><br /><br />Second, to enable NAT in the kernel, run the following commands:<br /><br /><i>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</i><br /><div><i>sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT</i></div><i></i><div><i>sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT</i></div><i><div><br /></div></i><br /><div><b><i>If bride is also required to eth1 (for 3G dongle) add:</i></b><br /><i>sudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</i></div><div><i>sudo iptables -A FORWARD -i eth1 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT<br />sudo iptables -A FORWARD -i wlan0 -o eth1 -j ACCEPT</i><br /><br /><br /><br />sudo sh -c "iptables-save &gt; /etc/iptables.ipv4.nat"<br /><br />Now edit the file /etc/network/interfaces and add the following line to the bottom of the file:<br /><br />up iptables-restore &lt; /etc/iptables.ipv4.nat # This did not work for me I had to add entry to rc.local (see below)<br /><br /><b>8) Edit /etc/rc.local</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">sudo nano /etc/rc.local </span><br /><br />Add before exit 0 the following lines to tell the wlan interface to use ip address 10.0.1.1 and then start the isc-dhcp-server:<br /><br /><i>sudo iptables-restore &lt; /etc/iptables.ipv4.nat</i><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>sudo ifconfig wlan0 192.168.42.1</i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i></i></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><i>sudo service isc-dhcp-server restart</i></span><br /><pre style="-webkit-user-select: text; position: absolute; top: -99px;">sudo iptables-restore &lt; /etc/iptables.ipv4.nat</pre><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span></span><br /><b><br />9) Start services at boot </b><br /><br /><i>sudo update-rc.d isc-dhcp-server defaults<br />sudo update-rc.d hostapd defaults</i><br /><br /><br />Thats it restart your emonpi/emonbase to finish and then connect to network emonPi with password: raspberry <br /><br /><b>11) Add a Real Time Clock (RTC)</b><br />When running an emonPi in offline mode we recommend adding a hardware RTC to ensure the system time is always correct. See <a href="http://wiki.openenergymonitor.org/index.php?title=EmonPi#Adding_a_Real_Time_Clock_.28RTC.29">emonPi Wiki:</a><br /><br /><b><br /></b><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://wiki.openenergymonitor.org/images/EmonPi_RTC.JPG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://wiki.openenergymonitor.org/images/EmonPi_RTC.JPG" height="191" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Hardware RTC</td></tr></tbody></table><b><br /></b><b><br /></b><b><br /></b><b><br /></b><b><br /></b><b>Resources&nbsp;</b><br />Useful blogs, guides and forum threads that I used to work out how to set up the above:<br /><a href="http://www.daveconroy.com/turn-your-raspberry-pi-into-a-wifi-hotspot-with-edimax-nano-usb-ew-7811un-rtl8188cus-chipset">http://www.daveconroy.com/turn-your-raspberry-pi-into-a-wifi-hotspot-with-edimax-nano-usb-ew-7811un-rtl8188cus-chipset</a><br /><a href="http://askubuntu.com/questions/140126/how-do-i-configure-a-dhcp-server">http://askubuntu.com/questions/140126/how-do-i-configure-a-dhcp-server</a><br /><a href="http://ubuntuforums.org/showthread.php?t=2068111">http://ubuntuforums.org/showthread.php?t=2068111</a><br /><a href="http://raspberrypi.stackexchange.com/questions/9678/static-ip-failing-for-wlan0">http://raspberrypi.stackexchange.com/questions/9678/static-ip-failing-for-wlan0</a><br /><a href="https://forums.opensuse.org/showthread.php/438756-DHCP-can-t-write-to-dhcpd-leases">https://forums.opensuse.org/showthread.php/438756-DHCP-can-t-write-to-dhcpd-leases</a><br /><a href="http://elinux.org/RPI-Wireless-Hotspot">http://elinux.org/RPI-Wireless-Hotspot</a><br /><a href="http://askubuntu.com/questions/140126/how-do-i-configure-a-dhcp-server">http://askubuntu.com/questions/140126/how-do-i-configure-a-dhcp-server</a><br />http://www.instructables.com/id/Raspberry-Pi-as-a-3g-Huawei-E303-wireless-Edima/?ALLSTEPS<br /><br /><br /></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/09/pulse-counting-with-rfm69pi-and/">Pulse counting with the RFM69PI and RaspberryPi EmonBase basestation</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-09-06T21:08:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-09-06 21:08:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonbase/'>emonBase</a></li>
      
        <li><a class='category' href='/categories/optical-pulse/'>optical pulse</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/09/pulse-counting-with-rfm69pi-and/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    The latest version of the RFMPi Adapter board made much of the spare digital and analog IO available for use directly on the RFMPi adapter board. D3 is one of the digital inputs available and can have an interrupt attached (INT 1) which makes it useful for pulse counting.<br /><br />By connecting a<a href="http://shop.openenergymonitor.com/optical-utility-meter-led-pulse-sensor/"> optical pulse sensor</a> directly to the <a href="http://shop.openenergymonitor.com/emonbase-raspberry-pi-web-connected-base-station/">rfm69pi adapter board</a> this can make a relatively low cost solution for internet connected pulse counting (or local logging to emoncms running on the raspberrypi). <br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-EScDwqHXgyw/VeylN7yKW2I/AAAAAAAAT2w/HzWr5pXAwMg/s1600/rfmpi_pulse.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="223" src="http://3.bp.blogspot.com/-EScDwqHXgyw/VeylN7yKW2I/AAAAAAAAT2w/HzWr5pXAwMg/s400/rfmpi_pulse.JPG" width="400" /></a></div><br /><b>Setup</b><br /><br />1) The RJ45 connector on the optical pulse counter needs to be removed and individual wires exposed. Connect the red wire to 3.3V, the black wire to GND and the blue wire to D3:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-svvRwhAQZc4/VeylOJ16QRI/AAAAAAAAT20/2s3CJ9OcOlw/s1600/rfmpi_pulse_connections.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="300" src="http://4.bp.blogspot.com/-svvRwhAQZc4/VeylOJ16QRI/AAAAAAAAT20/2s3CJ9OcOlw/s400/rfmpi_pulse_connections.JPG" width="400" /></a></div><br />2) To use the rfm69pi adapter with pulse counting the pulse counting firmware needs to be uploaded to the rfm69pi adapter board, the steps to upload this firmware are:<br /><ol><li>SSH into your raspberrypi running the standard OpenEnergyMonitor image.</li><li>Place raspberrypi in write mode: <br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ rpi-rw</span></li><li>Stop emonhub: <br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo service emonhub stop</span></li><li>Pull in latest changes to RFM2PI git directory: <br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ cd RFM2PI<br />$ git pull</span></li><li>Upload pulse counting firmware:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ avrdude -v -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 38400 -U flash:w:/home/pi/RFM2Pi/firmware/RFM69CW_RF_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328_Pulse/RFM69CW_RF12_Demo_ATmega328_Pulse.cpp.hex</span></li><li>Start emonhub:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ sudo service emonhub start</span></li></ol>Next login to the local emoncms installation on the raspberrypi and navigate to the emonhub.conf editor. Add the following node definition in the nodes section of emonhub.conf:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[[15]]<br />&nbsp;&nbsp;&nbsp; nodename = rfmpi_pulse<br />&nbsp;&nbsp;&nbsp; firmware = RFM69CW_RF12_Demo_ATmega328_Pulse<br />&nbsp;&nbsp;&nbsp; hardware = rfm69pi<br />&nbsp;&nbsp;&nbsp; [[[rx]]]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; names = power,count<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; datacodes = h,L<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scales = 1,1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; units = W,Wh&nbsp;</span><br /><br />The pulse count is accumulated on the rfm69pi until the rfm69pi is reset either by an outage or by turning off and on the power.<br /><br />To record the total accumulated pulse count in emoncms use the  wh_accumulator input process which detects resets continuing the total  pulse count accumulation from the last value before the reset.
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/09/at-watt-cost-review-of-emonpi-raspberry/">At Watt Cost? A review of the emonPi Raspberry Pi based energy monitor</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-09-04T15:10:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-09-04 15:10:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> 13 minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonpi/'>emonPi</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/09/at-watt-cost-review-of-emonpi-raspberry/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 18.666666666666664px; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">At Watt Cost ?</span></div><h3 style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.6667px; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><i>A review of the emonPi, a Raspberry Pi based energy monitoring system developed by OpenEnergyMonitor, by <a href="https://twitter.com/irlionel">Lionel Smith</a> : </i></span></h3><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><i><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.6667px; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Measurement is the first step that leads to control and eventually to improvement</span><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.6667px; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. If you can’t measure something, you can’t understand it. If you can’t understand it, you can’t control it. If you can’t control it, you can’t improve it.” </span></i><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">― H. James Harrington</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><img alt="emoncms_solarPV_laptop_mobile.png" height="335px;" src="https://lh4.googleusercontent.com/FSDua1EX8hwKoqYpyipDLNH-c9JjigVa5wmOBUH8XwV0xqRBNCk5M4C0DhrYIxBcrvP0ENLcnKr-Ps4voKdXI_QM_MKFkDwz4NSBWv3V_VzLe5XtS0U14VkJx4J0Q3zL6kSiCJw" style="border: none; transform: rotate(0rad);" width="602px;" /></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Do we know how much electricity can be saved by using low energy lighting such as LED's or how much electricity is saved by turning off lighting when not in use?</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Finding out how much electricity is being used by one or all of your appliances, is the first step in being able to cut down on consumption, and in doing so spend less on electricity. It goes without saying that reducing your consumption equates to doing your bit towards creating a sustainable world. </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Glyn Hudson, Trystan Lea and the rest of the team at </span><a href="http://openenergymonitor.org/" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">OpenEnergyMonitor.org</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> have developed some monitoring technology to help us understand and optimise our energy consumption and generation. This allows us to approach the problem of energy consumption in a logical and informed way.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The Raspberry Pi isn't great at measuring analogue voltages, so various Arduino based measurement boards have been developed which process and digitise the inputs and transfer them to the Pi. </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In early 2014 an idea was born to create a shield which plugged directly onto a Raspberry Pi to make a single unit energy monitoring solution, primarily aimed at domestic users. A whole bunch of discussions and a fair amount of blood, sweat and tears culminated in a </span><a href="https://www.kickstarter.com/projects/openenergymonitor/emonpi-open-hardware-raspberry-pi-based-energy-mon" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">Kickstarter campaign</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> which raised £24,723 to help bring the project to life</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">This piece of kit is dubbed the emonPi, which is a Raspberry Pi based, open-source, web-connected, energy &amp; environmental monitor. This unit gives you the ability to measure home energy, solar PV, heatpump generation and temperature.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><img alt="emonPi_MyElectric_Daffs.JPG" height="452px;" src="https://lh5.googleusercontent.com/eiPQWuAtp9R9R8VOjaSv2TPwYXRj2D9vtDQUJl2p7qYykBRrpGLpn4PKgt3riBqPC-SAFr1Kwt-8rnaD8W_M1lDoVEys_urRtx3dYhaFKrb1YtpqTb8usAUM1pdNtNCnDO4Yg9Fk" style="border: none; transform: rotate(0rad);" width="602px;" /></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Everything on the site is fully open-source, which means you are free to tinker and improve to suit your needs. There is a very active community so help is readily available.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Aside from the obvious current and voltage values, temperature and humidity can also be measured by adding the appropriate nodes. All this information is then formatted on the Pi and either stored locally or uploaded via an Internet connection to a hosted application called EmonCMS. </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Once you've built up some data, various visualisations can be applied to create some really informative graphs. </span><br /><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-5Zvy6qVObaM/VemzJ06LFOI/AAAAAAABdWY/EIVz8qafdio/s1600/emoncms_dashboards.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="297" src="http://4.bp.blogspot.com/-5Zvy6qVObaM/VemzJ06LFOI/AAAAAAABdWY/EIVz8qafdio/s640/emoncms_dashboards.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Emoncms MyElectric and SolarPV Dashboards</td></tr></tbody></table></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The emonPi is available in both kit form or as a complete unit. Complete units are housed in a professional looking case sourced from Lincoln Binns. Even if you can’t resist the urge to experiment and order your system in kit form, it is highly recommended that you order the aluminium case to house the finished unit in. Aside from protecting everything inside, the case really gives the unit a polished, professional look.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Inside the case you will find a standard Raspberry Pi 2, the GPIO serial connected Arduino measurement shield and an I2C connected 2 x 16-character display.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><img alt="Emonpibare (1).png" height="322" src="https://lh5.googleusercontent.com/yA_duDSWg-ocGt9Rolim0p7rdi5sMTZtLtR6WX_jc62IiRBvw2r1yfZ8sFPvUYl--9tP0ImpYc2HgNl9K-_34HeQJ4qCm6O8aabOZUwlKCvKasCE55HGIjn8MpJ7n0GDQm1Kym-ZJns7EyO7" style="-webkit-transform: rotate(0.00rad); border: none; transform: rotate(0.00rad);" width="400" /></span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The unit contains built in 433Mhz low power RF which is used for communicating with its external nodes. These nodes can be used to add additional power readings (emonTx) or remote temperature and humidity (emonTH) . </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Fire up the system with a LAN cable plugged in and the on board display conveniently displays its IP address. Punch that into your favourite browser ( on a PC in the same LAN ) and you get to the login page. Once logged in, you are able to setup the WiFi if you have added an external USB WiFi adapter.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The built in 16 x 2 display will also confirm the status of connected devices. In order to measure temperature, an optional DS18B20 temperature sensor needs to be connected. The emonPi can talk to multiple (up to 6) of these sensors as they are individually addressable. </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Power can be measured using a clip-on CT current sensor and a 9VAC reference supply. You can cheat and omit the 9VAC supply input resulting in the AC voltage being fixed in the software, but then you are not reading true Real Power or Power Factor, so this is not recommended. If measuring solar PV two clip-on CT sensors are required and the 9VAC voltage input is essential as it's required to tell the unit if you generating or consuming power. The second CT can be used to isolate a particular load and see how much that draws. As an example CT 1 could be measuring the total of your house while CT 2 could tell you how much just your water heater or stove uses.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Another method to measure power is to use an optical pulse counter sensor that picks up the LED flashes generated by most modern electricity and gas meters.</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Being able to visualise the power used by your appliances gives a whole new insight into the power needed to run them. The author used the system to evaluate the claims made by the supplier of a hot water boiler control unit that only allows the boiler to heat the water 3 times a day based on your predicted usage. Using the emonPi and Emoncms system it was easy to see exactly how much saving was achieved after installing the control unit. </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The emonPi is a fantastic piece of kit and well worth having if you would like to contribute towards a greener future.</span></div><b style="font-weight: normal;"><br /></b><br /><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Weblinks for more information:</span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Home Page –<a href="https://www.blogger.com/goog_615289264"><span id="goog_615289265"></span> </a></span><a href="https://www.blogger.com/"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://openenergymonitor.org/</span><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> <span id="goog_615289266"></span></span></a></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">emonPi User Guide - </span><a href="http://openenergymonitor.org/emon/modules/emonpi" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">http://openenergymonitor.org/emon/modules/emonpi</span></a></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Wiki - </span><a href="http://wiki.openenergymonitor.org/" style="text-decoration: none;"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://wiki.openenergymonitor.org</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Shop - </span><a href="http://shop.openenergymonitor.com/" style="text-decoration: none;"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://shop.openenergymonitor.com/</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">User Forum - </span><a href="http://openenergymonitor.org/emon/forum" style="text-decoration: none;"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://openenergymonitor.org/emon/forum</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Blog - </span><a href="http://openenergymonitor.blogspot.com/" style="text-decoration: none;"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://openenergymonitor.blogspot.com/</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></div><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Emoncms - </span><a href="http://emoncms.org/" style="text-decoration: none;"><span style="background-color: transparent; color: #666600; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">http://emoncms.org</span></a><span style="background-color: transparent; color: black; font-family: Calibri; font-size: 14.666666666666666px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></div><b style="font-weight: normal;"><br /></b><br /><div dir="ltr" style="line-height: 1.295; margin-bottom: 8pt; margin-top: 0pt;"><span style="background-color: transparent; color: red; font-family: Calibri; font-size: 14.6667px; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><b>Safety Warning: Interfacing with mains voltages can be potentially lethal. If you are not competent, or not sure of what you are doing rather seek the assistance of a qualified professional.</b></span></div><br />
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/09/optical-pulse-counting-with-emonth/">Optical pulse counting with the EmonTH</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-09-02T12:53:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-09-02 12:53:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonth/'>emonTH</a></li>
      
        <li><a class='category' href='/categories/optical-pulse/'>optical pulse</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/09/optical-pulse-counting-with-emonth/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <style type="text/css">p { margin-bottom: 0.25cm; line-height: 120%; }</style>  <br /><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">In addition to temperature and humidity sensing the <a href="http://openenergymonitor.org/emon/modules/emonTH">EmonTH</a> has a digital input (with interrupt) that can be used for pulse counting.   </div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">This can be used for <a href="http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-counting">wired pulse counting</a> or with the <a href="http://shop.openenergymonitor.com/optical-utility-meter-led-pulse-sensor/">Optical LED pulse sensor</a>.</div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">To use the Optical LED Pulse sensor the easiest way is to remove the RJ45 connector and then strip back the black sheathing to reveal the red (3.3V power), black (GND) and blue (pulse) wires.</div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">Connect the red wire to the 3.3V terminal, the black wire to the GND terminal and the blue wire to the terminal labelled D3 (top) or IRQ1/D3 Pulse Counting (bottom of the board).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://wiki.openenergymonitor.org/images/thumb/Emonth_pulse.jpg/1600px-Emonth_pulse.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://wiki.openenergymonitor.org/images/thumb/Emonth_pulse.jpg/1600px-Emonth_pulse.jpg" height="347" width="640" /></a></div><br /></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Mq6ZFJuLqcc/VebtplQo9rI/AAAAAAAAT14/NtBwwglgdxo/s1600/SAM_1228.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://3.bp.blogspot.com/-Mq6ZFJuLqcc/VebtplQo9rI/AAAAAAAAT14/NtBwwglgdxo/s320/SAM_1228.JPG" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-JKBIFoch2cU/VebtpvkXfcI/AAAAAAAAT18/4NYrBdD0Nlo/s1600/SAM_1229.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://2.bp.blogspot.com/-JKBIFoch2cU/VebtpvkXfcI/AAAAAAAAT18/4NYrBdD0Nlo/s320/SAM_1229.JPG" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-rIL3qPNNzt0/VebtpevfL6I/AAAAAAAAT10/ooswSPyzU_g/s1600/SAM_1230.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="480" src="http://1.bp.blogspot.com/-rIL3qPNNzt0/VebtpevfL6I/AAAAAAAAT10/ooswSPyzU_g/s640/SAM_1230.JPG" width="640" /></a></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div>There are two firmware examples available for the EmonTH for pulse counting, the first is for Pulse counting in addition to DHT22 Temperature + Humidity sensing or DS18B20 temperature sensing:<br /><a href="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse">https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse</a><br /><br />The second is for pulse counting only if the temperature and humidity sensing is not needed:<br /><a href="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_pulse_lowpower">https://github.com/openenergymonitor/emonTH/tree/master/emonTH_pulse_lowpower</a><br /><br />To upload these firmware examples you will need the <a href="http://openenergymonitor.org/emon/buildingblocks/setting-up-the-arduino-environment">Arduino IDE and libraries installed</a> and a <a href="http://shop.openenergymonitor.com/programmer-usb-to-serial-uart/">USB to serial programmer</a> to upload the firmware to the EmonTH.<br /><br />The pulse count is accumulated on the EmonTH until the EmonTH is reset either by an outage or by turning off and on the power.<br /><br />To record the total accumulated pulse count in emoncms use the wh_accumulator input process which detects resets continuing the total pulse count accumulation from the last value before the reset.
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2015/08/3ch-wifi-relay-control-board/">3CH WiFi Relay Control Board</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-08-22T12:38:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-08-22 12:38:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> eight minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/esp8266/'>ESP8266</a></li>
      
        <li><a class='category' href='/categories/control/'>control</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/08/3ch-wifi-relay-control-board/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;">We have recently started stocking in the shop a Three Channel WiFi Relay / Thermostat Board designed by our friend <a href="https://harizanov.com/">Martin&nbsp;Harizanov</a>.</span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;">The board has been well designed to physically separate high voltage AC mains from the low voltage logic. The board has an optional power supply to enable the board to be powered directly from 100-240V AC. A wall-mountable plastic enclosure is included.&nbsp;</span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif;"><span style="font-size: 12.8px; line-height: 16.64px;">The board can be used to control a heating / AC /&nbsp;humidifier via local control loop from on-board sensor. The unit can be programmed with a schedule and or manually&nbsp;controlled&nbsp;via web UI via WIFI. Sensor&nbsp;data and relay status can be posted to <a href="http://emoncms.org/">Emoncms</a> for logging and graphing.&nbsp;</span></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><strong style="background-color: white; color: red; font-size: 12.8px; line-height: 16.64px; margin: 0px; outline: none; padding: 0px;">NOTE: The board connects to and controls high voltage, knowledge and attention&nbsp;is required when installing to prevent electrical shock.</strong></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><strong style="background-color: white; color: red; font-size: 12.8px; line-height: 16.64px; margin: 0px; outline: none; padding: 0px;"><br /></strong></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif;"><span style="background-color: white; font-size: 12.8px; line-height: 16.64px;"><b><u>Overview</u></b></span></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;"><strong style="background-color: white; color: red; font-size: 12.8px; line-height: 16.64px; margin: 0px; outline: none; padding: 0px;"><br /></strong></span></div><div class="separator" style="clear: both; text-align: left;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;">The relay board is a open software/hardware multi-purpose relay board based on the&nbsp;</span><a href="https://espressif.com/en/products/esp8266/" style="color: #3399cc; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; font-weight: bold; line-height: 1.3; margin: 0px; outline: none; padding: 0px;" target="_blank">ESP8266</a><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; margin: 0px; outline: none; padding: 0px;">&nbsp;WiFi SoC. It can&nbsp;control up to three AC or DC loads over the Internet using web UI or MQTT.</span></div><div style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; outline: none; padding: 0px;"><br /></div><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Powered by the popular&nbsp;<a href="https://espressif.com/en/products/esp8266/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">ESP8266&nbsp;</a>WiFi SoC</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Powerd direct from 230V AC via isolated on-board PSU (optional extra) or 5V DC via micro USB</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Up to three&nbsp;<a href="http://www.te.com/catalog/pn/en/3-1393239-6" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">high quality 10A relays</a>&nbsp;for switching AC or DC loads (see DC switching notes)</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Built-in web server with mobile device friendly UI and HTTP API to control the relays</li><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Thermostat function with weekly scheduling</li><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Manual relay control via the UI</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;"><a href="http://en.wikipedia.org/wiki/MQTT" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">MQTT&nbsp;</a>support</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;"><a href="http://en.wikipedia.org/wiki/Network_Time_Protocol" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">NTP</a>&nbsp;for network time and scheduling functionality</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Web server settings, including HTTP&nbsp;port and basic HTTP authentication setup</li></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Broadcast relay/sensor data using HTTP GET to services like&nbsp;<a href="https://thingspeak.com/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">ThingSpeak</a>&nbsp;or&nbsp;<a href="http://emoncms.org/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;" target="_blank">Emoncms</a></li><ul style="margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Integration with ThingSpeak for charting/analytics visualization</li></ul></ul><ul style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 19.2px; margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">Temperature sensor support (one of them, not both at the same time) -&nbsp;(optional extra)</li><ul style="margin: 0px 0px 10px 30px; outline: none; padding: 0px;"><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">DS18B20 one-wire temperature:&nbsp;supports multiple sensors</li><li style="margin: 0px 0px 2px; outline: none; padding: 0px;">DHT22 (AM2302) Humidity &amp; Temperature</li></ul></ul><div><h3 style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.4em; font-weight: normal; margin: 0px 0px 5px; outline: none; padding: 0px;"></h3><h3 style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.4em; font-weight: normal; margin: 0px 0px 5px; outline: none; padding: 0px;">Shop:</h3><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 16.64px;">The relay board can now be purchased direct from our shop:&nbsp;</span><span style="font-family: Verdana, Arial, Helvetica, sans-serif;"><span style="font-size: 12.8px; line-height: 16.64px;"><a href="http://shop.openenergymonitor.com/three-channel-wifi-relay-thermostat/">http://shop.openenergymonitor.com/three-channel-wifi-relay-thermostat/</a></span></span></div><h3 style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.4em; font-weight: normal; margin: 0px 0px 5px; outline: none; padding: 0px;"></h3><h3 style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.4em; font-weight: normal; margin: 0px 0px 5px; outline: none; padding: 0px;">Documentation &amp; Set-up:&nbsp;</h3></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif;"><span style="font-size: 12.8px; line-height: 19.2px;">Full technical details and set-up guide are available on Martin's Wiki:&nbsp;<a href="https://harizanov.com/wiki/wiki-home/three-channel-wifi-relaythermostat-board/">https://harizanov.com/wiki/wiki-home/three-channel-wifi-relaythermostat-board/</a></span></span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif;"><span style="font-size: 12.8px; line-height: 19.2px;"><br /></span></span></div><div><h3 style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.4em; font-weight: normal; margin: 0px 0px 5px; outline: none; padding: 0px;">Related Blog Posts:</h3><div style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; outline: none; padding: 0px;"><a href="https://harizanov.com/2015/03/diy-internet-connected-smart-humidifier/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;">DIY Internet Connected Smart Humidifier</a></div><div style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; outline: none; padding: 0px;"><a href="https://harizanov.com/2015/02/wifi-thermostat-with-weekly-scheduler/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;">WIFI Thermostat with weekly scheduler</a></div><div style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; outline: none; padding: 0px;"><a href="https://harizanov.com/2014/12/wifi-iot-3-channel-relay-board-with-mqtt-and-http-api-using-esp8266/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;">WiFi IoT 3 channel relay board with MQTT and HTTP API using ESP8266</a></div><div style="background-color: white; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12.8px; line-height: 1.3; outline: none; padding: 0px;"><a href="https://harizanov.com/2015/06/firmware-over-the-air-fota-for-esp8266-soc/" style="color: #3399cc; font-weight: bold; margin: 0px; outline: none; padding: 0px;">ESP8266 OTA Update</a>&nbsp;</div></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Overview demo of the board in action by Paul Reed:&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><br /><iframe width="320" height="266" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/nDaiUxO4Lt8/0.jpg" src="https://www.youtube.com/embed/nDaiUxO4Lt8?feature=player_embedded" frameborder="0" allowfullscreen></iframe></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-AXCP04Y4q_Q/Vdhb8REc4lI/AAAAAAABcVc/IsQrc2I1ctE/s1600/WIFI_relay.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="478" src="http://4.bp.blogspot.com/-AXCP04Y4q_Q/Vdhb8REc4lI/AAAAAAABcVc/IsQrc2I1ctE/s640/WIFI_relay.jpg" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-h7XcnL4hayU/Vdhb8QAGl6I/AAAAAAABcVY/n7eM8fuIaiQ/s1600/WIFI_relay_case.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="467" src="http://1.bp.blogspot.com/-h7XcnL4hayU/Vdhb8QAGl6I/AAAAAAABcVY/n7eM8fuIaiQ/s640/WIFI_relay_case.jpg" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-E6G7l8gqJmQ/VdhcAUnnYLI/AAAAAAABcV0/5ZqMX6jjwk0/s1600/control_relay_html__44590.1438788811.1280.1280.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="392" src="http://4.bp.blogspot.com/-E6G7l8gqJmQ/VdhcAUnnYLI/AAAAAAABcV0/5ZqMX6jjwk0/s400/control_relay_html__44590.1438788811.1280.1280.png" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-ybbRIxjCfB4/VdhcAven0ZI/AAAAAAABcV4/4vt8Yh5uqrw/s1600/control_thermostat_html2__38976.1438788811.1280.1280.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://4.bp.blogspot.com/-ybbRIxjCfB4/VdhcAven0ZI/AAAAAAABcV4/4vt8Yh5uqrw/s640/control_thermostat_html2__38976.1438788811.1280.1280.png" width="387" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-TZkjMmosL60/Vdhs1u7JTLI/AAAAAAABcWk/ZyJfxkDadyw/s1600/index_tpl__78496.1438788812.1280.1280.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-TZkjMmosL60/Vdhs1u7JTLI/AAAAAAABcWk/ZyJfxkDadyw/s400/index_tpl__78496.1438788812.1280.1280.png" width="395" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-rEUBDK0yMok/Vdhb_7OuXcI/AAAAAAABcWA/DoFnIeb9_tk/s1600/config_mqtt_tpl__60101.1438788811.1280.1280.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-rEUBDK0yMok/Vdhb_7OuXcI/AAAAAAABcWA/DoFnIeb9_tk/s400/config_mqtt_tpl__60101.1438788811.1280.1280.png" width="325" /></a></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-t4AHCjHPYu0/Vdhb_177o8I/AAAAAAABcWM/OHUS0dqh_g8/s1600/config_wifi_wifi_tpl__56418.1438788813.1280.1280.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://3.bp.blogspot.com/-t4AHCjHPYu0/Vdhb_177o8I/AAAAAAABcWM/OHUS0dqh_g8/s640/config_wifi_wifi_tpl__56418.1438788813.1280.1280.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><br /></td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-Z-6CsvcGQGs/Vdwf2FNVuLI/AAAAAAABc7M/npUBFYU1euo/s1600/wifi_realy_post_emoncms.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="140" src="http://2.bp.blogspot.com/-Z-6CsvcGQGs/Vdwf2FNVuLI/AAAAAAABc7M/npUBFYU1euo/s640/wifi_realy_post_emoncms.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Posting status &amp; sensor readings to Emoncms</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-VmWNhox2qmo/Vdhs9WwjSRI/AAAAAAABcWs/jZITz2d54Os/s1600/esp8266_relay_board_brd__51754.1438788657.1280.1280.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-VmWNhox2qmo/Vdhs9WwjSRI/AAAAAAABcWs/jZITz2d54Os/s400/esp8266_relay_board_brd__51754.1438788657.1280.1280.png" width="385" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"></div><br />
    
  </div>
  </article>
  <hr>
  
 
  <div class="pagination">
    
      <a class="btn pull-left" href="/posts/4">&larr; Older</a>
    

    
    <a class="btn pull-right" href="/posts/2">Newer &rarr;</a>
    
  </div>


        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2016/05/emonpi-raspberrypi3/">emonPi / emonBase Raspberry Pi 3</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/emoncms-qr/">Emoncms android App QR Code Scanner Setup</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/website-changes/">New Forum, Blog and User Guide Website</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/Part3-Aggregated-supply-and-demand/">Part 3: Aggregated supply and demand across multiple households</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Part2-Exploring-carbon-intensity/">Part 2: Exploring carbon intensity and renewable energy matching</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Understand-CO2-intensity-grid-electricity/">Part 1: Attempting to measure and understand the CO2 intensity of grid electricity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Git-Sub-Modules/">GitHub Submodules</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Home-Assistant/">Home Assistant and emonPi</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/03/raspberry-pi-3/">Raspberry Pi 3 </a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/02/outdoor-temperature-data-from-weather/">Outdoor Temperature Data from Weather Underground to Emoncms & MQTT</a>
        </li>
      
    
  </ul>
</section>
  
  
     <section class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Categories</h1>
  <ul class="divided">
    
    
      <li><a href="/categories/air quality egg/">Air Quality Egg</a></li>
    
      <li><a href="/categories/antenna/">Antenna</a></li>
    
      <li><a href="/categories/building energy modelling/">Building Energy Modelling</a></li>
    
      <li><a href="/categories/china/">China</a></li>
    
      <li><a href="/categories/christmas/">Christmas</a></li>
    
      <li><a href="/categories/course/workshop/">Course/Workshop</a></li>
    
      <li><a href="/categories/dc/">DC</a></li>
    
      <li><a href="/categories/dc current sensing/">DC current sensing</a></li>
    
      <li><a href="/categories/esp8266/">ESP8266</a></li>
    
      <li><a href="/categories/heat pump/">Heat Pump</a></li>
    
      <li><a href="/categories/kaizen/">Kaizen</a></li>
    
      <li><a href="/categories/kicad/">KiCad</a></li>
    
      <li><a href="/categories/mqtt/">MQTT</a></li>
    
      <li><a href="/categories/nanoderf/">NanodeRF</a></li>
    
      <li><a href="/categories/nodered/">NodeRed</a></li>
    
      <li><a href="/categories/oem labs/">OEM Labs</a></li>
    
      <li><a href="/categories/okg/">OKG</a></li>
    
      <li><a href="/categories/oscilloscope/">Oscilloscope</a></li>
    
      <li><a href="/categories/rfm12/">RFM12</a></li>
    
      <li><a href="/categories/rfm69/">RFM69</a></li>
    
      <li><a href="/categories/rs485/">RS485</a></li>
    
      <li><a href="/categories/sap 2012/">SAP 2012</a></li>
    
      <li><a href="/categories/shw/">SHW</a></li>
    
      <li><a href="/categories/srf/">SRF</a></li>
    
      <li><a href="/categories/tasker/">Tasker</a></li>
    
      <li><a href="/categories/android/">android</a></li>
    
      <li><a href="/categories/app/">app</a></li>
    
      <li><a href="/categories/arduino/">arduino</a></li>
    
      <li><a href="/categories/award/">award</a></li>
    
      <li><a href="/categories/backup/">backup</a></li>
    
      <li><a href="/categories/batteries/">batteries</a></li>
    
      <li><a href="/categories/benchmarking/">benchmarking</a></li>
    
      <li><a href="/categories/build sesh/">build sesh</a></li>
    
      <li><a href="/categories/business/">business</a></li>
    
      <li><a href="/categories/ciseco/">ciseco</a></li>
    
      <li><a href="/categories/community energy/">community energy</a></li>
    
      <li><a href="/categories/community smart grid/">community smart grid</a></li>
    
      <li><a href="/categories/control/">control</a></li>
    
      <li><a href="/categories/current sensor/">current sensor</a></li>
    
      <li><a href="/categories/current transformer/">current transformer</a></li>
    
      <li><a href="/categories/dashboard/">dashboard</a></li>
    
      <li><a href="/categories/display/">display</a></li>
    
      <li><a href="/categories/diy drones/">diy drones</a></li>
    
      <li><a href="/categories/documentation/">documentation</a></li>
    
      <li><a href="/categories/efergy/">efergy</a></li>
    
      <li><a href="/categories/electronics/">electronics</a></li>
    
      <li><a href="/categories/elektrocamp/">elektrocamp</a></li>
    
      <li><a href="/categories/email notifications/">email notifications</a></li>
    
      <li><a href="/categories/embodied energy/">embodied energy</a></li>
    
      <li><a href="/categories/emonbase/">emonBase</a></li>
    
      <li><a href="/categories/emonctrl/">emonCtrl</a></li>
    
      <li><a href="/categories/emonglcd/">emonGLCD</a></li>
    
      <li><a href="/categories/emonpi/">emonPi</a></li>
    
      <li><a href="/categories/emonth/">emonTH</a></li>
    
      <li><a href="/categories/emontx/">emonTx</a></li>
    
      <li><a href="/categories/emontx v2/">emonTx V2</a></li>
    
      <li><a href="/categories/emontxsmt/">emonTxSMT</a></li>
    
      <li><a href="/categories/emontxshield/">emonTxShield</a></li>
    
      <li><a href="/categories/emoncms/">emoncms</a></li>
    
      <li><a href="/categories/emonpi/">emonpi</a></li>
    
      <li><a href="/categories/end-to-end/">end to end</a></li>
    
      <li><a href="/categories/energy monitor/">energy monitor</a></li>
    
      <li><a href="/categories/energy monitoring/">energy monitoring</a></li>
    
      <li><a href="/categories/feed storage/">feed storage</a></li>
    
      <li><a href="/categories/forum/">forum</a></li>
    
      <li><a href="/categories/github/">github</a></li>
    
      <li><a href="/categories/graphing/">graphing</a></li>
    
      <li><a href="/categories/hackathon/">hackathon</a></li>
    
      <li><a href="/categories/hall effect/">hall effect</a></li>
    
      <li><a href="/categories/hardware/">hardware</a></li>
    
      <li><a href="/categories/heating/">heating</a></li>
    
      <li><a href="/categories/home assistant/">home Assistant</a></li>
    
      <li><a href="/categories/home camp/">home camp</a></li>
    
      <li><a href="/categories/humidity/">humidity</a></li>
    
      <li><a href="/categories/integrations/">integrations</a></li>
    
      <li><a href="/categories/interface/">interface</a></li>
    
      <li><a href="/categories/interview/">interview</a></li>
    
      <li><a href="/categories/java/">java</a></li>
    
      <li><a href="/categories/job/">job</a></li>
    
      <li><a href="/categories/kickstarter/">kickstarter</a></li>
    
      <li><a href="/categories/lightwaverf/">lightwaverf</a></li>
    
      <li><a href="/categories/linux/">linux</a></li>
    
      <li><a href="/categories/logo/">logo</a></li>
    
      <li><a href="/categories/manufacturing/">manufacturing</a></li>
    
      <li><a href="/categories/measurement/">measurement</a></li>
    
      <li><a href="/categories/media/">media</a></li>
    
      <li><a href="/categories/mobile/">mobile</a></li>
    
      <li><a href="/categories/mobile app/">mobile app</a></li>
    
      <li><a href="/categories/modbus/">modbus</a></li>
    
      <li><a href="/categories/nanode/">nanode</a></li>
    
      <li><a href="/categories/ook/">ook</a></li>
    
      <li><a href="/categories/open source/">open source</a></li>
    
      <li><a href="/categories/openhab/">openHAB</a></li>
    
      <li><a href="/categories/openenergymonitor/">openenergymonitor</a></li>
    
      <li><a href="/categories/optical pulse/">optical pulse</a></li>
    
      <li><a href="/categories/pcb/">pcb</a></li>
    
      <li><a href="/categories/pebble/">pebble</a></li>
    
      <li><a href="/categories/pluse/">pluse</a></li>
    
      <li><a href="/categories/presentation/">presentation</a></li>
    
      <li><a href="/categories/raspberry pi/">raspberry pi</a></li>
    
      <li><a href="/categories/renewable/">renewable</a></li>
    
      <li><a href="/categories/serial/">serial</a></li>
    
      <li><a href="/categories/shop/">shop</a></li>
    
      <li><a href="/categories/showcase/">showcase</a></li>
    
      <li><a href="/categories/smartwatch/">smartwatch</a></li>
    
      <li><a href="/categories/social energy monitoring/">social energy monitoring</a></li>
    
      <li><a href="/categories/solarpv/">solarPV</a></li>
    
      <li><a href="/categories/sparkfun/">sparkfun</a></li>
    
      <li><a href="/categories/sustainability/">sustainability</a></li>
    
      <li><a href="/categories/temperature/">temperature</a></li>
    
      <li><a href="/categories/three phase/">three phase</a></li>
    
      <li><a href="/categories/tutorials/">tutorials</a></li>
    
      <li><a href="/categories/upgrade/">upgrade</a></li>
    
      <li><a href="/categories/user guide/">user guide</a></li>
    
      <li><a href="/categories/utility meters/">utility meters</a></li>
    
      <li><a href="/categories/voltage sensing/">voltage sensing</a></li>
    
      <li><a href="/categories/website/">website</a></li>
    
      <li><a href="/categories/wind/">wind</a></li>
    
      <li><a href="/categories/wind turbine/">wind turbine</a></li>
    
      <li><a href="/categories/wireless/">wireless</a></li>
    
      <li><a href="/categories/workshop/">workshop</a></li>
    
  </ul>
</section>
  
</div>
        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">
    
    
        <form action="https://www.google.com/search" method="get">
          <fieldset role="search">
            <input type="hidden" name="q" value="site:https://blog.openenergymonitor.org" />
            <input class="search" type="text" name="q" results="0" placeholder="Search"/>
          </fieldset>
        </form>
    
  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and the <a href='https://github.com/coogie/oscailte'>Oscalite theme</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
</div>
    </div>
  </div>
</div>
    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

  </body>
</html>