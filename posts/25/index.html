<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/posts/25/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Blog | OpenEnergyMonitor">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/posts/25/">
    <meta property="og:type" content="website">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Blog | OpenEnergyMonitor">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />



    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu:light,bold&amp;subset=Latin" rel="stylesheet"> <!-- Ubuntu font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  </head>

<style>

@font-face {
  font-family: "oemFont";
  src: url(/font/Ubuntu-OEM-Light.ttf)
}

html, body {
  margin: 0; height: 100vh;
}

html {
  min-height: 100vh;
}

html, body {
  word-wrap: break-word;
  font-family: "oemFont", sans-serif;
}

a:visited, .a:hover, a:focus, a {
  color: #44b3e2;
}

.meta.clearfix {
  overflow-x: hidden;
}

.communityWrapper {
  position: relative;
  box-sizing: border-box;
  margin: 0 auto;
  width: 100%;
  height: 42px;
}

@media (min-width: 1080px) {
  .communityWrapper {
  width: 1080px;
  }
}

@media screen and (max-width: 400px) {
  .oemWrap {
  display: none;
  }
}

.fa-navicon {
  display: none;
  cursor: pointer;
  font-size: 30px;
  line-height: 42px;
  position: absolute;
  left: 0;
  color: #ffffff;
  padding-left: 12px;
  z-index: 9997;
}

@media screen and (max-width: 1079px) {
  .fa-navicon {
  display: inline-block;
  }
}

.titleHolder {
  position: relative;
  top: 0;
  width: 100%;
  height: 42px;
  background-color: #44b3e2;
  overflow: hidden;
  -webkit-box-shadow: 0 -2px 4px 2px #000;
  -moz-box-shadow: 0 -2px 4px 2px #000;
  box-shadow: 0 -2px 4px 2px #000;
}

.titleIcon {
  position: absolute;
  height: 42px;
  padding: 0 0 0 7px;
  text-align: center;
  line-height: 42px;
  color: #ffffff;
  vertical-align: top;
}

  .titleIcon i {
    vertical-align: middle;
    font-size: 32px;
    line-height: 42px;
  }

.thisTitle {
  position: absolute;
  box-sizing: border-box;
  left: 42px;
  right: 0;
  height: 42px;
  padding: 5px 0 5px 0;
  text-align: left;
  color: #ffffff;
  line-height: normal;
  vertical-align: top;
}

  .thisTitle a {
    position: absolute;
    top: 0;
    color: #ffffff;
  }

@media screen and (max-width: 1079px) {
  .titleIcon {
    left: auto;
    right: 0;
    padding: 0 7px 0 0;
  }

  .thisTitle {
    right: 42px;
    left: 0;
    text-align: right;
  }

    .thisTitle a {
      padding-right: 0;
    }
}

.thisTitle-top {
  top: 0;
  height: 60%;
  font-size: 18px;
}

.thisTitle-bottom {
  bottom: 0;
  height: 40%;
  font-size: 12px;
}

.navigation {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  margin-right: 6px;
  height: 42px;
  min-width: 774px;
  overflow: visible;
  padding-right: 7px;
  z-index: 20;
  box-sizing: content-box;
}

@media screen and (min-width: 1080px) {
  .navigation {
  position: relative;
  float: right;
  display: inline-block;
  margin: 0;
  }
}

.navigation ul {
  list-style-type: none;
  float: right;
  top: 0;
  margin: 0;
  padding: 0;
  height: 100%;
  display: block;
}

.navigation ul li {
  float: left;
  background-color: #44b3e2;
}

.navigation ul li a {
  display: block;
  line-height: 42px;
  font-family: "oemFont", sans-serif;
  font-size: 16px;
  text-align: center;
  padding-left: 10px;
  padding-right: 10px;
  color: #ffffff;
}

.menuFreeze {
  height: 100%;
  overflow: hidden;
}

/* Navigation on smaller screens... */

@media screen and (max-width: 1079px) {
.navigation {
  position: fixed;
  display: none;
  top: 0;
  left: 0;
  height: 100vh;
  margin: 0;
  width: 0;
  font-size: 20px;
  background-color: #44b3e2;
  color: #ffffff;
  box-sizing: border-box;
  overflow: auto;
  min-width: 0;
  padding-right: 0;
  z-index: 99999999;
}

  .navigation ul {
    list-style-type: none;
    margin: 0;
    padding-top: 0;
  }

  .navigation ul li a {
    box-sizing: border-box;
    font-family: "oemFont", sans-serif;
    font-size: 20px;
    display: block;
    color: #ffffff;
    padding: 0 20px 0 20px;
    height: 12.5vh;
    line-height: 12.5vh;
    min-width: 180px;
    text-align: left;
  }

  .navigation ul li .fa {
    min-width: 25px;
  }
}

@media (max-width: 1079px) and (min-height: 550px) {
  .navigation ul li a {
    height: 68.75px;
    line-height: 68.75px;
  }
}

@media (max-width: 1079px) and (max-height: 200px) {
  .navigation ul li a {
    height: 25px;
    line-height: 25px;
  }
}

@media screen and (min-width: 1080px) {
  .navigation ul li:nth-child(1) {
    width: 88px;
  }
  .navigation ul li:nth-child(2) {
    width: 86px;
  }
  .navigation ul li:nth-child(3) {
    width: 92px;
  }
  .navigation ul li:nth-child(4) {
    width: 123px;
  }
  .navigation ul li:nth-child(5) {
    width: 133px;
  }
  .navigation ul li:nth-child(6) {
    width: 76px;
  }
  .navigation ul li:nth-child(7) {
    width: 80px;
  }
  .navigation ul li:nth-child(8) {
    width: 96px;
  }
}

.blackOut {
  position: fixed;
  display: none;
  top: 0;
  right: 0;
  height: 100vh;
  width: 100%;
  background-color: rgba(0,0,0,0.5);
  overflow: hidden;
  cursor: pointer;
  z-index:9998;
}

.actoemLink {
  background-color: #368fb4 !important;
}

.actoemLink a {
  color: #ffffff !important;
}

.searchBox {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgba(0,0,0,0.8);
  color: #fff;
  display: none;
  cursor: pointer;
  z-index: 9999999999999;
}

.searchBox form {
  margin: auto;
}

.searchBox input[type=submit] {
  cursor: pointer;
  padding: 10px;
  font-size: 20px;
  font-weight: bold;
  background-color: #44b3e2;
  color: #fff;
  border: none;
  -webkit-transition: background-color 500ms linear;
  -ms-transition: background-color 500ms linear;
  transition: background-color 500ms linear;
}

.searchBox input[type=submit]:hover {
  background-color: #77c8ea;
}

.searchBox input[type=text] {
  padding: 10px;
  font-size: 20px;
  border: none;
}

.searchText {
  width: 0;
}

.searchIcon {
  cursor: pointer;
}

.fa {
  text-shadow: 2px 2px 2px rgba(150, 150, 150, 0.5);
}

</style>

<body >




<div class="titleHolder">
  <div class="communityWrapper">
    <i class="fa fa-navicon"></i>
    <a href="/">
      <div class="titleIcon">
				<i aria-hidden="true" class="fa fa-bullhorn"></i>
			</div>
			<div class="thisTitle">
			  <div class="thisTitle-top">
        		<b>Blog</b>
				</div>
				<div class="thisTitle-bottom">
          Open<b>EnergyMonitor</b>
				</div>
			</div>
		</a>
    <div id="siteLinks" class="navigation">
      <ul>
        <li title="the homepage of OpenEnergyMonitor">
          <a href="https://openenergymonitor.org">
            <i class="fa fa-home" aria-hidden="true"></i><span class="navname">&nbsp;Home</span>
          </a>
        </li>
        <li title="a user guide for the OpenEnergyMonitor system">
          <a href="https://guide.openenergymonitor.org">
            <i class="fa fa-book" aria-hidden="true"></i><span class="navname">&nbsp;Guide</span>
          </a>
        </li>
        <li title="general information about energy monitoring, diversion and sustainability">
          <a href="https://learn.openenergymonitor.org">
            <i class="fa fa-mortar-board" aria-hidden="true"></i><span class="navname">&nbsp;Learn</span>
          </a>
        </li>
        <li title="a definitive list of resources for OpenEnergyMonitor hardware">
          <a href="https://guide.openenergymonitor.org/technical/resources/">
            <i class="fa fa-list-alt" aria-hidden="true"></i><span class="navname">&nbsp;Resources</span>
          </a>
        </li>
        <li title="the openenergymonitor forum">
          <a href="https://community.openenergymonitor.org">
            <i class="fa fa-comments" aria-hidden="true"></i><span class="navname">&nbsp;Community</span>
          </a>
        </li>
        <li title="you are here: keep up with new developments at OpenEnergyMonitor" class="actoemLink">
          <a href="https://blog.openenergymonitor.org">
            <i class="fa fa-bullhorn" aria-hidden="true"></i><span class="navname">&nbsp;Blog</span>
          </a>
        </li>
        <li title="the official OpenEnergyMonitor online store">
          <a href="https://shop.openenergymonitor.com">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i><span class="navname">&nbsp;Shop</span>
          </a>
        </li>
				<li title="search for something on OpenEnergyMonitor">
					<a class="searchIcon">
					    <i aria-hidden="true" class="fa fa-search"></i><span class="navname">&nbsp;Search</span>
				  </a>
				</li>
      </ul>
    </div>
  </div>
</div>
<div class="searchBox">
  <form target="_blank" id="searchform" action="https://www.google.com/cse">
    <div>
      <input type="hidden" name="cx" value="006198118389747886812:_nmxikw563w" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" class="searchText" value="" name="q" id="q" autocomplete="off" />
      <input type="submit" id="searchsubmit" name="sa" value="Search" />
    </div>
  </form>
</div>
<div class="blackOut"></div>
<div style="position:relative;width:100%;top:0;height:20px"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script defer src="/javascripts/octopress.js"></script>

<script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

<script>

var closeStatus = false;

function openButton() {
  $("html, body").addClass("menuFreeze");
  $(".blackOut").show();
  $(".navigation").show();
  $(".navigation").animate({ width:'180' },"0.5s");
}

$(".fa-navicon").click(function() {
  openButton();
  closeStatus = true;
});

function closeButton() {
  $("html, body").removeClass("menuFreeze");
  $(".blackOut").hide();
  $(".navigation").animate({ width:'0' },"0.5s");
}

$(".blackOut").click(function() {
  closeButton();
  closeStatus = false;
});

$(document).ready(function(){
  $("table").wrap("<div style='max-width:100%;overflow-x:auto'></div>");
});

$(window).resize(function(){
  if ($(window).width() > 1079 && closeStatus == true) {
    if (!$("html").hasClass("mobile-device")) {
      closeButton();
      closeStatus = false;
    }
  }
});

$(".searchIcon").click(function() {
   $(".searchBox").css("display","flex");
   $(".searchText").animate({width: "200px"});
   $(".searchText").focus();
   $("html, body").addClass("menuFreeze");
});
$(".searchBox").click(function() {
   $(".searchBox").css("display","none");
   $(".searchText").blur();
   $(".searchText").css("width","0");
   closeButton();
});
$(".searchBox form").click( function(event) {
   event.stopPropagation();
});

$(document).ready(function(){ //alphabetically order list
  var ls, x, switchState, z, switchMe;
  ls = document.getElementById("ub202");
  switchState = true;
  while (switchState) {
    switchState = false;
    z = ls.getElementsByTagName("LI");
    for (x = 0; x < (z.length - 1); x++) {
      switchMe = false;
      if (z[x].innerHTML.toLowerCase() > z[x + 1].innerHTML.toLowerCase()) {
        switchMe= true;
        break;
      }
    }
    if (switchMe) {
      z[x].parentNode.insertBefore(z[x + 1], z[x]);
      switchState = true;
    }
  }
});

</script>

<div class="grid-wrapper">
  <div class="grid grid-center">
    
    <div class="grid__item two-thirds lap-one-whole palm-one-whole">
    

        
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/07/triac-based-mk2-pv-controller-by/">Triac based MK2 PV Controller by Calypso Rye</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-07-16T13:42:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-07-16 13:42:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/electronics/'>electronics</a></li>
      
        <li><a class='category' href='/categories/solarpv/'>solarPV</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/07/triac-based-mk2-pv-controller-by/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Y8lRjQvqoZg/UAQXPSAleMI/AAAAAAAACdU/9CxAGNIB73Y/s1600/IMGP9704.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="300" src="http://3.bp.blogspot.com/-Y8lRjQvqoZg/UAQXPSAleMI/AAAAAAAACdU/9CxAGNIB73Y/s400/IMGP9704.JPG" width="400" /></a></div><br /><br /><a href="http://openenergymonitor.org/emon/user/956">Calypso Rye</a> writes:<br /><br /><div style="background-color: #dddddd; font-size: 90%; padding: 10px;">Based on the standard VI sketch which uses calcVI() in EmonLib, I’ve had a system in place for the last couple of months which diverts surplus PV power to our immersion heater.  This system has proved to be both effective and reliable, and I am most grateful for everyone who has helped me along the way.  The main downside to this arrangement is that it requires an expensive item of third-party kit to distribute the power.  (I know that others have found cheaper ways, but my Carlo Gavazzi unit cost me £70).<br /><br />Other contributors to this forum have shown that a standard triac can be easily controlled by an Arduino.  By using a zero-crossing detector such as the Motorola MOC3041, it should be possible for the Arduino to allocate mains cycles directly to the load rather than delegating this task to a separate device.<br /><br />A Mk2 system of this type has been working in our garage for the last few days.  The sketch and a schematic diagram are attached, its main features being:<br /><br />- a comprehensive 'debug' mode which allows real world conditions to be simulated ;<br /><div><br />- a continuous mode of operation, for both measurement and distribution of power;</div><div><br />- an "energy bucket" concept which gives precise control of surplus power;<br /><br />- interleaved windows for measurement and generation, each only 20mS;<br /><br />- a rapid response time to changing conditions (50mS);<br /><br />- suitable timing for 'arming' a zero-crossing trigger device;<br /><br />- a single LPF which determines the dc-offset of raw VI samples;<br /><br />- a programmable safety margin for biassing import v. export;<br /><br />- minimal calibration is required.</div></div><br />Read the full post on the forum here: <a href="http://openenergymonitor.org/emon/node/841">http://openenergymonitor.org/emon/node/841</a>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/06/it-works-single-ac-power-supply-voltage/">Single AC power supply + voltage sensing</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-06-18T03:21:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-06-18 03:21:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Bouha</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/electronics/'>electronics</a></li>
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
        <li><a class='category' href='/categories/voltage-sensing/'>voltage sensing</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/06/it-works-single-ac-power-supply-voltage/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div dir="ltr" style="text-align: left;" trbidi="on">The idea of using the same AC-AC power adaptor for both sensing voltage and supplying power to emonTx has been discussed on the forums for months (see <a href="http://openenergymonitor.org/emon/node/309" target="_blank">this topic</a>), and about six weeks ago Glyn posted <a href="http://openenergymonitor.blogspot.de/2012/05/emontx-single-ac-power-supply.html" target="_blank">a simulation of a possible circuit</a>.<br /><br />I had the time this weekend to give it a try, bought the necessary components and put it all on a breadboard. After a sleepless night I can confirm: It works!<br /><br />Here is my messy setup:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-vFgjTQRFaMY/T96bNDBEo-I/AAAAAAAAARQ/BNybcVJIFfs/s1600/2012-06-18+04.55.43.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="380" src="http://1.bp.blogspot.com/-vFgjTQRFaMY/T96bNDBEo-I/AAAAAAAAARQ/BNybcVJIFfs/s640/2012-06-18+04.55.43.jpg" width="640" /></a><a href="http://1.bp.blogspot.com/-vFgjTQRFaMY/T96bNDBEo-I/AAAAAAAAARQ/BNybcVJIFfs/s1600/2012-06-18+04.55.43.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /><div style="text-align: left;"><br /></div></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><a href="http://www.blogger.com/goog_1837366350"><br /></a></div><span style="clear: left; color: black; float: left; margin-bottom: 1em; margin-right: 1em; text-align: left;">Small modifications had to be made to get it to work: I added a 1uF cap between 3.3v and GND to&nbsp;filter out some noise and redefined the voltage calibration coefficient in the code.</span><span style="clear: left; color: black; float: left; margin-bottom: 1em; margin-right: 1em; text-align: left;">But the main problem (took me all night to figure it out) is that the usual emonTx sketch wont work straight ahead. The line that lights up the LED (on pin 9) at the end of the setup loop has to be commented out, otherwise the setup won't work. It's no problem to flash it 2ms after each packet is sent, but apparently having it on in the beginning will prevent the program from starting. Maybe there isn't enough current to do it and move on (I must say that I use 10k ohm resistors for the voltage dividers). If it's not that then maybe full wave rectification could help.</span><span style="clear: left; color: black; float: left; margin-bottom: 1em; margin-right: 1em; text-align: left;">I used a humble Xprotolab to measure the Vin, Vout and at some other points in the circuit. It behaves almost exactly like the simulation. fft also shows very little noise.</span><span style="clear: left; color: black; float: left; margin-bottom: 1em; margin-right: 1em; text-align: left;">Would be great if other members could repeat this experiment to see if the results will be the same.</span><span style="clear: left; color: black; float: left; margin-bottom: 1em; margin-right: 1em; text-align: left;">Next step: Voltage sensing on the base ;)&nbsp;</span><a href="http://1.bp.blogspot.com/-vFgjTQRFaMY/T96bNDBEo-I/AAAAAAAAARQ/BNybcVJIFfs/s1600/2012-06-18+04.55.43.jpg" imageanchor="1"><br style="color: black;" /></a></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/06/getting-visual/">Getting visual</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-06-04T12:57:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-06-04 12:57:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Bouha</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/benchmarking/'>benchmarking</a></li>
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
        <li><a class='category' href='/categories/graphing/'>graphing</a></li>
      
        <li><a class='category' href='/categories/interface/'>interface</a></li>
      
        <li><a class='category' href='/categories/social-energy-monitoring/'>social energy monitoring</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/06/getting-visual/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div dir="ltr" style="text-align: left;" trbidi="on">The Open Energy Monitor is all about getting visual. Using hardware to post collected data to emonCMS basically transforms the acquired data into easily understandable informations, and what's better than graphs.<br />Here is a <a href="https://power2switch.com/" target="_blank">similar initiative</a> that converts absurd electricity bills into meaningful information:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-PY9KdI3eIt4/T8ygPLITPtI/AAAAAAAAAQ4/a67-09plce8/s1600/p2s-bill-redesign-v16.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://2.bp.blogspot.com/-PY9KdI3eIt4/T8ygPLITPtI/AAAAAAAAAQ4/a67-09plce8/s640/p2s-bill-redesign-v16.jpg" width="492" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Source: <a href="http://www.fastcodesign.com/1669931/how-a-redesigned-electricity-bill-could-make-you-smarter-and-save-cash" target="_blank">FastCoDesign.com</a></td></tr></tbody></table>You can compare it with with the old bill:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-E7YYVFYZ41s/T8yjo2P1PwI/AAAAAAAAARE/xvE3r5-85ig/s1600/comed-bill-jan-2011-1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-E7YYVFYZ41s/T8yjo2P1PwI/AAAAAAAAARE/xvE3r5-85ig/s400/comed-bill-jan-2011-1.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div>It is obvious that presenting the same information in a different way makes a big difference. The redesigned bill is much easier to understand, and the use of shapes and colors turns something very abstract into tangible information.<br /><br />But I believe that if we really want to democratize energy monitoring, we should take it one step further. We should offer people who have no idea what 4.2 kW or 150 kWh are, a reference to compare with. For example, visualizing 1kWh as the energy than ten 100W light bulbs consume in one hour makes it understandable to your grandma. Or showing one week's consumption each hour on one matrix using colored circles.<br /><br />More important is to give a feeling of the order of magnitude. Like showing a community average VS your consumption on a colored scale to have an idea how well you're doing, lets you have a good reference point.<br /><br />I agree that with households community averages are quite complicated since households have extremely different consumption patterns: some work from home, some have many guests, others spend very little time at home, etc... But when it comes to businesses, benchmarking is much less complicated, you can compare bakeries or cafes electricity consumption patterns in a much meaningful way.<br /><br />I think this should be a main target to be implemented in emonCMS, and I believe that the community has something to say and contribute to this topic, so I started this forum thread : http://openenergymonitor.org/emon/node/715&nbsp;please feel free to add your thoughts to it.<br /><br /><br /><div style="text-align: right;"><a href="http://www.fastcodesign.com/1669931/how-a-redesigned-electricity-bill-could-make-you-smarter-and-save-cash" target="_blank">Link to FastCoDesign article.</a></div></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/06/arduino-leonardo-atmega32u4-and-rfm12b/">Arduino Leonardo (ATmega32U4) and RFM12B</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-06-01T21:43:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-06-01 21:43:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/rfm12/'>RFM12</a></li>
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/06/arduino-leonardo-atmega32u4-and-rfm12b/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <br />I've just managed to get an RFM12B hooked up to an Arduino Leonardo. It's been a bit of port mapping nightmare! <br /><br />The ATmega 32U4's &nbsp;'special function' ports such as PWM, IRQ, SPI etc are quite different to the ATmega328. The <a href="http://arduino.cc/en/Hacking/PinMapping32u4">Arduino port mapping table</a> proves very useful, if a little difficult to&nbsp;interpret. I made a re-arranged table with the ports re-arranged&nbsp;into function groups. I'll publish it once I've&nbsp;tidied&nbsp;it up.<br /><br />Once of the main&nbsp;differences&nbsp;is that the hardware ISP connections are no longer on digital pins 10,11,12 and 13. On the Leonardo they are<br /><br /><table border="0" cellspacing="0" cols="2"> <colgroup width="245"></colgroup> <colgroup width="229"></colgroup> <tbody><tr>  <td align="LEFT" height="17"><span style="font-family: 'Times New Roman';"><i>MISO - &nbsp;Digital 14</i></span></td><td align="LEFT"><i><br /></i></td> </tr><tr>  <td align="LEFT" height="17"><span style="font-family: 'Times New Roman';"><i>SCK - &nbsp; Digital 15</i></span></td><td align="LEFT"><i><br /></i></td> </tr><tr>  <td align="LEFT" height="17"><span style="font-family: 'Times New Roman';"><i>MOSI - Digital 16</i></span></td>  <td align="LEFT"><i><br /></i></td> </tr><tr>  <td align="LEFT" height="17"><span style="font-family: 'Times New Roman';"><i>SS - &nbsp; &nbsp; &nbsp;Digital 17&nbsp;</i></span></td>  <td align="LEFT"><br /></td></tr></tbody></table><br />Unlike on the Arduino Uno These SPI pins are not accessible&nbsp;through any of the digital I/O pins, on om the Leonardo, their only accessible through the ICSP header. The SPI SS pin on the Leonardo is not broken out anywhere on the board,&nbsp;strangely&nbsp;it's used for the Rx LED. Can anyone explain why this is the case? It's not a big problem, we can use another pin as SS, digital 10 in this case.<br /><br />The IRQ Interrupt connection is made to Digital 3 (INT0). This has moved from Digital 2 on the Arduino Uno.<br /><br />The SEL connection is the same as with the Arduino UNO/ATmega328 goes to digital 10.<br /><br />See the RFM12B documentation page for general info on RFM12B and details of how to interface with ATmega328: <a href="http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless">http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless .&nbsp;</a><br /><br /><div class="separator" style="clear: both; text-align: center;"></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-1wlXYOH5sRw/T8k1oL7NA_I/AAAAAAAAbqM/ADGDEPtMkFc/s1600/Ardiono+Leonardo+RFM12B.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="266" src="http://1.bp.blogspot.com/-1wlXYOH5sRw/T8k1oL7NA_I/AAAAAAAAbqM/ADGDEPtMkFc/s640/Ardiono+Leonardo+RFM12B.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Arduino Leonardo Connections to RFM12B via<a href="http://jeelabs.com/products/rfm12b-board"> JeeLabs RFM12B</a> breakout for level shifting to 3.3V</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-SL7RcnJfBxU/T8kWsOqWWTI/AAAAAAAAbqA/LYa2A00fwp0/s1600/SPI.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-SL7RcnJfBxU/T8kWsOqWWTI/AAAAAAAAbqA/LYa2A00fwp0/s1600/SPI.jpg" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ICSP Header</td></tr></tbody></table>Now the hardware is&nbsp;complete&nbsp;it's time to tackle the software. We use the RFM12B driver as part of the JeeLib library from JeeLabs:&nbsp;<a href="https://github.com/jcw/jeelib">https://github.com/jcw/jeelib</a>. The library needs to be installed in the Arduino&nbsp;library's&nbsp;folder in the usual way. Arduino 1.0.1 is needed to be&nbsp;compatible&nbsp;with Leonardo.<br /><br /><strike>To make the JeeLib library work with the Leonardo and RFM12B (hooked up as above) the following needs to be inserted into the RF12.cpp file on line 62 <b>before</b> the <i>else&nbsp;// ATmega168, ATmega328, etc.</i></strike><br /><i><br /></i><br />No change to RFM12.cpp is needed, just download the latest version, see update below.<br /><br /><i>#elif defined(__AVR_ATmega32U4__)</i><br /><i><br /></i><br /><i>#define RFM_IRQ &nbsp; &nbsp; 0<span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; //PD0, INT0, Digital3&nbsp;</i><br /><i>#define SS_DDR &nbsp; &nbsp; &nbsp;DDRB</i><br /><i>#define SS_PORT &nbsp; &nbsp; PORTB</i><br /><i>#define SS_BIT &nbsp; &nbsp; &nbsp;6<span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; //Dig10, PB6</i><br /><i><br /></i><br /><i>#define SPI_SS &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; // PB0, pin 8, Digital17</i><br /><i>#define SPI_MISO &nbsp; &nbsp;14 &nbsp; &nbsp; // PB3, pin 11, Digital14</i><br /><i>#define SPI_MOSI &nbsp; &nbsp;16 &nbsp; &nbsp; // PB2, pin 10, Digital16</i><br /><i>#define SPI_SCK &nbsp; &nbsp; 15 &nbsp; &nbsp; // PB1, pin 9, Digital15</i><br /><br /><br />I'm going to send JCW a git pull request to see if these changes can be integrated into the JeeLib library so it should work 'out of the box' in the future.<br /><br /><b>Update: Pull request has been merged, RF12 part of JeeLib Arduino library now has ATmega32U4 support :-) . Download it here:&nbsp;<a href="https://github.com/jcw/jeelib">https://github.com/jcw/jeelib</a></b><br /><br />For a simple RFM12B transmission demo/example see:&nbsp;<a href="https://github.com/openenergymonitor/RFM12B_Simple">https://github.com/openenergymonitor/RFM12B_Simple</a><br /><br />I'm planning on using the ATmega32U4 in the emonTx SMT that I'm currently working on. Spot the common thread in my last few blog posts!
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/06/high-accuracy-current-measurement-over/">High Accuracy Current Measurement Over a Wide Range</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-06-01T08:59:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-06-01 08:59:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> four minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/06/high-accuracy-current-measurement-over/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a></div><div style="text-align: left;">Measuring the current in a domestic property using a clip-on CT sensor can be quite&nbsp;challenging&nbsp;since the range in which it has to work over is very large, potentially several order of magnitude: up to 25000W and down to a few 10'sW. We would like to have good accuracy over this wide range.&nbsp;</div><div style="text-align: left;"><br /></div><div>We have been exploring how to improve on the current emonTx. Robert Wall has written a page&nbsp;<a href="http://openenergymonitor.org/emon/node/712">detailing the measurement implications of current emonTx ADC</a> resolution at low current values when using&nbsp;the standard 100A max CT sensor and 18R burden resistor.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">A while back we came across an application note from ATmel detailing how to build a fully featured energy monitor using CT sensor, AC voltage measurement and the ATmega328 MCU. App-notes are a fantastic source for&nbsp;open-source hardware information. The ATmel energy monitor app-note is very&nbsp;comprehensive&nbsp;and well written. It's even got a Bill of Materials that specs down to individual resistors&nbsp;complete&nbsp;with their corresponding Farrnel order codes!&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Download the app-note .pdf here:&nbsp;<a href="http://www.atmel.com/Images/doc2566.pdf" style="text-align: -webkit-auto;">www.atmel.com/Images/doc2566.pdf</a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="278" src="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Diagram from Atmel app-note - potential divider resistor values where changed to enabled the AC signal to be biased to Vcc/2</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><span style="text-align: -webkit-auto;">The app-note circuit&nbsp;achieves&nbsp;good resolution and accuracy over a wide range by having a adjustable op-amp gain stage. Using the resistor values in the inverting op-amp the gain can be switched from -1.25, -10.26 and -69.11. The gain is switched by digital switching the&nbsp;</span>Bilateral Switches (74HC4066). The gain of the op-amp is calculated as follows:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1"><img border="0" height="122" src="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">A couple of days a ago we built up a prototype of the above circuit, more an an exercise to check we can make it work rather than a scientific test, this would be difficult on a breadboard due to the sub-optimal circuit layout. A spare emonTx PCB was used as an easy way to connect the circuit up to an ATmega328 and RFM12B.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="margin-left: auto; margin-right: auto; text-align: left;"><img border="0" height="240" src="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s320/DSCF5036.JPG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Adjustable gain op-amp CT sensor circuit - prototype&nbsp;</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s1600/sample02.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s640/sample02.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ATmega 328 ADC sample using <a href="http://openenergymonitor.org/emon/node/110">VI sampler</a></td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">The circuit worked first time with no&nbsp;hiccups. The above waveform is the RAW output from an ATmega 328's ADC, where one 100W light bulb and 30W laptop PSU was connected to the AC circuit being monitored. The high gain stage (x69.11) was active. To put this in perspective if the same sample was run on the current emonTx the signal would be so small as to be only just visible on the VI sampler. The spikes at the peak of the waveform is caused by the laptop's switch-mode PSU. The significantly increased amplitude of the signal will improve accuracy when monitoring low power levels. The app-note suggests accuracy of &lt;1% over a wide range, possibly even better with careful PCB design.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Although this multi-gain op-amp circuit adds significant complexity over the current emonTx current monitoring circuit it can be added for relatively low cost. One quad op-amp and two quad bilateral switches IC's cost about £1, this is enough for 4 x CT channels. We're planning to use this circuit design in the forthcoming emonTx SMT. As the name suggests this board will be designed for SMT components and will be assembled by pick-and-place. See <a href="http://openenergymonitor.org/emon/node/642">this forum thread</a> for a discussion regarding ideas for the emonTx SMT. Design is progressing well, more details on this soon.&nbsp;</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/05/installing-emoncms-on-raspberry-pi/">Installing emoncms on a raspberry pi</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-05-30T16:14:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-05-30 16:14:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
        <li><a class='category' href='/categories/raspberry-pi/'>raspberry pi</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/05/installing-emoncms-on-raspberry-pi/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: left;">Update: we now have a more&nbsp;complete&nbsp;guide for installing emoncms on the Pi here:&nbsp;<a href="http://openenergymonitor.org/emon/emoncms/installing-ubuntu-debian-pi">http://openenergymonitor.org/emon/emoncms/installing-ubuntu-debian-pi</a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Just got emoncms installed and running on the raspberry pi here, here are my installation notes:</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-RT98jV4_DP8/T8ZFc8GrHoI/AAAAAAAACdE/kSBCcfSSpgU/s1600/IMAG0781.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="225" src="http://3.bp.blogspot.com/-RT98jV4_DP8/T8ZFc8GrHoI/AAAAAAAACdE/kSBCcfSSpgU/s400/IMAG0781.jpg" width="400" /></a></div><b><br /></b><br /><b>1) Initial setup</b><br />Download the debian squeeze image from: <a href="http://www.raspberrypi.org/downloads">http://www.raspberrypi.org/downloads</a> and write to an SD card, following the guide here:<a href="http://www.blogger.com/%C2%A0http://elinux.org/RPi_Easy_SD_Card_Setup"> http://elinux.org/RPi_Easy_SD_Card_Setup</a>. <br /><br />Insert the sd card into the pi, power it up connect up a screen, a keyboard and ethernet.<br /><br /><b>2) Enable SSH (optional)</b><br /><br />You may at this point like to enable ssh in order to do the rest of the setup remotely from your 'normal' computer (running the pi in headless mode). I followed this guide, <a href="http://fusionstrike.com/2012/setting-ssh-ftp-raspberry-pi-debian">http://fusionstrike.com/2012/setting-ssh-ftp-raspberry-pi-debian</a>. The main steps are:<br /><br />$ sudo bash (Not sure if this is needed, apparently it is useful when performing a series of administrative tasks)<br /><br />Crease a public RSA key:<br /><br />$ ssh-keygen -t rsa<br /><br />It will ask where you would like it saved and a pass-phrase, skip these questions by pressing enter. Once finished and the pattern has appeared enter the followin to enables ssh at boot:<br /><br />$ sudo mv /boot/boot_enable_ssh.rc /boot/boot.rc<br /><br />Then to start ssh:<br />$ sudo /etc/init.d/ssh start<br /><br />Find the IP address of your pi ($ ifconfig -a) and then from your computer login to the raspberry pi via ssh, for example:<br /><br />$ ssh pi@192.168.1.17<br />(password: raspberry)<br /><br /><b>3) Update repositories</b><br />It may be worth making sure that all packages are up to date at this point:<br /><br />$ sudo apt-get update<br /><br /><b>4) Install mysql</b><br /><br />$ sudo apt-get install mysql-server mysql-client<br /><br />When the blue dialog&nbsp;appears&nbsp;enter a password for root user, note the password down as you will need it later.<br /><br /><b>5) Install apache2</b><br /><br />$ sudo apt-get install apache2<br /><div><br /></div><div>If apache fails to start (as it did for me) run the following:<br /><br />$ sudo groupadd www-data<br />$ sudo usermod -a -G www-data www-data<br /><br /><b>6) Install php</b><br /><br />$ sudo apt-get install php5 libapache2-mod-php5<br /><br />$ sudo apt-get install php5-mysql<br /><br /><b>7) Enable mod rewrite</b><br /><br />$ sudo a2enmod rewrite<br /><br />$ sudo nano /etc/apache2/sites-enabled/000-default<br /><br />Change (line 7 and line 11), "AllowOverride None" to "AllowOverride All".<br />Save and exit.<br /><br /><b>8)&nbsp;That completes the server installation, restart the server to make everything above operational:</b><br /><b><br /></b><br />$ sudo /etc/init.d/apache2 restart<br /><br /><b>Installing emoncms:</b><br /><br /><b>7) Install git (optional)</b><br /><br />$ sudo apt-get install git-core<br /><br />Follow this tutorial on creating keys etc: <br /><a href="http://help.github.com/linux-set-up-git/">http://help.github.com/linux-set-up-git/</a><br /><br />Finally to download, in the /var/www folder type:<br /><br />$ git clone git@github.com:openenergymonitor/emoncms3.git<br /><br /><b>Alternatively </b>download emoncms and unzip to your server:<br /><a href="https://github.com/openenergymonitor/emoncms3">https://github.com/openenergymonitor/emoncms3</a> <br /><br /><b> 8) Create a MYSQL database </b><br /><br />$ mysql -u root - p<br /><br />Enter the mysql password that you set above.<br />Then enter the sql to create a database:<br /><br />mysql&gt; CREATE DATABASE emoncms;<br /><br /><b> 9) Set emoncms database settings.</b><br />In the folder emoncms3/Includes rename default.settings.php to settings.php. In settings.php&nbsp;enter your mysql username (root) and password, host (localhost) and database name (if as above - emoncms).<br /><b><br /></b><br /><b>10) In an internet browser, load emoncms:</b><br /><br />http://YOURIP/emoncms3<br /><br />That's should be it!<br /><br />Next step is to get a jeelink running to&nbsp;receive&nbsp;and forward data from the emontx to the emoncms installation. Will update shortly.</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/05/emontx-single-ac-power-supply/">emonTx single AC power supply - Part 1 Simulation</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-05-27T21:29:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-05-27 21:29:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/05/emontx-single-ac-power-supply/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><div style="text-align: left;">The current <a href="http://openenergymonitor.org/emon/emontx">emonTx V2.x</a> can monitor AC voltage, real power, power factor and direction of current flow, this is possible by using a plug-in 9V AC-AC transformer to provide a stepped-down AC voltage waveform. See&nbsp;<a href="http://openenergymonitor.org/emon/buildingblocks/measuring-voltage-with-an-acac-power-adapter">Measuring AC Voltage with an AC to AC power adapter</a>&nbsp;in the building blocks section for more details. The emonTx also requires an additional (separate) DC power source, this is usually provided by a 5V USB&nbsp;plug-in&nbsp;adaptor.<br /><br /></div><div style="text-align: left;">Obviously it's desirable to do away with one of the power supplies and to use the AC-AC adapter to provide both the AC signal and the DC power to the emonTx. Early tests indicated that using the AC signal to provide a DC power supply&nbsp;adversely&nbsp;effected&nbsp;the quality of the AC&nbsp;signal&nbsp;and therefore the voltage and real power reading of the emonTx. Full wave&nbsp;rectification with a bridge rectifier creates a power supply with floating supply rails&nbsp;and loading the AC-AC adaptor caused distortion of the AC sine wave sample signal.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">There has been an interesting <a href="http://openenergymonitor.org/emon/node/309">form thread</a> on the topic of using a single AC power supply for the emonTx. There were number of suggestions for circuits to&nbsp;achieve&nbsp;this. Many of the circuits suggested looked&nbsp;feasible&nbsp;but some added&nbsp;considerable&nbsp;complexity&nbsp;and components such as centre-tapped or isolating transformers. We are keen to use an off-the-shelf certified power supply unit wherever direct connection to mains power is involved.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><span style="text-align: center;">Recently</span>&nbsp;<a href="http://openenergymonitor.org/emon/user/924">Robert Wall</a> contacted us with a single AC power supply circuit design based on a half-wave rectifier and LDO linear voltage regulator. The circuit only requires an additional two capacitors, two diodes and one resistor to&nbsp;supplement the&nbsp;components we already have on the emonTx PCB. Robert has been very helpful offering his expertise and experience as an Electronic Engineer to the project. The technical testing report on the <a href="http://openenergymonitor.org/emon/buildingblocks/report-yhdc-sct-013-000-current-transformer">SCT-013-000 CT</a> and <a href="http://openenergymonitor.org/emon/buildingblocks/report-mascot-9v-acac-adaptor">Mascot AC-AC adapter</a> in the building blocks section are all Robert's work.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><i>Note: this circuit design is still in development, we are currently at the simulation stage</i></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-3El_MoBPMCI/T8H-QwqxftI/AAAAAAAAbn4/Zl-kBlwbQRI/s1600/Half+wave+rectifier+power+supply+labeled+diagram.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="188" src="http://1.bp.blogspot.com/-3El_MoBPMCI/T8H-QwqxftI/AAAAAAAAbn4/Zl-kBlwbQRI/s640/Half+wave+rectifier+power+supply+labeled+diagram.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: 13px;">Fig1. Half wave rectifier AC-DC power supply and AC voltage sample&nbsp;</span></div></td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">The key to Robert's circuit is current limiting resistor R1, this limits the current draw from capacitor C1. The resistor value was chosen to attempt to charge C1 gradually over the positive half cycle. See the&nbsp;labelled&nbsp;waveforms below to see how this works in <strike>practice</strike> simulation! C2 is a de-coupling capacitor and R3-R5 reduce the AC sample to the correct magnitude and bias ready to be sampled by the ATmega328 ADC.&nbsp;</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-LrkqHchGQfg/T8FaT2Amz6I/AAAAAAAAbnQ/W3fqDUGCEzI/s1600/Simulation+waveforms+under+normal+operating+conditions.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="369" src="http://4.bp.blogspot.com/-LrkqHchGQfg/T8FaT2Amz6I/AAAAAAAAbnQ/W3fqDUGCEzI/s640/Simulation+waveforms+under+normal+operating+conditions.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Fig2. Simulation waveforms under normal operating conditions</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">To demonstrate the effect of the current limiting resistor R1 the simulation was ran with R1= 1 ohm, see the labelled waveforms in Fig.3 below. The capacitor C1 now charges up quicker drawing more current from the AC-AC adapter, this loads the adapter creating a 'dip' in the AC sample waveform. This will&nbsp;negatively&nbsp;effect the voltage and real power reading on the emonTx.&nbsp;</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-fk2Npys5kp0/T8FaSBg5KhI/AAAAAAAAbnE/ug8gSng4hqo/s1600/Effect+of+low+value+current+limiting+resistor+R1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="284" src="http://4.bp.blogspot.com/-fk2Npys5kp0/T8FaSBg5KhI/AAAAAAAAbnE/ug8gSng4hqo/s640/Effect+of+low+value+current+limiting+resistor+R1.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Fig. 3 Demonstrating the effect of low value current limiting resistor R1</td></tr></tbody></table>Simulation has indicated that with a current draw of about 8mA (ATmega328) and using the Mascot AC-AC power adapter with a mains voltage of about 240Vrms results in a -6mV&nbsp;difference&nbsp;in the Vrms of the sample waveform when compared with a perfect&nbsp;sine wave. This should be small enough to not&nbsp;adversely&nbsp;effect the AC voltage and real power reading, a tweaking of the calibration will probably be required.<br /><br />The next step is to move beyond the&nbsp;virtual;&nbsp;build up a prototype to see if it performs in practice like the simulation suggests!<br /><br />I've posted the<a href="http://www.linear.com/designtools/software/#LTspice"> LTspice</a> simulation files used to generate the simulation waveforms on the forum:&nbsp;<a href="http://openenergymonitor.org/emon/node/704">http://openenergymonitor.org/emon/node/704</a>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/05/view-your-power-data-as-histogram-in/">View your power data as a histogram in emoncms</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-05-26T15:53:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-05-26 15:53:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/05/view-your-power-data-as-histogram-in/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div style="text-align: left;">This blog post details how to view your power data as a histogram in emoncms. This is a really useful feature implemented in emoncms by Paul Allen <a href="http://wattdata.blogspot.fr/">http://wattdata.blogspot.com</a>&nbsp;&nbsp;(MarsFlyer on Gitub:&nbsp;<a href="https://github.com/MarsFlyer">https://github.com/MarsFlyer</a>). So a really big thank you to Paul for this!</div><div style="text-align: left;"><br /></div><div style="text-align: left;">The histogram shows the energy (KWh) used at a particular power (watts) which allows analysis of what types of devices (low / medium / high) are using the most energy.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Here is the histogram visualisation for my house, embedded directly from emoncms.</div><div style="text-align: left;"><b>Click on a particular day to see a histogram of that day:</b></div><div><div style="text-align: left;"><br /></div></div><div><div style="text-align: left;"><iframe frameborder="0" height="500px" marginheight="0" marginwidth="0" scrolling="no" src="http://vis.openenergymonitor.org/emoncms3/Vis/kwhd_histogram/kwhdzoomer.php?apikey=622568853818f6a340569ec059e340f8&amp;power=106&amp;kwhd=107&amp;whw=691" width="700px"></iframe> </div><div><div style="text-align: left;"><b>Viewing your power data as a histogram</b></div><div style="text-align: left;"><b><br /></b></div><div style="text-align: left;">1) Send power data to <a href="http://openenergymonitor.org/emon/emoncms">emoncms</a> see here for details of doing this with an emontx and emonbase: see&nbsp;<a href="http://openenergymonitor.org/emon/applications/homeenergy">Build a home electricity energy monitor</a></div><div style="text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/-_OR6Y9jg9R8/T79STfaWeFI/AAAAAAAACcI/k1SqqR4BISA/s1600/histogram01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="http://4.bp.blogspot.com/-_OR6Y9jg9R8/T79STfaWeFI/AAAAAAAACcI/k1SqqR4BISA/s400/histogram01.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">2) Click on the power input to bring up the input configuration page. Set up processes as in the screenshot, one power process, one kwhd process and one histogram process:</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-9xBWLtmVeTg/T79SUEOj1cI/AAAAAAAACcM/anS1IlrCtE0/s1600/histogram02.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="312" src="http://2.bp.blogspot.com/-9xBWLtmVeTg/T79SUEOj1cI/AAAAAAAACcM/anS1IlrCtE0/s400/histogram02.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">3) Click on Feeds to bring up the feed/list page, click on the histogram feed:</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-qHZN_zHV4K8/T79SUkesV7I/AAAAAAAACcU/RPyVXTV6guQ/s1600/histogram03.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="176" src="http://2.bp.blogspot.com/-qHZN_zHV4K8/T79SUkesV7I/AAAAAAAACcU/RPyVXTV6guQ/s400/histogram03.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">4) In the histograms feed/view page click on the graph type histogram:</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/-oDQ8JIiZNxs/T79SVCg5T8I/AAAAAAAACcc/rPoVnFDd610/s1600/histogram04.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="220" src="http://4.bp.blogspot.com/-oDQ8JIiZNxs/T79SVCg5T8I/AAAAAAAACcc/rPoVnFDd610/s400/histogram04.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">5) Once you have been logging histogram data for a few hours you will start to see histogram bars form at the different levels of power that you use. This histogram graph shows energy used at a particular power for all time. So is a really useful tool for measuring what is the total energy used by the electric immersion water heater for example, we've used 62 kWh @ 3500W since April 13th.</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-43z1A8f2BDk/T79SV1jIwCI/AAAAAAAACco/yJWOfUzR3Cc/s1600/histogram05.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="324" src="http://2.bp.blogspot.com/-43z1A8f2BDk/T79SV1jIwCI/AAAAAAAACco/yJWOfUzR3Cc/s640/histogram05.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">6) To view your histogram data at a daily basis as in the first embedded visualisation above enter your feed id's and apikey in the following emoncms visualisation url:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>http://vis.openenergymonitor.org/emoncms3/Vis/kwhd_histogram/kwhdzoomer.php?apikey=YOURAPIKEY&amp;power=1&amp;kwhd=2&amp;whw=3</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;">All the source code for the histogram functionality is available in the main emoncms3 repository on github <a href="http://github.com/openenergymonitor/emoncms3">http://github.com/openenergymonitor/emoncms3</a></div><div style="text-align: left;"><br /></div><div style="text-align: left;">Paul Allen has achieved some remarkable reductions in energy use over the last 4 years and uses a version of the histogram&nbsp;beautifully&nbsp;to visualise the changes, see his blog post here:&nbsp;<a href="http://wattdata.blogspot.fr/2011/11/personal-experiences-of-saving-42-on-my.html">Personal experiences of saving 42% on my electricity use</a></div></div></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/05/visualisation-api/">Visualisation API</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-05-25T22:20:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-05-25 22:20:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> Less than one minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/05/visualisation-api/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: left;">Its now a bit easier to get to the different emoncms visualisations. Just click on the Vis tab to bring up the visualisation API page, enter the feed id/s to be visualised and click on the view button:</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-kNP2OnOjVE0/T8ADtFF3b4I/AAAAAAAACc0/ZXpAIUO6r5I/s1600/visapi.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="372" src="http://3.bp.blogspot.com/-kNP2OnOjVE0/T8ADtFF3b4I/AAAAAAAACc0/ZXpAIUO6r5I/s640/visapi.png" width="640" /></a></div><br /><b>Try it out</b><br /><a href="http://vis.openenergymonitor.org/emoncms3/">http://vis.openenergymonitor.org/emoncms3/</a><br /><br /><b>Github</b><br /><a href="https://github.com/openenergymonitor/emoncms3">https://github.com/openenergymonitor/emoncms3</a>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/05/measurement-of-heat-loss-in-hot-water/">Measurement of heat loss in a hot water cylinder</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-05-25T15:40:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-05-25 15:40:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/shw/'>SHW</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/05/measurement-of-heat-loss-in-hot-water/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    Carrying on from the last blog post about <a href="http://openenergymonitor.blogspot.com/2012/05/measuring-heat-flux-in-and-out-of-hot.html">measuring heat flux in and out of a hot water cylinder</a>.<br /><br />Heat loss from a hot water cylinder should be proportional to the temperature differential between the inside and the outside of the cylinder by a constant: Watts of heat loss per kelvin. See <a href="http://hyperphysics.phy-astr.gsu.edu/hbase/thermo/heatra.html#c2">heat conductivity</a>.<br /><br />Watts of heat loss can be calculated from the temperature reduction per unit time of the average cylinder temperature. If we plot heat loss against average cylinder temperature we should get a linear relationship where the slope of the line of best fit is the heat loss factor, see graph 2 below.<br /><br />This constant the heat loss factor for a particular cylinder is a useful measure in evaluating the&nbsp;performance&nbsp;of a cylinder.<br /><br /><b>My hot water is heated with a 3kW electric immersion heater. I wanted to know how much heat would be lost if I leave the&nbsp;immersion&nbsp;heater on all the time at a given temperature and so how much energy I could save by only putting the immersion heater on specifically when its needed i.e for a bath in the evening.</b><br /><br /><b>The results</b><br /><br />I have selected a period of time here where both hot water and the immersion heater where not used. Leaving only solar hot water heat input and heat loss from the cylinder as the only drivers of the system. The solar hot water coil is in the bottom of the cylinder which heat's the cylinder relatively evenly compared with the immersion heater making it ideal for this test.&nbsp;I have filtered out all positive heat gain so that we can see the heat loss clearly:<br /><br /><div><iframe frameborder="0" height="1100px" marginheight="0" marginwidth="0" scrolling="no" src="http://vis.openenergymonitor.org/emoncms3/Vis/test/heatloss.php?apikey=622568853818f6a340569ec059e340f8&amp;feedA=22&amp;feedB=23" width="700px"></iframe><br /><br /><b>Conclusion</b><br /><br />The conclusion is that we are saving about 1.6 kWh/d from reduced heat loss (30C temperature difference over 23 hours), which is a good saving from something relatively easy to do. It may be that we are saving more than this from reduced hot water demand in the first place by not having hot water on tap all day but this is another thing to test.<br /><br />If your monitoring hot water cylinder temperature It would be great to see how these figures compare.<br /><br /><b>Download the source code:</b>&nbsp;<a href="http://openenergymonitor.org/emon/sites/default/files/heatloss.zip">heatloss.zip</a></div>
    
  </div>
  </article>
  <hr>
  

  <div class="pagination">
    
      <a class="btn pull-left" href="/posts/26">&larr; Older</a>
    

    
    <a class="btn pull-right" href="/posts/24">Newer &rarr;</a>
    
  </div>


    </div>

    
    <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
      <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2019/10/cydynni-display/">Cydynni emonCMS dashboard on display</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2019/05/emondc/">Introducing emonDC</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/11/2018-dev-update/">2018 Development Review</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/11/demand-side-response/">Demand Side Response Development</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emoncms-theme/">Emoncms Blue Theme</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2018/01/emonpi-remote-access/">emonPi Remote Access with Dataplicity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/10/iotawatt/">Introducing IoTaWatt</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/cydynni-energylocal/">CydYnni – Energy Local, community hydro smart grid</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/advances-article/">Advances Wales Magazine Article</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/06/emoncms-android-app-v2/">Emoncms Android App V2</a>
        </li>
      
    
  </ul>
</section>
  
  
     <section class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Categories</h1>
  <ul class="divided" id="ub202">
    
    
      <li>
        <a href="/categories/air-quality-egg/">air quality egg
        </a>
      </li>
    
      <li>
        <a href="/categories/antenna/">antenna
        </a>
      </li>
    
      <li>
        <a href="/categories/building-energy-modelling/">building energy modelling
        </a>
      </li>
    
      <li>
        <a href="/categories/china/">china
        </a>
      </li>
    
      <li>
        <a href="/categories/christmas/">christmas
        </a>
      </li>
    
      <li>
        <a href="/categories/dc/">dc
        </a>
      </li>
    
      <li>
        <a href="/categories/dc-current-sensing/">dc current sensing
        </a>
      </li>
    
      <li>
        <a href="/categories/esp8266/">esp8266
        </a>
      </li>
    
      <li>
        <a href="/categories/htu21d/">htu21d
        </a>
      </li>
    
      <li>
        <a href="/categories/heat-pump/">heat pump
        </a>
      </li>
    
      <li>
        <a href="/categories/kaizen/">kaizen
        </a>
      </li>
    
      <li>
        <a href="/categories/kicad/">kicad
        </a>
      </li>
    
      <li>
        <a href="/categories/mqtt/">mqtt
        </a>
      </li>
    
      <li>
        <a href="/categories/nanoderf/">nanoderf
        </a>
      </li>
    
      <li>
        <a href="/categories/nodered/">nodered
        </a>
      </li>
    
      <li>
        <a href="/categories/oem-labs/">oem labs
        </a>
      </li>
    
      <li>
        <a href="/categories/okg/">okg
        </a>
      </li>
    
      <li>
        <a href="/categories/oscilloscope/">oscilloscope
        </a>
      </li>
    
      <li>
        <a href="/categories/rfm12/">rfm12
        </a>
      </li>
    
      <li>
        <a href="/categories/rfm69/">rfm69
        </a>
      </li>
    
      <li>
        <a href="/categories/rs485/">rs485
        </a>
      </li>
    
      <li>
        <a href="/categories/sap-2012/">sap 2012
        </a>
      </li>
    
      <li>
        <a href="/categories/shw/">shw
        </a>
      </li>
    
      <li>
        <a href="/categories/srf/">srf
        </a>
      </li>
    
      <li>
        <a href="/categories/tasker/">tasker
        </a>
      </li>
    
      <li>
        <a href="/categories/android/">android
        </a>
      </li>
    
      <li>
        <a href="/categories/app/">app
        </a>
      </li>
    
      <li>
        <a href="/categories/application/">application
        </a>
      </li>
    
      <li>
        <a href="/categories/arduino/">arduino
        </a>
      </li>
    
      <li>
        <a href="/categories/award/">award
        </a>
      </li>
    
      <li>
        <a href="/categories/backup/">backup
        </a>
      </li>
    
      <li>
        <a href="/categories/batteries/">batteries
        </a>
      </li>
    
      <li>
        <a href="/categories/benchmarking/">benchmarking
        </a>
      </li>
    
      <li>
        <a href="/categories/build-sesh/">build sesh
        </a>
      </li>
    
      <li>
        <a href="/categories/business/">business
        </a>
      </li>
    
      <li>
        <a href="/categories/ciseco/">ciseco
        </a>
      </li>
    
      <li>
        <a href="/categories/community-energy/">community energy
        </a>
      </li>
    
      <li>
        <a href="/categories/community-smart-grid/">community smart grid
        </a>
      </li>
    
      <li>
        <a href="/categories/continuous-testing/">continuous testing
        </a>
      </li>
    
      <li>
        <a href="/categories/control/">control
        </a>
      </li>
    
      <li>
        <a href="/categories/current-sensor/">current sensor
        </a>
      </li>
    
      <li>
        <a href="/categories/current-transformer/">current transformer
        </a>
      </li>
    
      <li>
        <a href="/categories/dashboard/">dashboard
        </a>
      </li>
    
      <li>
        <a href="/categories/development/">development
        </a>
      </li>
    
      <li>
        <a href="/categories/display/">display
        </a>
      </li>
    
      <li>
        <a href="/categories/diy-drones/">diy drones
        </a>
      </li>
    
      <li>
        <a href="/categories/docker/">docker
        </a>
      </li>
    
      <li>
        <a href="/categories/documentation/">documentation
        </a>
      </li>
    
      <li>
        <a href="/categories/ecohomelab/">ecohomelab
        </a>
      </li>
    
      <li>
        <a href="/categories/efergy/">efergy
        </a>
      </li>
    
      <li>
        <a href="/categories/electronics/">electronics
        </a>
      </li>
    
      <li>
        <a href="/categories/elektrocamp/">elektrocamp
        </a>
      </li>
    
      <li>
        <a href="/categories/email-notifications/">email notifications
        </a>
      </li>
    
      <li>
        <a href="/categories/embodied-energy/">embodied energy
        </a>
      </li>
    
      <li>
        <a href="/categories/emonbase/">emonbase
        </a>
      </li>
    
      <li>
        <a href="/categories/emoncms/">emoncms
        </a>
      </li>
    
      <li>
        <a href="/categories/emonctrl/">emonctrl
        </a>
      </li>
    
      <li>
        <a href="/categories/emondc/">emondc
        </a>
      </li>
    
      <li>
        <a href="/categories/emonglcd/">emonglcd
        </a>
      </li>
    
      <li>
        <a href="/categories/emonsd/">emonsd
        </a>
      </li>
    
      <li>
        <a href="/categories/emonth/">emonth
        </a>
      </li>
    
      <li>
        <a href="/categories/emontx/">emontx
        </a>
      </li>
    
      <li>
        <a href="/categories/emontx-v2/">emontx v2
        </a>
      </li>
    
      <li>
        <a href="/categories/emontxsmt/">emontxsmt
        </a>
      </li>
    
      <li>
        <a href="/categories/emontxshield/">emontxshield
        </a>
      </li>
    
      <li>
        <a href="/categories/emoncms/">emoncms
        </a>
      </li>
    
      <li>
        <a href="/categories/emonesp/">emonesp
        </a>
      </li>
    
      <li>
        <a href="/categories/emonpi/">emonpi
        </a>
      </li>
    
      <li>
        <a href="/categories/emontx/">emontx
        </a>
      </li>
    
      <li>
        <a href="/categories/end-to-end/">end to end
        </a>
      </li>
    
      <li>
        <a href="/categories/energy-monitor/">energy monitor
        </a>
      </li>
    
      <li>
        <a href="/categories/energy-monitoring/">energy monitoring
        </a>
      </li>
    
      <li>
        <a href="/categories/esp8266/">esp8266
        </a>
      </li>
    
      <li>
        <a href="/categories/ev/">ev
        </a>
      </li>
    
      <li>
        <a href="/categories/feed-storage/">feed storage
        </a>
      </li>
    
      <li>
        <a href="/categories/firmware/">firmware
        </a>
      </li>
    
      <li>
        <a href="/categories/forum/">forum
        </a>
      </li>
    
      <li>
        <a href="/categories/github/">github
        </a>
      </li>
    
      <li>
        <a href="/categories/graphing/">graphing
        </a>
      </li>
    
      <li>
        <a href="/categories/hackathon/">hackathon
        </a>
      </li>
    
      <li>
        <a href="/categories/hall-effect/">hall effect
        </a>
      </li>
    
      <li>
        <a href="/categories/hardware/">hardware
        </a>
      </li>
    
      <li>
        <a href="/categories/heating/">heating
        </a>
      </li>
    
      <li>
        <a href="/categories/heatpumpmonitor/">heatpumpmonitor
        </a>
      </li>
    
      <li>
        <a href="/categories/home-assistant/">home assistant
        </a>
      </li>
    
      <li>
        <a href="/categories/home-camp/">home camp
        </a>
      </li>
    
      <li>
        <a href="/categories/humidity/">humidity
        </a>
      </li>
    
      <li>
        <a href="/categories/integrations/">integrations
        </a>
      </li>
    
      <li>
        <a href="/categories/interface/">interface
        </a>
      </li>
    
      <li>
        <a href="/categories/interview/">interview
        </a>
      </li>
    
      <li>
        <a href="/categories/iotawatt/">iotawatt
        </a>
      </li>
    
      <li>
        <a href="/categories/java/">java
        </a>
      </li>
    
      <li>
        <a href="/categories/job/">job
        </a>
      </li>
    
      <li>
        <a href="/categories/kickstarter/">kickstarter
        </a>
      </li>
    
      <li>
        <a href="/categories/lightwaverf/">lightwaverf
        </a>
      </li>
    
      <li>
        <a href="/categories/linux/">linux
        </a>
      </li>
    
      <li>
        <a href="/categories/logo/">logo
        </a>
      </li>
    
      <li>
        <a href="/categories/manufacturing/">manufacturing
        </a>
      </li>
    
      <li>
        <a href="/categories/measurement/">measurement
        </a>
      </li>
    
      <li>
        <a href="/categories/media/">media
        </a>
      </li>
    
      <li>
        <a href="/categories/mobile/">mobile
        </a>
      </li>
    
      <li>
        <a href="/categories/mobile-app/">mobile app
        </a>
      </li>
    
      <li>
        <a href="/categories/modbus/">modbus
        </a>
      </li>
    
      <li>
        <a href="/categories/nanode/">nanode
        </a>
      </li>
    
      <li>
        <a href="/categories/ook/">ook
        </a>
      </li>
    
      <li>
        <a href="/categories/open-source/">open source
        </a>
      </li>
    
      <li>
        <a href="/categories/openhab/">openhab
        </a>
      </li>
    
      <li>
        <a href="/categories/openenergymonitor/">openenergymonitor
        </a>
      </li>
    
      <li>
        <a href="/categories/openevse/">openevse
        </a>
      </li>
    
      <li>
        <a href="/categories/optical-pulse/">optical pulse
        </a>
      </li>
    
      <li>
        <a href="/categories/pcb/">pcb
        </a>
      </li>
    
      <li>
        <a href="/categories/pebble/">pebble
        </a>
      </li>
    
      <li>
        <a href="/categories/placement/">placement
        </a>
      </li>
    
      <li>
        <a href="/categories/platformio/">platformio
        </a>
      </li>
    
      <li>
        <a href="/categories/pluse/">pluse
        </a>
      </li>
    
      <li>
        <a href="/categories/presentation/">presentation
        </a>
      </li>
    
      <li>
        <a href="/categories/raspberry-pi/">raspberry pi
        </a>
      </li>
    
      <li>
        <a href="/categories/raspberry-pi/">raspberry pi
        </a>
      </li>
    
      <li>
        <a href="/categories/renewable/">renewable
        </a>
      </li>
    
      <li>
        <a href="/categories/serial/">serial
        </a>
      </li>
    
      <li>
        <a href="/categories/shop/">shop
        </a>
      </li>
    
      <li>
        <a href="/categories/showcase/">showcase
        </a>
      </li>
    
      <li>
        <a href="/categories/smartwatch/">smartwatch
        </a>
      </li>
    
      <li>
        <a href="/categories/social-energy-monitoring/">social energy monitoring
        </a>
      </li>
    
      <li>
        <a href="/categories/solarpv/">solarpv
        </a>
      </li>
    
      <li>
        <a href="/categories/sparkfun/">sparkfun
        </a>
      </li>
    
      <li>
        <a href="/categories/sustainability/">sustainability
        </a>
      </li>
    
      <li>
        <a href="/categories/temperature/">temperature
        </a>
      </li>
    
      <li>
        <a href="/categories/three-phase/">three phase
        </a>
      </li>
    
      <li>
        <a href="/categories/travisci/">travisci
        </a>
      </li>
    
      <li>
        <a href="/categories/tutorials/">tutorials
        </a>
      </li>
    
      <li>
        <a href="/categories/upgrade/">upgrade
        </a>
      </li>
    
      <li>
        <a href="/categories/user-guide/">user guide
        </a>
      </li>
    
      <li>
        <a href="/categories/utility-meters/">utility meters
        </a>
      </li>
    
      <li>
        <a href="/categories/voltage-sensing/">voltage sensing
        </a>
      </li>
    
      <li>
        <a href="/categories/vrms/">vrms
        </a>
      </li>
    
      <li>
        <a href="/categories/website/">website
        </a>
      </li>
    
      <li>
        <a href="/categories/wifipixel/">wifipixel
        </a>
      </li>
    
      <li>
        <a href="/categories/wind/">wind
        </a>
      </li>
    
      <li>
        <a href="/categories/wind-turbine/">wind turbine
        </a>
      </li>
    
      <li>
        <a href="/categories/wireless/">wireless
        </a>
      </li>
    
      <li>
        <a href="/categories/workshop/">workshop
        </a>
      </li>
    
      <li>
        <a href="/categories/zerocarbonbritain/">zerocarbonbritain
        </a>
      </li>
    
  </ul>
</section>
  
</div>
    </aside>
    
  </div>
</div>

<footer>
  <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit" style="text-align:center;">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
<!--
<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div> -->
</div>
    </div>
  </div>
</div>
</footer>

<!--[if lt IE 7]>
  <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

</body>
</html>
