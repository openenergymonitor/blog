---
layout: post
title: 'Building Energy Modelling: A simple javascript model'
date: '2013-06-24T03:25:00.002-07:00'
author: Trystan Lea
categories:
- Building Energy Modelling
modified_time: '2013-06-24T03:44:56.815-07:00'
thumbnail: http://4.bp.blogspot.com/-RHJBecKT4f0/UcgVPShFXqI/AAAAAAAACs0/7pKcyO-VwI0/s72-c/house02graphic.png
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-801647916590634105
blogger_orig_url: http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-simple.html
---

Putting what we covered in the last two posts together we can create a basic building energy model that covers building <a href="http://openenergymonitor.blogspot.com/2013/06/how-much-energy-does-it-take-to-heat.html">fabric heat loss</a>&nbsp;and <a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-ventilation.html">infiltration heat loss</a>.<br /><br />To start with the model extends the very basic example given in the first blog of the cube house by allowing for different building elements with different U-values: Walls, Roof, Floor, Windows. This is implemented in the same way as can be found in the full SAP model.<br /><div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-RHJBecKT4f0/UcgVPShFXqI/AAAAAAAACs0/7pKcyO-VwI0/s1600/house02graphic.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="303" src="http://4.bp.blogspot.com/-RHJBecKT4f0/UcgVPShFXqI/AAAAAAAACs0/7pKcyO-VwI0/s400/house02graphic.png" width="400" /></a></div><br />When calculating the heat loss from a building with multiple elements its useful to break the equation for building fabric element heat loss (Building fabric element heat loss = Area x U-Value x temperature difference)&nbsp;&nbsp;down into three parts.</div><div><ol><li>Calculate the Area x U-Value for each element giving the heat loss in Watts per Kelvin (W/K) for that building element.</li><li>Calculate the sum of the heat loss in W/K for all elements.</li><li>Calculate the the total heat loss in Watts for a given temperature difference.</li></ol>Here's an example house with a fairly simple range of elements, also added is an average infiltration rate for a modern house as covered in the&nbsp;<a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-ventilation.html">last blog post</a>.<br /><div style="margin-bottom: 0cm;"><br /></div><table cellpadding="4" cellspacing="0" style="width: 100%px;"> <colgroup><col width="124*"></col> <col width="32*"></col> <col width="12*"></col> <col width="32*"></col> <col width="13*"></col> <col width="44*"></col> </colgroup><tbody><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="48%"><br /><br /></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="12%"><div align="CENTER"><b>Area</b></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="5%"><div align="CENTER"><br /></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="12%"><div align="CENTER"><b>U-Value</b></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="5%"><div align="CENTER"><br /></div></td>  <td style="border: 1px solid #000000; padding: 0.1cm;" width="17%"><div align="CENTER"><b>W/K</b></div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%">Solid floor uninsulated</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">49 m2</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">x</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">0.7</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">=</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER">34.3 W/K</div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%">Timber frame walls with 50mm of insulation</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">156 m2</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">x</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">0.45</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">=</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER">70.2 W/K</div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%">Roof with 100mm of loft insulation</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">49 m2</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">x</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">0.25</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">=</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER">12.3 W/K</div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%">Double glazed windows</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">12 m2</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">x</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="12%"><div align="CENTER">2.0</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="5%"><div align="CENTER">=</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER">24.0 W/K</div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%">Infiltration: average modern house 1.5 air changes per hour.</td>  <td colspan="4" style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="35%"><div align="RIGHT">1.5 x 0.33 x 294m<sup>3    </sup>=</div><div align="RIGHT"><br /></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER">145.5 W/K</div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%"><br /><br /></td>  <td colspan="4" style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="35%"><div align="RIGHT"><b>TOTAL &nbsp;&nbsp;</b></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER"><b>286.3 W/K</b></div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%"><br /><br /></td>  <td colspan="4" style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="35%"><div align="RIGHT"><b>Temperature difference</b></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER"><b>9.0 C</b></div></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="48%"><br /><br /></td>  <td colspan="4" style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="35%"><div align="RIGHT"><b>Heat loss (286W/K x 9C =)</b></div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER"><b>2577 W</b></div></td> </tr><tr valign="TOP">  <td colspan="5" style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="83%"><div align="RIGHT"><b>Annual total heating demand </b>(including    internal and solar gains)</div></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="17%"><div align="CENTER"><b>22570 kWh</b></div></td> </tr></tbody></table><div style="margin-bottom: 0cm;"><br /></div><b>Note: </b>We still need to take into account: solar and internal gains and seasonal temperature variation as a minimum before we get the actual demand on the heating system. <br /><br />So that's all quite straightforward, the open source SAP implementation is written primarily in javascript with all the calculations happening on the 'client' (in the internet browser). The model combined with an interface updated in real-time makes for a dynamic experience with everything being calculated and visualised on the fly. <br /><br />Here's a javascript implementation of the above with just a simple console output for now: <br /><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><b>Javascript code example</b><br /><pre>var elements = [ <br />  {itemname: "Floor", grossarea: 49.0, openings: 0, uvalue: 0.7}, <br />  {itemname: "Walls", grossarea: 168.0, openings: 12.0, uvalue: 0.45}, <br />  {itemname: "Loft", grossarea: 49.0, openings: 0, uvalue: 0.25}, <br />  {itemname: "Windows", grossarea: 12.0, openings: 0, uvalue: 2.0} <br />]; <br /><br />var  fabric_heat_loss_WK = 0; <br /><br />for (z in elements) { <br />  elements[z].netarea = elements[z].grossarea - elements[z].openings; <br />  elements[z].axu = elements[z].netarea * elements[z].uvalue; <br />  fabric_heat_loss_WK += elements[z].axu; <br />} <br /><br />var volume = 294;<br />var infiltration = 1.5; // Air change per hour<br />var infiltration_WK = 0.33 * infiltration * volume;<br /><br />var internal_temperature = 21; <br />var external_temperature = 12; <br /><br />var total_heat_loss_WK = fabric_heat_loss_WK + infiltration_WK;<br /><br />var  heatloss =  total_heat_loss_WK * ( internal_temperature -  external_temperature );<br /><br />console.log("Total heating requirement: "+heatloss.toFixed(0)+" W"); <br />console.log("Annual heating demand: "+(heatloss*0.024*365).toFixed(0)+" kWh"); <br /><br /></pre>You can run this code directly on your computer via linux terminal without using an internet browser using nodejs http://nodejs.org/. To install nodejs on Ubuntu type:<br /><pre>sudo apt-get install nodejs</pre><br />create a file called  bem01.js and copy the javascript above into it and save.<br />Locate the file with terminal and then run using: <br /><pre>nodejs bem01.js</pre><br />it should output:<br /><pre>Total heating requirement: 2577 W <br />Annual heating demand: 22570 kWh</pre><b><br /></b><b>Seasonal temperature variation</b><br />So far to keep things simple we have assumed constant external temperature and internal temperature. There are different ways to take into account temperature variation, one common method is degree days <a href="http://www.degreedays.net/introduction">http://www.degreedays.net/introduction</a>. <br /><br />If I understand it correctly the SAP model uses average indoor temperature minus average external temperature on a monthly basis to calculate total heat demand and then it has a factor that reduces the % of a month the heating is on for if gains from solar and internal sources are significant.<br /><br /><b>Different sources of heat gain</b><br />What we have covered so far covers the heat loss side of the equation but the heating energy requirement is not yet what our heating system needs to provide instead it is the total heat energy going into the system that is our house including heat from other sources in addition to the main heating system, the other heat gains typically taken into account are: Solar gains and Internal Gains which usually consist of Cooking,&nbsp;Lighting&nbsp; Appliances and metabolic gains (These are the sources covered in the SAP model)<br /><br />The full energy balance equation for a steady state building energy model looks like this:<br /><br /><pre>solar_gains + cooking + lighting + hotwater + appliances + metabolic + heating_system =<br />( fabric_heat_loss_WK + infiltration_WK) x (internal_temperature â€“ external_temperature)</pre><br />This is really the fundamental equation that&nbsp;describes&nbsp;a simple steady state building energy model, a large part of the SAP model is concerned with calculating estimates for all the variables that go into this equation.<br /><br /><b>Integrating Monitoring into a building energy model.</b><br />The above equation shows several variables that could be provided or&nbsp;inferred&nbsp;to some degree by monitoring.<br /><br />Internal temperature could be provided by an array of temperature sensors throughout a building. External temperature could be provided by an external temperature sensor or pulled in from a local weather station.<br /><br />Depending on energy source: cooking, lighting, hot water, appliances and heating system input could be provided from either electricity monitoring or electric and gas, the degree of utilisation would need to be taken into account.<br /><br />Solar gains could be calculated from a irradiance sensor or how about normalised solar PV data?<br /><br /><b>Summary of building energy modelling blog posts and code</b><br /> For the open source implementation of the SAP 2012 model see github here:<br /><a href="http://github.com/emoncms/sap">github.com/emoncms/sap</a><br /><br /><a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-part-1-whole.html">Building Energy Modelling part 1 - The Whole House Book</a></div><div style="margin-bottom: 0cm;"><a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-part-2-first.html">Building Energy Modelling part 2 - First attempts and research</a><br /><a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-carbon-coop.html">Building Energy Modelling part 3 - Carbon Coop and Open Source SAP 2012</a><br /><br /><a href="http://openenergymonitor.blogspot.com/2013/06/how-much-energy-does-it-take-to-heat.html">How much energy does it take to heat a simple cube house?</a><br /><a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-ventilation.html">Building Energy Modelling: Ventilation and infiltration</a></div><div style="margin-bottom: 0cm;"><a href="http://openenergymonitor.blogspot.com/2013/06/building-energy-modelling-simple.html">Building Energy Modelling: A simple javascript model</a></div><div style="margin-bottom: 0cm;"><br /><a href="http://openenergymonitor.blogspot.com/2013/05/carbon-coop.html">Carbon Coop</a><br /><a href="http://openenergymonitor.blogspot.com/2013/06/carbon-coop-and-houseahedron-meetup.html">Carbon Coop and Houseahedron meetup</a></div></div>