<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: openHAB | Blog | OpenEnergyMonitor]]></title>
  <link href="https://blog.openenergymonitor.org/categories/openhab/atom.xml" rel="self"/>
  <link href="https://blog.openenergymonitor.org/"/>
  <updated>2016-05-20T14:33:01+00:00</updated>
  <id>https://blog.openenergymonitor.org/</id>
  <author>
    <name><![CDATA[Glyn Hudson]]></name>
    <email><![CDATA[support@openenergymonitor.zendesk.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OpenEnergyMonitor, emonPi and openHAB ]]></title>
    <link href="https://blog.openenergymonitor.org/2015/12/openenergymonitor-emonpi-and-openhab/"/>
    <updated>2015-12-13T18:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2015/12/openenergymonitor-emonpi-and-openhab</id>
    <content type="html"><![CDATA[<div class="separator" style="clear: both; text-align: left;"><br /></div>
<div class="" style="clear: both; text-align: left;">Using the emonPi in it's current default configuration works great to post data to Emoncms for logging and visualisation. However there may be times when you want some more flexibility and or ability to interface with other hardware or services&nbsp;</div>
<div class="separator" style="clear: both; text-align: left;"><br /></div>
<div class="separator" style="clear: both; text-align: left;">In my last few blog posts I have been taking a look at making the <a href="http://shop.openenergymonitor.com/emonpi-1/">emonPi</a> the heart of a smart energy optimised home and how live energy monitoring data from the emonPi can easily be used to inform other services: &nbsp;&nbsp;</div>
<div class="separator" style="clear: both; text-align: left;"><br /></div>
<div class="" style="clear: both; text-align: left;">1.
<!--more-->

&nbsp;<a href="http://openenergymonitor.blogspot.co.uk/2015/10/emonpi-nodered-and-mqtt.html">Integrating&nbsp;Node-RED and MQTT&nbsp;on the emonPi</a></div>
<div class="separator" style="clear: both; text-align: left;">2. <a href="http://openenergymonitor.blogspot.co.uk/2015/11/node-red-emoncms-node.html">Node-RED and Emoncms</a></div>
<div class="" style="clear: both; text-align: left;">3. <a href="http://openenergymonitor.blogspot.co.uk/2015/11/remote-control-of-lightwave-rf-plugs.html">Controlling LightWaveRF devices on the emonPi</a>&nbsp;(OOK RF Tx)&nbsp;</div>
<div class="" style="clear: both; text-align: left;"><br /></div>
<div class="" style="clear: both; text-align: left;">Following on from my last post on controlling LightWaveRF devices from the emonPi using MQTT we now need a front end interface to handle the control. I have recently been taking a look at how openHAB can be configured to provide a front end interface to OpenEnergyMonitor hardware and control.&nbsp;</div>
<div class="" style="clear: both; text-align: left;"><br /><a href="http://2.bp.blogspot.com/-Mn4SF-hLCuQ/Vm2cvhlvFCI/AAAAAAABkr4/cq8GoyQEYkc/s1600/openhab.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="179" src="http://2.bp.blogspot.com/-Mn4SF-hLCuQ/Vm2cvhlvFCI/AAAAAAABkr4/cq8GoyQEYkc/s320/openhab.jpg" width="320" /></a><br /><br /></div>
<div class="" style="clear: both; text-align: left;">We are working on releasing an updated pre-built SD card stack for the emonPi which will include Emoncms V9, MQTT, Node-RED and openHAB all pre-configured. I hope to post a beta image download to the forums in the next few days.&nbsp;</div>
<div class="" style="clear: both; text-align: left;"><br /></div>
<div class="" style="clear: both; text-align: left;"><a href="http://www.openhab.org/">Open Home Automation Bus (openHAB)</a> is "a vendor and technology agnostic open source automation software for your home". OpenHAB can run on an emonPi (Raspberry Pi) and is very flexible and can be configured for just about any home automation task. This high level of configurability can also make it seem quite hard to understand to start with. I've have put together a <a href="https://github.com/openenergymonitor/oem_openHab">skeleton config to setup openHAB with to OpenEnergyMonitor</a> pulling data from the MQTT server running on an emonPi.&nbsp;</div>
<div class="separator" style="clear: both; text-align: left;"><br /></div>
<div class="" style="clear: both; text-align: left;">Once setup you simply browse to&nbsp;<a href="http://emonpi:8080/openhab.app?sitemap=oem">http://emonpi:8080/openhab.app?sitemap=oem</a>&nbsp;to view the openHAB user interface. openHAB also has a nice android or IOS app which can be pointed at the same URL. &nbsp; <br /><br /></div>
<table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: left;"><tbody><tr><td style="text-align: left;"><a href="http://1.bp.blogspot.com/-lAn2SNSzyLQ/VmVkYfsFDxI/AAAAAAABkic/Wqhp7g4R4uA/s1600/OpenEnergyMonitor_openHAB.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://1.bp.blogspot.com/-lAn2SNSzyLQ/VmVkYfsFDxI/AAAAAAABkic/Wqhp7g4R4uA/s400/OpenEnergyMonitor_openHAB.png" width="385" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB OpenEnergyMonitor skeleton setup</td></tr></tbody></table>
<div class="separator" style="clear: both; text-align: left;"><br /></div>
<table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: left;"><a href="http://2.bp.blogspot.com/--fxB-426-Hs/VmXNqpc1KJI/AAAAAAABkk4/lzBoHKFz5g8/s1600/Screenshot_2015-12-07-10-23-42.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/--fxB-426-Hs/VmXNqpc1KJI/AAAAAAABkk4/lzBoHKFz5g8/s400/Screenshot_2015-12-07-10-23-42.png" width="225" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB android app</td></tr></tbody></table>
<table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: left;"><a href="http://4.bp.blogspot.com/-Y_6-BnAJWcE/VmXNqpDvxjI/AAAAAAABkkw/4kpSmg9rdtU/s1600/Screenshot_2015-12-07-10-23-52.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://4.bp.blogspot.com/-Y_6-BnAJWcE/VmXNqpDvxjI/AAAAAAABkkw/4kpSmg9rdtU/s400/Screenshot_2015-12-07-10-23-52.png" width="225" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB LightWaveRF control using openHAB android app</td></tr></tbody></table>
<p><br /><br /><br /><br />&lt;div class="separator" style="clear: both; text-align: left;"&gt;&lt;/div&gt;<br />&lt;h3&gt;Installing OpenHAB&lt;/h3&gt;&lt;div&gt;<span id="goog_2128785651"></span>I have put together a <a href="https://github.com/openenergymonitor/oem_openHab">guide from installing OpenHAB on an emonPi</a> with the config shown above to work with OpenEnergyMonitor on the oem_openHAB GitHub<span id="goog_2128785652"></span>. &lt;/div&gt;&lt;div&gt;<br />&lt;/div&gt;&lt;h3&gt;OpenHAB Configuration &lt;/h3&gt;OpenHAB configuration is based around two files ‘items and ‘sitemap’. In my openHAB emonPi install instructions I recommend cloning the oem_openHAB to the home directory then soft linking the Items and Sitemap files to the relevant config locations in /etc/openhab/configurations/. This makes the files easier to edit.<br /><br />It’s possible to have multiple user interfaces defined by multiple sitemaps e.g oem.sitemap, kids.sitemap or admin.sitemap etc.<br /><br /><b>Items</b><br /><b><br /></b>The items file defines all the ‘things’ you might want to view or control in openHAB. Items can be bound to ‘bindings’ which are optional packages that used to extend functionality of openHAB. This example makes use of the MQTT and HTTP bindings. The items file is usually located in /etc/openhab/configurations/items.<br /><br />For example the line in the items file to pull power 1 from emonhub MQTT is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Number  emonpi_ct1       “Power 1 [%d W]”    { mqtt=”&lt;[mosquitto:emonhub/rx/5/values:state:REGEX((.<em>),.</em>,.<em>,.</em>,.<em>,.</em>,.<em>,.</em>,.<em>,.</em>,.*)]” }</span><br /><br /><br />Notice the REGEX is used to tell openHAB that we want the first value in the 11 part CSV emonhub posts to MQTT to emonhub/rx/5/values.<br /><br />and the items line to control LightWaveRF plug 1 (publish “1 1” to /lwrf mqtt topic) is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Switch lwrf1   “LWRF Socket 1”  {mqtt=”&gt;[mosquitto:lwrf:command:ON:1 1],&gt;[mosquitto:lwrf:command:OFF:1 0]”}</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><a href="https://github.com/openenergymonitor/oem_openHab/blob/master/oem.items">See the full items file used for this example on the open_openhab GitHub repo</a><br /><br /><b>Sitemap</b><br /><b><br /></b>The second openHAB config file of interest is ‘sitemap’. Sitemaps are used to create elements of a user interface for making openHAB items accessible to the frontend interface.<br /><br />For example the sitemap config line to produce the emonPi Power1 in the interface is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Text item=emonpi_ct1 icon=”firstfloor”</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span>And to produce the LightWaveRF control swithches:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Switch item=lwrf1 label=”LWRF Plug 1”</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><a href="https://github.com/openenergymonitor/oem_openHab/blob/master/oem.sitemap">See the full sitemap file used for this example on the open_openhab GitHub repo</a><br /><br />I have intentionally kept this ‘skeleton’ example as simple as possible. To view the full capabilities of openHAB including using groups checkout the <a href="http://demo.openhab.org:8080/openhab.app?sitemap=demo">openHAB demo</a> and corresponding demo <a href="https://github.com/openhab/openhab/blob/master/distribution/openhabhome/configurations/items/demo.items">items</a> and <a href="https://github.com/openhab/openhab/blob/master/distribution/openhabhome/configurations/sitemaps/demo.sitemap">sitemap</a> files.<br /><br />&lt;h3&gt;Demo&lt;/h3&gt;<br />Here’s a quick demo I made using openHAB to control LightWave RF plugs:<br /><br />&lt;div class="separator" style="clear: both; text-align: left;"&gt;<a href="http://3.bp.blogspot.com/-SzaE2KRbyrY/Vm2tX_kJbzI/AAAAAAABksQ/j_A9OuXi6KA/s1600/Screenshot%2B2015-12-13%2Bat%2B17.35.56.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="411" src="http://3.bp.blogspot.com/-SzaE2KRbyrY/Vm2tX_kJbzI/AAAAAAABksQ/j_A9OuXi6KA/s640/Screenshot%2B2015-12-13%2Bat%2B17.35.56.png" width="640" /></a>&lt;/div&gt;<br />&lt;div class="separator" style="clear: both; text-align: left;"&gt;&lt;iframe allowfullscreen="" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/6uF0qU30q-g/0.jpg" frameborder="0" height="266" src="https://www.youtube.com/embed/6uF0qU30q-g?feature=player_embedded" width="320"&gt;&lt;/iframe&gt;&lt;/div&gt;</p>
]]></content>
  </entry>
  
</feed>
